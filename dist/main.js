(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk}},t=()=>{let t=[],r=[],o=[],a={l_ship:e(4),m_ship_I:e(3),m_ship_II:e(3),s_ship_I:e(2),s_ship_II:e(2),s_ship_III:e(2),xs_ship_I:e(1),xs_ship_II:e(1),xs_ship_III:e(1),xs_ship_IV:e(1)};const n=e=>{let r=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(o=e[0],a=e[1],null!==t[o][a]))return r=!1;var o,a})),r},l=(e,t,r)=>{const o=r.getShip().length;let a=[],n=e,l=t;if("horizontal"===r.getShip().orientation)for(;l!==t+o;)a.push([e,l]),l+=1;else for(;n!==e+o;)a.push([n,t]),n+=1;return a},i=(e,r,o)=>{let a=[],i=!0;return r+length-1>9||e>9||e+length-1>9||r>9?alert("Ship is out of bound"):(a=l(e,r,o),i=n(a),!1===i?(i=!0,a=[],alert("square is already occupied")):(o.getShip().comp=a,o.getShip().comp.forEach((e=>{t[e[0]][e[1]]=o})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e][r]=null}return t},placeShip:i,getBoard:()=>t,getShips:()=>a,receiveAttack:(e,a)=>(null===t[e][a]?r.push([e,a]):(o.push([e,a]),t[e][a].hit(),t[e][a].getShip().hitCoor.push([e,a])),t),getMisses:()=>r,getHits:()=>o,isAllSunk:()=>{const e=Object.values(a);let t=!1;return e.forEach((e=>{if(!1===e.getShip().sunk)return t=!1;t=!0})),t},populateBd:()=>{const e=Object.keys(a),r=["horizontal","vertical"];return e.forEach((e=>{const t=a[e],o=t.getShip().length;let s=Math.floor(10*Math.random()),d=Math.floor(10*Math.random()),c=Math.floor(2*Math.random());t.getShip().orientation=r[c];let u=l(s,d,t),h=n(u);for(;d+o-1>9||s+o-1>9||!1===h;)s=Math.floor(10*Math.random()),d=Math.floor(10*Math.random()),c=Math.floor(2*Math.random()),t.getShip().orientation=r[c],u=l(s,d,t),h=n(u);i(s,d,t)})),t}}},r=e=>({number:e,win:!1,board:t(),isComp:!1}),o=(e,t,r,o,a)=>{const n=e.board.getMisses();null===t?n.find((e=>e[0]===o&&e[1]===a))?r.setAttribute("style","background-color: yellow;"):r.setAttribute("style","background-color: blue;"):t.getShip().hitCoor.find((e=>e[0]===o&&e[1]===a))&&r.setAttribute("style","background-color: red;")},a=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((r=>{const o=t[r].getShip().comp;if(0!==o.length){const a=o[0][0],n=o[0][1];e.board.placeShip(a,n,t[r])}}))})(e);const t=e.board.getBoard(),r=e.number;let a=document.getElementById(`board${r}`);for(;a.lastElementChild;)a.removeChild(a.lastElementChild);for(let n=0;n<t.length;n++)for(let l=0;l<t.length;l++){const i=document.createElement("div");i.classList.add(`${r}-square`),i.setAttribute("data-x",`${n}`),i.setAttribute("data-y",`${l}`),o(e,t[n][l],i,n,l),a.appendChild(i)}return a},n=(e,t)=>{let r;"playerOne-form"===document.querySelector("form").getAttribute("id")?r=e.board.getShips():t.board.getShips();const o=Object.keys(r),a=document.querySelector("#ships");return o.forEach((e=>{const t=document.createElement("option");t.textContent=e,a.appendChild(t)})),a},l=(e,t)=>{document.querySelector("#placeShipBtn").addEventListener("click",(r=>{r.preventDefault();let o=document.querySelector("form").getAttribute("id");const n=parseInt(document.querySelector("#y-coor").value),l=parseInt(document.querySelector("#x-coor").value),i=document.querySelector("#ships").value,s=document.querySelector("#orientation").value;let d;d="playerOne-form"===o?e.board.getShips()[i]:t.board.getShips()[i],d.getShip().orientation=s,Number.isNaN(n)||Number.isNaN(l)||("playerOne-form"===o?(e.board.placeShip(n,l,d),a(e)):(t.board.placeShip(n,l,d),a(t)))}))},i=(e,t)=>{const r=document.querySelector("main"),o=document.querySelector("#finBtn"),a=document.querySelector("form");let n=!1;o.addEventListener("click",(o=>{let l;o.preventDefault();const i=r.getAttribute("class");let d=a.getAttribute("id");l="playerOne-form"===d?e.board.getShips():t.board.getShips(),Object.values(l).forEach((e=>{const t=e.getShip().comp;return n=0!==t.length})),n?("playerOne-form"===d&&(a.setAttribute("id","playerTwo-form"),s(e)),("pvc"===i||"playerTwo-form"===d)&&(a.setAttribute("style","display: none;"),s(t),document.querySelector(".dialog").showModal())):alert("Please place all the ships first")}))},s=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},d=(e,t)=>{const r=document.querySelector("main"),o=document.querySelector(".dialog"),n=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(l=>{l.preventDefault();let i=n.getAttribute("data-id");if("player-Two"===i)return a(e),c(t),n.setAttribute("data-id",`player-${e.number}`),o.close();if("player-One"===i){const l=r.getAttribute("class");return n.setAttribute("data-id",`player-${t.number}`),"pvc"===l?(h(e,t),o.close()):(a(t),c(e),o.close())}}))},c=e=>{const t=e.board.getBoard(),r=e.board.getMisses(),o=document.querySelector(`#board${e.number}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let a=0;a<t.length;a++)for(let n=0;n<t.length;n++){const l=t[a][n],i=document.createElement("button");i.classList.add(`${e.number}-square`),i.setAttribute("data-x",`${a}`),i.setAttribute("data-y",`${n}`),u(e,i),null!==l&&l.getShip().hitCount>0&&l.getShip().hitCoor.find((e=>e[0]===a&&e[1]===n))&&(i.setAttribute("style","background-color: red;"),i.setAttribute("disabled","")),r.find((e=>e[0]===a&&e[1]===n))&&(i.setAttribute("style","background-color: green;"),i.setAttribute("disabled","")),o.appendChild(i)}},u=(e,t)=>{const r=e.board,o=r.getBoard(),a=document.querySelector(".dialog"),n=parseInt(t.getAttribute("data-x")),l=parseInt(t.getAttribute("data-y"));t.addEventListener("click",(i=>{i.preventDefault(),r.receiveAttack(n,l),null===o[n][l]?(s(e),t.setAttribute("style","background-color: red;"),a.showModal()):t.setAttribute("style","background-color: green;")}))},h=(e,t)=>{const r=e.board,o=r.getBoard(),n=r.getMisses(),l=r.getHits(),i=document.querySelector("#play-window");let s=Math.floor(10*Math.random()),d=Math.floor(10*Math.random()),u=!0;for(;!0===u;)n.find((e=>e[0]===s&&e[1]===d))||l.find((e=>e[0]===s&&e[1]===d))?(s=Math.floor(10*Math.random()),d=Math.floor(10*Math.random())):(r.receiveAttack(s,d),null===o[s][d]?(i.setAttribute("data-id",`player-${e.number}`),a(e),c(t),u=!1):(s=Math.floor(10*Math.random()),d=Math.floor(10*Math.random())))},p=document.querySelector(".game_mode"),m=document.querySelector("#pvp"),b=document.querySelector("#pvc"),g=r("One"),f=r("Two");m.addEventListener("click",(e=>(e.preventDefault(),a(g),a(f),n(g,f),l(g,f),i(g,f),d(g,f),p.close()))),b.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main");var r;return a(g),a(f),n(g,f),l(g,f),i(g,f),d(g,f),(r=f).board.populateBd(),a(r),s(r),t.classList.add("pvc"),p.close()})),document.addEventListener("onload",p.showModal())})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVdDLEdBQ3pCM0IsRUFBYTBCLEVBQVdDLEdBQ3hCbEIsRUFBWWlCLEVBQVdDLElEc09QbkUsRUNwT1BtRSxHRHFPRjdILE1BQU00QyxhQUNibUIsRUFBWUwsR0FDWjhDLEVBQVU5QyxHQ3JPVnlDLEVBQUt2QixVQUFVQyxJQUFJLE9BRVo0QyxFQUFTUixPQUFPLElBR3pCM0MsU0FBU2tCLGlCQUFpQixTQUFVaUMsRUFBU2hCLFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9wbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvRE9NLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSAobikgPT4ge1xuICBsZXQgc2hpcE9iaiA9IHt9O1xuXG4gIHNoaXBPYmpbXCJsZW5ndGhcIl0gPSBuO1xuICBzaGlwT2JqW1wiaGl0Q291bnRcIl0gPSAwO1xuICBzaGlwT2JqW1wic3Vua1wiXSA9IGZhbHNlO1xuICBzaGlwT2JqW1wib3JpZW50YXRpb25cIl0gPSBcImhvcml6b250YWxcIjtcbiAgc2hpcE9ialtcImNvbXBcIl0gPSBbXTtcbiAgc2hpcE9ialtcImhpdENvb3JcIl0gPSBbXTtcblxuICBjb25zdCBnZXRTaGlwID0gKCkgPT4gc2hpcE9iajtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgc2hpcE9iai5oaXRDb3VudCArPSAxO1xuICAgIGlmIChzaGlwT2JqLmhpdENvdW50ID09PSBzaGlwT2JqLmxlbmd0aCkgc2hpcE9iai5zdW5rID0gdHJ1ZTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXBPYmouc3VuayA9PT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldFNoaXAsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFNoaXAgfTtcbiIsImltcG9ydCB7IFNoaXAgfSBmcm9tIFwiLi9zaGlwXCI7XG5cbmNvbnN0IEdhbWVib2FyZCA9ICgpID0+IHtcbiAgbGV0IGJvYXJkID0gW107XG4gIGxldCBtaXNzZXMgPSBbXTtcbiAgbGV0IGhpdHMgPSBbXTtcblxuICBsZXQgYWxsU2hpcHMgPSB7XG4gICAgbF9zaGlwOiBTaGlwKDQpLFxuICAgIG1fc2hpcF9JOiBTaGlwKDMpLFxuICAgIG1fc2hpcF9JSTogU2hpcCgzKSxcbiAgICBzX3NoaXBfSTogU2hpcCgyKSxcbiAgICBzX3NoaXBfSUk6IFNoaXAoMiksXG4gICAgc19zaGlwX0lJSTogU2hpcCgyKSxcbiAgICB4c19zaGlwX0k6IFNoaXAoMSksXG4gICAgeHNfc2hpcF9JSTogU2hpcCgxKSxcbiAgICB4c19zaGlwX0lJSTogU2hpcCgxKSxcbiAgICB4c19zaGlwX0lWOiBTaGlwKDEpLFxuICB9O1xuXG4gIGNvbnN0IGdldEJvYXJkID0gKCkgPT4gYm9hcmQ7XG4gIGNvbnN0IGdldE1pc3NlcyA9ICgpID0+IG1pc3NlcztcbiAgY29uc3QgZ2V0U2hpcHMgPSAoKSA9PiBhbGxTaGlwcztcbiAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IGhpdHM7XG5cbiAgY29uc3QgY3JlYXRlQm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBib2FyZFtpXSA9IFtdO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICAgIGJvYXJkW2ldW2pdID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgaXNFbXB0eSA9ICh4LCB5KSA9PiB7XG4gICAgcmV0dXJuIGJvYXJkW3hdW3ldID09PSBudWxsID8gdHJ1ZSA6IGZhbHNlO1xuICB9O1xuXG4gIGNvbnN0IGlzRml0ID0gKGFycikgPT4ge1xuICAgIGxldCBzdGF0dXMgPSB0cnVlO1xuXG4gICAgYXJyLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGlmIChpdGVtWzBdID4gOSB8fCBpdGVtWzFdID4gOSB8fCAhaXNFbXB0eShpdGVtWzBdLCBpdGVtWzFdKSlcbiAgICAgICAgcmV0dXJuIChzdGF0dXMgPSBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZUNvbXAgPSAoeCwgeSwgc2hpcCkgPT4ge1xuICAgIGNvbnN0IGxlbmd0aCA9IHNoaXAuZ2V0U2hpcCgpLmxlbmd0aDtcbiAgICBjb25zdCBvcmllbnRhdGlvbiA9IHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uO1xuICAgIGxldCB0ZW1wID0gW107XG4gICAgbGV0IGEgPSB4O1xuICAgIGxldCBiID0geTtcblxuICAgIGlmIChvcmllbnRhdGlvbiA9PT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgIHdoaWxlIChiICE9PSB5ICsgbGVuZ3RoKSB7XG4gICAgICAgIHRlbXAucHVzaChbeCwgYl0pO1xuICAgICAgICBiICs9IDE7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHdoaWxlIChhICE9PSB4ICsgbGVuZ3RoKSB7XG4gICAgICAgIHRlbXAucHVzaChbYSwgeV0pO1xuICAgICAgICBhICs9IDE7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRlbXA7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHgsIHksIHNoaXApID0+IHtcbiAgICBsZXQgdGVtcCA9IFtdO1xuICAgIGxldCBzdGF0dXMgPSB0cnVlO1xuXG4gICAgaWYgKHkgKyBsZW5ndGggLSAxID4gOSB8fCB4ID4gOSB8fCB4ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeSA+IDkpIHtcbiAgICAgIHJldHVybiBhbGVydChcIlNoaXAgaXMgb3V0IG9mIGJvdW5kXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZW1wID0gY3JlYXRlQ29tcCh4LCB5LCBzaGlwKTtcbiAgICAgIHN0YXR1cyA9IGlzRml0KHRlbXApO1xuICAgIH1cblxuICAgIGlmIChzdGF0dXMgPT09IGZhbHNlKSB7XG4gICAgICBzdGF0dXMgPSB0cnVlO1xuICAgICAgdGVtcCA9IFtdO1xuICAgICAgcmV0dXJuIGFsZXJ0KFwic3F1YXJlIGlzIGFscmVhZHkgb2NjdXBpZWRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNoaXAuZ2V0U2hpcCgpLmNvbXAgPSB0ZW1wO1xuXG4gICAgICBzaGlwLmdldFNoaXAoKS5jb21wLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgYm9hcmRbaXRlbVswXV1baXRlbVsxXV0gPSBzaGlwO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IHBvcHVsYXRlQmQgPSAoKSA9PiB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGFsbFNoaXBzKTtcbiAgICBjb25zdCBkaXJlY3Rpb25zID0gW1wiaG9yaXpvbnRhbFwiLCBcInZlcnRpY2FsXCJdO1xuXG4gICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGNvbnN0IHNoaXAgPSBhbGxTaGlwc1trZXldO1xuICAgICAgY29uc3QgbGVuZ3RoID0gc2hpcC5nZXRTaGlwKCkubGVuZ3RoO1xuXG4gICAgICBsZXQgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgbGV0IHogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTtcblxuICAgICAgc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBkaXJlY3Rpb25zW3pdO1xuICAgICAgbGV0IHRlbXAgPSBjcmVhdGVDb21wKHgsIHksIHNoaXApO1xuICAgICAgbGV0IGZpdCA9IGlzRml0KHRlbXApO1xuXG4gICAgICB3aGlsZSAoeSArIGxlbmd0aCAtIDEgPiA5IHx8IHggKyBsZW5ndGggLSAxID4gOSB8fCBmaXQgPT09IGZhbHNlKSB7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIHogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTtcblxuICAgICAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IGRpcmVjdGlvbnNbel07XG4gICAgICAgIHRlbXAgPSBjcmVhdGVDb21wKHgsIHksIHNoaXApO1xuICAgICAgICBmaXQgPSBpc0ZpdCh0ZW1wKTtcbiAgICAgIH1cblxuICAgICAgcGxhY2VTaGlwKHgsIHksIHNoaXApO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoeCwgeSkgPT4ge1xuICAgIGlmIChib2FyZFt4XVt5XSA9PT0gbnVsbCkgbWlzc2VzLnB1c2goW3gsIHldKTtcbiAgICBlbHNlIHtcbiAgICAgIGhpdHMucHVzaChbeCwgeV0pO1xuICAgICAgYm9hcmRbeF1beV0uaGl0KCk7XG4gICAgICBib2FyZFt4XVt5XS5nZXRTaGlwKCkuaGl0Q29vci5wdXNoKFt4LCB5XSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGlzQWxsU3VuayA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IE9iamVjdC52YWx1ZXMoYWxsU2hpcHMpO1xuICAgIGxldCBzdGF0dXMgPSBmYWxzZTtcblxuICAgIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIGlmIChzaGlwLmdldFNoaXAoKS5zdW5rID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gKHN0YXR1cyA9IGZhbHNlKTtcbiAgICAgIH0gZWxzZSBzdGF0dXMgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNyZWF0ZUJvYXJkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRCb2FyZCxcbiAgICBnZXRTaGlwcyxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGdldE1pc3NlcyxcbiAgICBnZXRIaXRzLFxuICAgIGlzQWxsU3VuayxcbiAgICBwb3B1bGF0ZUJkLFxuICB9O1xufTtcblxuZXhwb3J0IHsgR2FtZWJvYXJkIH07XG4iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcblxuY29uc3QgUGxheWVyID0gKG51bWJlcikgPT4ge1xuICBsZXQgd2luID0gZmFsc2U7XG4gIGxldCBib2FyZCA9IEdhbWVib2FyZCgpO1xuICBsZXQgaXNDb21wID0gZmFsc2U7XG5cbiAgcmV0dXJuIHtcbiAgICBudW1iZXIsXG4gICAgd2luLFxuICAgIGJvYXJkLFxuICAgIGlzQ29tcCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFBsYXllciB9O1xuIiwiY29uc3QgZmlsbFNxciA9IChwbGF5ZXIsIHNxciwgdGFnLCB4LCB5KSA9PiB7XG4gIGNvbnN0IG1pc3NlcyA9IHBsYXllci5ib2FyZC5nZXRNaXNzZXMoKTtcblxuICBpZiAoc3FyID09PSBudWxsKSB7XG4gICAgaWYgKFxuICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7XCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBibHVlO1wiKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoXG4gICAgc3FyLmdldFNoaXAoKS5oaXRDb29yLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBpdGVtWzBdID09PSB4ICYmIGl0ZW1bMV0gPT09IHk7XG4gICAgfSlcbiAgKSB7XG4gICAgdGFnLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgfVxufTtcblxuY29uc3QgcmVuZGVyU2hpcCA9IChwbGF5ZXIpID0+IHtcbiAgbGV0IGJvYXJkID0gcGxheWVyLmJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IHNoaXBzT2JqID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNoaXBzTGlzdCA9IE9iamVjdC5rZXlzKHNoaXBzT2JqKTtcblxuICBzaGlwc0xpc3QuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgIGNvbnN0IGNvbXAgPSBzaGlwc09ialtzaGlwXS5nZXRTaGlwKCkuY29tcDtcblxuICAgIGlmIChjb21wLmxlbmd0aCAhPT0gMCkge1xuICAgICAgY29uc3QgeENvb3IgPSBjb21wWzBdWzBdO1xuICAgICAgY29uc3QgeUNvb3IgPSBjb21wWzBdWzFdO1xuICAgICAgcGxheWVyLmJvYXJkLnBsYWNlU2hpcCh4Q29vciwgeUNvb3IsIHNoaXBzT2JqW3NoaXBdKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBib2FyZDtcbn07XG5cbmNvbnN0IHJlbmRlckJvYXJkID0gKHBsYXllcikgPT4ge1xuICBwbGF5ZXIuYm9hcmQuY3JlYXRlQm9hcmQoKTtcblxuICByZW5kZXJTaGlwKHBsYXllcik7XG5cbiAgY29uc3QgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3QgcGxheWVyTnVtID0gcGxheWVyLm51bWJlcjtcbiAgbGV0IGN1cnJlbnRCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBib2FyZCR7cGxheWVyTnVtfWApO1xuXG4gIHdoaWxlIChjdXJyZW50Qm9hcmQubGFzdEVsZW1lbnRDaGlsZClcbiAgICBjdXJyZW50Qm9hcmQucmVtb3ZlQ2hpbGQoY3VycmVudEJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJvYXJkLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoYCR7cGxheWVyTnVtfS1zcXVhcmVgKTtcblxuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteFwiLCBgJHtpfWApO1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteVwiLCBgJHtqfWApO1xuXG4gICAgICBmaWxsU3FyKHBsYXllciwgYm9hcmRbaV1bal0sIHNxdWFyZSwgaSwgaik7XG5cbiAgICAgIGN1cnJlbnRCb2FyZC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50Qm9hcmQ7XG59O1xuXG5jb25zdCBncmFiUGxheWVyU2hpcHMgPSAocE9uZSwgcFR3bykgPT4ge1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImZvcm1cIik7XG4gIGNvbnN0IGlkID0gZm9ybS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcbiAgbGV0IHNoaXBzT2JqO1xuICBpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiXG4gICAgPyAoc2hpcHNPYmogPSBwT25lLmJvYXJkLmdldFNoaXBzKCkpXG4gICAgOiBwVHdvLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNoaXBzID0gT2JqZWN0LmtleXMoc2hpcHNPYmopO1xuICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjc2hpcHNgKTtcblxuICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICBvcHRpb24udGV4dENvbnRlbnQgPSBzaGlwO1xuICAgIHNlbGVjdGlvbi5hcHBlbmRDaGlsZChvcHRpb24pO1xuICB9KTtcblxuICByZXR1cm4gc2VsZWN0aW9uO1xufTtcblxuY29uc3QgaW5pdFBsYWNlU2hpcCA9IChwT25lLCBwVHdvKSA9PiB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGFjZVNoaXBCdG5gKTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpO1xuICAgIGxldCBpZCA9IGZvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIik7XG5cbiAgICBjb25zdCB4Q29vciA9IHBhcnNlSW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCN5LWNvb3JgKS52YWx1ZSk7XG4gICAgY29uc3QgeUNvb3IgPSBwYXJzZUludChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjeC1jb29yYCkudmFsdWUpO1xuICAgIGNvbnN0IHNoaXBOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3NoaXBzYCkudmFsdWU7XG5cbiAgICBjb25zdCBvcmllbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjb3JpZW50YXRpb25gKS52YWx1ZTtcblxuICAgIGxldCBzaGlwO1xuICAgIGlkID09PSBcInBsYXllck9uZS1mb3JtXCJcbiAgICAgID8gKHNoaXAgPSBwT25lLmJvYXJkLmdldFNoaXBzKClbc2hpcE5hbWVdKVxuICAgICAgOiAoc2hpcCA9IHBUd28uYm9hcmQuZ2V0U2hpcHMoKVtzaGlwTmFtZV0pO1xuXG4gICAgc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBvcmllbnQ7XG5cbiAgICBpZiAoTnVtYmVyLmlzTmFOKHhDb29yKSB8fCBOdW1iZXIuaXNOYU4oeUNvb3IpKSByZXR1cm47XG4gICAgZWxzZSB7XG4gICAgICBpZiAoaWQgPT09IFwicGxheWVyT25lLWZvcm1cIikge1xuICAgICAgICBwT25lLmJvYXJkLnBsYWNlU2hpcCh4Q29vciwgeUNvb3IsIHNoaXApO1xuICAgICAgICByZW5kZXJCb2FyZChwT25lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBUd28uYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcCk7XG4gICAgICAgIHJlbmRlckJvYXJkKHBUd28pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBpbml0RmluU2V0dXAgPSAocE9uZSwgcFR3bykgPT4ge1xuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNmaW5CdG5gKTtcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGZvcm1gKTtcblxuICBsZXQgaXNBbGxQbGFjZWQgPSBmYWxzZTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgbGV0IHNoaXBzT2JqO1xuICAgIGNvbnN0IG1vZGUgPSBtYWluLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpO1xuICAgIGxldCBpZCA9IGZvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIik7XG5cbiAgICBpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiXG4gICAgICA/IChzaGlwc09iaiA9IHBPbmUuYm9hcmQuZ2V0U2hpcHMoKSlcbiAgICAgIDogKHNoaXBzT2JqID0gcFR3by5ib2FyZC5nZXRTaGlwcygpKTtcblxuICAgIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhzaGlwc09iaik7XG5cbiAgICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBjb25zdCBjb21wID0gc2hpcC5nZXRTaGlwKCkuY29tcDtcbiAgICAgIGlmIChjb21wLmxlbmd0aCA9PT0gMCkgcmV0dXJuIChpc0FsbFBsYWNlZCA9IGZhbHNlKTtcbiAgICAgIGVsc2UgcmV0dXJuIChpc0FsbFBsYWNlZCA9IHRydWUpO1xuICAgIH0pO1xuXG4gICAgaWYgKGlzQWxsUGxhY2VkKSB7XG4gICAgICBpZiAoaWQgPT09IFwicGxheWVyT25lLWZvcm1cIikge1xuICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShcImlkXCIsIFwicGxheWVyVHdvLWZvcm1cIik7XG4gICAgICAgIGhpZGVCb2FyZChwT25lKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1vZGUgPT09IFwicHZjXCIgfHwgaWQgPT09IFwicGxheWVyVHdvLWZvcm1cIikge1xuICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiZGlzcGxheTogbm9uZTtcIik7XG4gICAgICAgIGhpZGVCb2FyZChwVHdvKTtcbiAgICAgICAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gICAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYWxlcnQoXCJQbGVhc2UgcGxhY2UgYWxsIHRoZSBzaGlwcyBmaXJzdFwiKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgaGlkZUJvYXJkID0gKHBsYXllcikgPT4ge1xuICBsZXQgc3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke3BsYXllci5udW1iZXJ9LXNxdWFyZWApO1xuXG4gIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyYXk7XCIpO1xuICB9KTtcbn07XG5cbmNvbnN0IGluaXRwbGF5QnRuID0gKFBPbmUsIFBUd28pID0+IHtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgY29uc3QgcGxheVdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheS13aW5kb3dcIik7XG4gIGNvbnN0IHBsYXlCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYXlcIik7XG5cbiAgcGxheUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IHBsYXllciA9IHBsYXlXaW5kb3cuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcblxuICAgIGlmIChwbGF5ZXIgPT09IFwicGxheWVyLVR3b1wiKSB7XG4gICAgICByZW5kZXJCb2FyZChQT25lKTtcbiAgICAgIHJlbmRlclBsYXlCZChQVHdvKTtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7UE9uZS5udW1iZXJ9YCk7XG4gICAgICByZXR1cm4gZGlhbG9nLmNsb3NlKCk7XG4gICAgfSBlbHNlIGlmIChwbGF5ZXIgPT09IFwicGxheWVyLU9uZVwiKSB7XG4gICAgICBjb25zdCBtb2RlID0gbWFpbi5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKTtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7UFR3by5udW1iZXJ9YCk7XG4gICAgICBpZiAobW9kZSA9PT0gXCJwdmNcIikge1xuICAgICAgICBhdXRvQXRrKFBPbmUsIFBUd28pO1xuICAgICAgICByZXR1cm4gZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZW5kZXJCb2FyZChQVHdvKTtcbiAgICAgICAgcmVuZGVyUGxheUJkKFBPbmUpO1xuICAgICAgICByZXR1cm4gZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IHJlbmRlclBsYXlCZCA9IChwbGF5ZXIpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3QgbWlzc2VzID0gcGxheWVyLmJvYXJkLmdldE1pc3NlcygpO1xuICBjb25zdCBjdXJyQm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjYm9hcmQke3BsYXllci5udW1iZXJ9YCk7XG5cbiAgd2hpbGUgKGN1cnJCb2FyZC5sYXN0RWxlbWVudENoaWxkKVxuICAgIGN1cnJCb2FyZC5yZW1vdmVDaGlsZChjdXJyQm9hcmQubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm9hcmQubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBib2FyZFtpXVtqXTtcblxuICAgICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKGAke3BsYXllci5udW1iZXJ9LXNxdWFyZWApO1xuXG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS14XCIsIGAke2l9YCk7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS15XCIsIGAke2p9YCk7XG5cbiAgICAgIGluaXRTcXJCdG4ocGxheWVyLCBzcXVhcmUpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0gIT09IG51bGwgJiZcbiAgICAgICAgaXRlbS5nZXRTaGlwKCkuaGl0Q291bnQgPiAwICYmXG4gICAgICAgIGl0ZW0uZ2V0U2hpcCgpLmhpdENvb3IuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICAgIHJldHVybiBpdGVtWzBdID09PSBpICYmIGl0ZW1bMV0gPT09IGo7XG4gICAgICAgIH0pXG4gICAgICApIHtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIG1pc3Nlcy5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IGkgJiYgaXRlbVsxXSA9PT0gajtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjtcIik7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICAgIH1cblxuICAgICAgY3VyckJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBpbml0U3FyQnRuID0gKHBsYXllciwgc3F1YXJlKSA9PiB7XG4gIGNvbnN0IGJvYXJkID0gcGxheWVyLmJvYXJkO1xuICBjb25zdCBib2FyZExpc3QgPSBib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgY29uc3QgeCA9IHBhcnNlSW50KHNxdWFyZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIikpO1xuICBjb25zdCB5ID0gcGFyc2VJbnQoc3F1YXJlLmdldEF0dHJpYnV0ZShcImRhdGEteVwiKSk7XG5cbiAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgaWYgKGJvYXJkTGlzdFt4XVt5XSA9PT0gbnVsbCkge1xuICAgICAgaGlkZUJvYXJkKHBsYXllcik7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjtcIik7XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGNvbXBNb2RlID0gKHBsYXllcikgPT4ge1xuICBwbGF5ZXIuYm9hcmQucG9wdWxhdGVCZCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXIpO1xuICBoaWRlQm9hcmQocGxheWVyKTtcbn07XG5cbmNvbnN0IGF1dG9BdGsgPSAocGxheU9uZSwgcGxheVR3bykgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXlPbmUuYm9hcmQ7XG4gIGNvbnN0IGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IG1pc3NlcyA9IGJvYXJkLmdldE1pc3NlcygpO1xuICBjb25zdCBoaXRzID0gYm9hcmQuZ2V0SGl0cygpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICBsZXQgY29udCA9IHRydWU7XG5cbiAgd2hpbGUgKGNvbnQgPT09IHRydWUpIHtcbiAgICBpZiAoXG4gICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSkgfHxcbiAgICAgIGhpdHMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcblxuICAgIGlmIChib2FyZExpc3RbeF1beV0gPT09IG51bGwpIHtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7cGxheU9uZS5udW1iZXJ9YCk7XG4gICAgICByZW5kZXJCb2FyZChwbGF5T25lKTtcbiAgICAgIHJlbmRlclBsYXlCZChwbGF5VHdvKTtcbiAgICAgIGNvbnQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQge1xuICByZW5kZXJCb2FyZCxcbiAgZ3JhYlBsYXllclNoaXBzLFxuICBpbml0UGxhY2VTaGlwLFxuICBpbml0RmluU2V0dXAsXG4gIGluaXRwbGF5QnRuLFxuICBjb21wTW9kZSxcbn07XG4iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCB7XG4gIHJlbmRlckJvYXJkLFxuICBncmFiUGxheWVyU2hpcHMsXG4gIGluaXRQbGFjZVNoaXAsXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxufSBmcm9tIFwiLi9ET01cIjtcblxuY29uc3QgZ2FtZU1vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWVfbW9kZVwiKTtcbmNvbnN0IHB2cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHZwXCIpO1xuY29uc3QgcHZjQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwdmNcIik7XG5jb25zdCBwbGF5ZXJPbmUgPSBQbGF5ZXIoXCJPbmVcIik7XG5jb25zdCBwbGF5ZXJUd28gPSBQbGF5ZXIoXCJUd29cIik7XG5cbnB2cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJPbmUpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJUd28pO1xuXG4gIGdyYWJQbGF5ZXJTaGlwcyhwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgaW5pdFBsYWNlU2hpcChwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgaW5pdEZpblNldHVwKHBsYXllck9uZSwgcGxheWVyVHdvKTtcblxuICBpbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgcmV0dXJuIGdhbWVNb2RlLmNsb3NlKCk7XG59KTtcblxucHZjQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuXG4gIHJlbmRlckJvYXJkKHBsYXllck9uZSk7XG4gIHJlbmRlckJvYXJkKHBsYXllclR3byk7XG4gIGdyYWJQbGF5ZXJTaGlwcyhwbGF5ZXJPbmUsIHBsYXllclR3byk7XG4gIGluaXRQbGFjZVNoaXAocGxheWVyT25lLCBwbGF5ZXJUd28pO1xuICBpbml0RmluU2V0dXAocGxheWVyT25lLCBwbGF5ZXJUd28pO1xuICBpbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgY29tcE1vZGUocGxheWVyVHdvKTtcblxuICBtYWluLmNsYXNzTGlzdC5hZGQoXCJwdmNcIik7XG5cbiAgcmV0dXJuIGdhbWVNb2RlLmNsb3NlKCk7XG59KTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubG9hZFwiLCBnYW1lTW9kZS5zaG93TW9kYWwoKSk7XG4iXSwibmFtZXMiOlsiU2hpcCIsIm4iLCJzaGlwT2JqIiwiZ2V0U2hpcCIsImhpdCIsImhpdENvdW50IiwibGVuZ3RoIiwic3VuayIsImlzU3VuayIsIkdhbWVib2FyZCIsImJvYXJkIiwibWlzc2VzIiwiaGl0cyIsImFsbFNoaXBzIiwibF9zaGlwIiwibV9zaGlwX0kiLCJtX3NoaXBfSUkiLCJzX3NoaXBfSSIsInNfc2hpcF9JSSIsInNfc2hpcF9JSUkiLCJ4c19zaGlwX0kiLCJ4c19zaGlwX0lJIiwieHNfc2hpcF9JSUkiLCJ4c19zaGlwX0lWIiwiaXNGaXQiLCJhcnIiLCJzdGF0dXMiLCJmb3JFYWNoIiwiaXRlbSIsIngiLCJ5IiwiY3JlYXRlQ29tcCIsInNoaXAiLCJ0ZW1wIiwiYSIsImIiLCJvcmllbnRhdGlvbiIsInB1c2giLCJwbGFjZVNoaXAiLCJhbGVydCIsImNvbXAiLCJjcmVhdGVCb2FyZCIsImkiLCJqIiwiZ2V0Qm9hcmQiLCJnZXRTaGlwcyIsInJlY2VpdmVBdHRhY2siLCJoaXRDb29yIiwiZ2V0TWlzc2VzIiwiZ2V0SGl0cyIsImlzQWxsU3VuayIsInNoaXBzIiwiT2JqZWN0IiwidmFsdWVzIiwicG9wdWxhdGVCZCIsImtleXMiLCJkaXJlY3Rpb25zIiwia2V5IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwieiIsImZpdCIsIlBsYXllciIsIm51bWJlciIsIndpbiIsImlzQ29tcCIsImZpbGxTcXIiLCJwbGF5ZXIiLCJzcXIiLCJ0YWciLCJmaW5kIiwic2V0QXR0cmlidXRlIiwicmVuZGVyQm9hcmQiLCJzaGlwc09iaiIsInhDb29yIiwieUNvb3IiLCJyZW5kZXJTaGlwIiwicGxheWVyTnVtIiwiY3VycmVudEJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImxhc3RFbGVtZW50Q2hpbGQiLCJyZW1vdmVDaGlsZCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsImdyYWJQbGF5ZXJTaGlwcyIsInBPbmUiLCJwVHdvIiwicXVlcnlTZWxlY3RvciIsImdldEF0dHJpYnV0ZSIsInNlbGVjdGlvbiIsIm9wdGlvbiIsInRleHRDb250ZW50IiwiaW5pdFBsYWNlU2hpcCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJpZCIsInBhcnNlSW50IiwidmFsdWUiLCJzaGlwTmFtZSIsIm9yaWVudCIsIk51bWJlciIsImlzTmFOIiwiaW5pdEZpblNldHVwIiwibWFpbiIsImJ1dHRvbiIsImZvcm0iLCJpc0FsbFBsYWNlZCIsIm1vZGUiLCJoaWRlQm9hcmQiLCJzaG93TW9kYWwiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5pdHBsYXlCdG4iLCJQT25lIiwiUFR3byIsImRpYWxvZyIsInBsYXlXaW5kb3ciLCJyZW5kZXJQbGF5QmQiLCJjbG9zZSIsImF1dG9BdGsiLCJjdXJyQm9hcmQiLCJpbml0U3FyQnRuIiwiYm9hcmRMaXN0IiwicGxheU9uZSIsInBsYXlUd28iLCJjb250IiwiZ2FtZU1vZGUiLCJwdnBCdG4iLCJwdmNCdG4iLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iXSwic291cmNlUm9vdCI6IiJ9