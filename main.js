(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk}},t=()=>{let t=[],r=[],o={l_ship:e(4),m_ship_I:e(3),m_ship_II:e(3),s_ship_I:e(2),s_ship_II:e(2),s_ship_III:e(2),xs_ship_I:e(1),xs_ship_II:e(1),xs_ship_III:e(1),xs_ship_IV:e(1)};const n=e=>{let r=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(o=e[0],n=e[1],null!==t[o][n]))return r=!1;var o,n})),r},l=(e,t,r)=>{const o=r.getShip().length;let n=[],l=e,a=t;if("horizontal"===r.getShip().orientation)for(;a!==t+o;)n.push([e,a]),a+=1;else for(;l!==e+o;)n.push([l,t]),l+=1;return n},a=(e,r,o)=>{let a=[],i=!0;return r+length-1>9||e>9||e+length-1>9||r>9?console.log("error"):(a=l(e,r,o),i=n(a),!1===i?(i=!0,a=[],console.log("not empty")):(o.getShip().comp=a,o.getShip().comp.forEach((e=>{t[e[0]][e[1]]=o})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e][r]=null}return t},placeShip:a,getBoard:()=>t,getShips:()=>o,receiveAttack:(e,o)=>(null===t[e][o]?r.push([e,o]):(t[e][o].hit(),t[e][o].getShip().hitCoor.push([e,o])),t),getMisses:()=>r,isAllSunk:()=>{const e=Object.values(o);let t=!1;return e.forEach((e=>{if(!1===e.getShip().sunk)return t=!1;t=!0})),t},populateBd:()=>{const e=Object.keys(o),r=["horizontal","vertical"];return e.forEach((e=>{const t=o[e],i=t.getShip().length;let u=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),c=Math.floor(2*Math.random());t.getShip().orientation=r[c];let d=l(u,s,t),p=n(d);for(;s+i-1>9||u+i-1>9||!1===p;)u=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),c=Math.floor(2*Math.random()),t.getShip().orientation=r[c],d=l(u,s,t),p=n(d);a(u,s,t)})),t}}},r=e=>({number:e,win:!1,board:t(),isComp:!1}),o=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((r=>{const o=t[r].getShip().comp;if(0!==o.length){const n=o[0][0],l=o[0][1];e.board.placeShip(n,l,t[r])}}))})(e);const t=e.board.getBoard(),r=e.number;let o=document.getElementById(`board${r}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++){const l=document.createElement("div");l.classList.add(`${r}-square`),l.setAttribute("data-x",`${e}`),l.setAttribute("data-y",`${n}`),null===t[e][n]&&l.setAttribute("style","background-color: blue;"),o.appendChild(l)}return o},n=e=>{const t=e.board.getShips(),r=Object.keys(t),o=document.querySelector(`#player${e.number}-ships`);return r.forEach((e=>{const t=document.createElement("option");t.textContent=e,o.appendChild(t)})),o},l=e=>{document.querySelector(`#placeShipBtn-${e.number}`).addEventListener("click",(t=>{t.preventDefault();const r=parseInt(document.querySelector(`#player${e.number}-y`).value),n=parseInt(document.querySelector(`#player${e.number}-x`).value),l=document.querySelector(`#player${e.number}-ships`).value,a=document.querySelector(`#player${e.number}-orient`).value,i=e.board.getShips()[l];i.getShip().orientation=a,console.log(a),e.board.placeShip(r,n,i),o(e)}))},a=e=>{const t=e.number,r=document.querySelector(`#player${t}`),o=document.createElement("form"),n=document.createElement("select"),l=document.createElement("select"),a=document.createElement("input"),i=document.createElement("input"),u=document.createElement("button"),s=document.createElement("option"),c=document.createElement("option"),d=document.createElement("button");return o.setAttribute("id",`player${t}-form`),n.setAttribute("name","ships"),n.setAttribute("id",`player${t}-ships`),l.setAttribute("name","orientation"),l.setAttribute("id",`player${t}-orient`),a.setAttribute("type","text"),a.setAttribute("id",`player${t}-x`),a.setAttribute("name","x-coor"),a.setAttribute("placeholder","x"),i.setAttribute("type","text"),i.setAttribute("id",`player${t}-y`),i.setAttribute("name","y-coor"),i.setAttribute("placeholder","y"),u.setAttribute("id",`placeShipBtn-${t}`),u.textContent="Place",d.setAttribute("id",`player${t}-finBtn`),d.textContent="Finish set up",s.textContent="horizontal",c.textContent="vertical",l.append(s,c),o.append(n,a,i,l,u,d),r.appendChild(o),r},i=e=>{const t=document.querySelector(`#player${e.number}-finBtn`),r=document.querySelector(`#player${e.number}-form`),o=e.board.getShips(),n=Object.values(o);let l=!1;n.forEach((e=>{if(0!==e.getShip().comp.length)return l=!1;l=!0})),t.addEventListener("click",(t=>{t.preventDefault(),n.forEach((e=>{if(0!==e.getShip().comp.length)return l=!1;l=!0})),l?r.setAttribute("style","display: none;"):console.log("Please place all the ships first"),u(e),"Two"===e.number&&document.querySelector(".dialog").showModal()}))},u=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},s=e=>{const t=e.board.getBoard(),r=e.board.getMisses(),o=document.querySelector(`#board${e.number}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let n=0;n<t.length;n++)for(let l=0;l<t.length;l++){const a=t[n][l],i=document.createElement("button");i.classList.add(`${e.number}-square`),i.setAttribute("data-x",`${n}`),i.setAttribute("data-y",`${l}`),c(e,i),null!==a&&a.getShip().hitCount>0&&a.getShip().hitCoor.find((e=>e[0]===`${n}`&&e[1]===`${l}`))&&(i.setAttribute("style","background-color: red;"),i.setAttribute("disabled","")),r.find((e=>e[0]===`${n}`&&e[1]===`${l}`))&&(i.setAttribute("style","background-color: green;"),i.setAttribute("disabled","")),o.appendChild(i)}},c=(e,t)=>{const r=e.board,o=r.getBoard(),n=document.querySelector(".dialog"),l=t.getAttribute("data-x"),a=t.getAttribute("data-y");t.addEventListener("click",(i=>{i.preventDefault(),r.receiveAttack(l,a),null===o[l][a]?(u(e),t.setAttribute("style","background-color: red;"),n.showModal()):t.setAttribute("style","background-color: green;")}))};let d=r("One"),p=r("Two");var h;o(d),o(p),a(d),a(p),n(d),n(p),l(d),l(p),i(d),i(p),((e,t)=>{const r=document.querySelector(".dialog"),n=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(l=>{l.preventDefault();let a=n.getAttribute("data-id");return"player-Two"===a?(o(e),s(t),n.setAttribute("data-id",`player-${e.number}`),r.close()):"player-One"===a?(o(t),s(e),n.setAttribute("data-id",`player-${t.number}`),r.close()):void 0}))})(d,p),(h=p).board.populateBd(),o(h)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUFBYSxXQUVyQyxNQUFlLGVBQVhwRCxHQUNGRCxFQUFZd0QsR0FDWlQsRUFBYVUsR0FDYkMsRUFBVzFDLGFBQWEsVUFBVyxVQUFVd0MsRUFBSzNELFVBQzNDdUQsRUFBT08sU0FDTSxlQUFYMUQsR0FDVEQsRUFBWXlELEdBQ1pWLEVBQWFTLEdBQ2JFLEVBQVcxQyxhQUFhLFVBQVcsVUFBVXlDLEVBQUs1RCxVQUMzQ3VELEVBQU9PLGNBSlQsQ0FLUCxHQUNBLEVDckxKQyxDQUFZTixFQUFXQyxJRDBQTHRELEVDeFBUc0QsR0R5UEEvRyxNQUFNMkMsYUFDYmEsRUFBWUMsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9ET00uanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IChuKSA9PiB7XG4gIGxldCBzaGlwT2JqID0ge307XG5cbiAgc2hpcE9ialtcImxlbmd0aFwiXSA9IG47XG4gIHNoaXBPYmpbXCJoaXRDb3VudFwiXSA9IDA7XG4gIHNoaXBPYmpbXCJzdW5rXCJdID0gZmFsc2U7XG4gIHNoaXBPYmpbXCJvcmllbnRhdGlvblwiXSA9IFwiaG9yaXpvbnRhbFwiO1xuICBzaGlwT2JqW1wiY29tcFwiXSA9IFtdO1xuICBzaGlwT2JqW1wiaGl0Q29vclwiXSA9IFtdO1xuXG4gIGNvbnN0IGdldFNoaXAgPSAoKSA9PiBzaGlwT2JqO1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBzaGlwT2JqLmhpdENvdW50ICs9IDE7XG4gICAgaWYgKHNoaXBPYmouaGl0Q291bnQgPT09IHNoaXBPYmoubGVuZ3RoKSBzaGlwT2JqLnN1bmsgPSB0cnVlO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcE9iai5zdW5rID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0U2hpcCxcbiAgICBoaXQsXG4gICAgaXNTdW5rLFxuICB9O1xufTtcblxuZXhwb3J0IHsgU2hpcCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcblxuY29uc3QgR2FtZWJvYXJkID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXTtcbiAgbGV0IG1pc3NlcyA9IFtdO1xuXG4gIGxldCBhbGxTaGlwcyA9IHtcbiAgICBsX3NoaXA6IFNoaXAoNCksXG4gICAgbV9zaGlwX0k6IFNoaXAoMyksXG4gICAgbV9zaGlwX0lJOiBTaGlwKDMpLFxuICAgIHNfc2hpcF9JOiBTaGlwKDIpLFxuICAgIHNfc2hpcF9JSTogU2hpcCgyKSxcbiAgICBzX3NoaXBfSUlJOiBTaGlwKDIpLFxuICAgIHhzX3NoaXBfSTogU2hpcCgxKSxcbiAgICB4c19zaGlwX0lJOiBTaGlwKDEpLFxuICAgIHhzX3NoaXBfSUlJOiBTaGlwKDEpLFxuICAgIHhzX3NoaXBfSVY6IFNoaXAoMSksXG4gIH07XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiBib2FyZDtcbiAgY29uc3QgZ2V0TWlzc2VzID0gKCkgPT4gbWlzc2VzO1xuICBjb25zdCBnZXRTaGlwcyA9ICgpID0+IGFsbFNoaXBzO1xuXG4gIGNvbnN0IGNyZWF0ZUJvYXJkID0gKCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgYm9hcmRbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBib2FyZFtpXVtqXSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGlzRW1wdHkgPSAoeCwgeSkgPT4ge1xuICAgIHJldHVybiBib2FyZFt4XVt5XSA9PT0gbnVsbCA/IHRydWUgOiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBpc0ZpdCA9IChhcnIpID0+IHtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIGFyci5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBpZiAoaXRlbVswXSA+IDkgfHwgaXRlbVsxXSA+IDkgfHwgIWlzRW1wdHkoaXRlbVswXSwgaXRlbVsxXSkpXG4gICAgICAgIHJldHVybiAoc3RhdHVzID0gZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfTtcblxuICBjb25zdCBjcmVhdGVDb21wID0gKHgsIHksIHNoaXApID0+IHtcbiAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG4gICAgY29uc3Qgb3JpZW50YXRpb24gPSBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbjtcbiAgICBsZXQgdGVtcCA9IFtdO1xuICAgIGxldCBhID0geDtcbiAgICBsZXQgYiA9IHk7XG5cbiAgICBpZiAob3JpZW50YXRpb24gPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICB3aGlsZSAoYiAhPT0geSArIGxlbmd0aCkge1xuICAgICAgICB0ZW1wLnB1c2goW3gsIGJdKTtcbiAgICAgICAgYiArPSAxO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB3aGlsZSAoYSAhPT0geCArIGxlbmd0aCkge1xuICAgICAgICB0ZW1wLnB1c2goW2EsIHldKTtcbiAgICAgICAgYSArPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0ZW1wO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9ICh4LCB5LCBzaGlwKSA9PiB7XG4gICAgbGV0IHRlbXAgPSBbXTtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIGlmICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IHkgPiA5KSB7XG4gICAgICByZXR1cm4gY29uc29sZS5sb2coXCJlcnJvclwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBzdGF0dXMgPSBpc0ZpdCh0ZW1wKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdHVzID09PSBmYWxzZSkge1xuICAgICAgc3RhdHVzID0gdHJ1ZTtcbiAgICAgIHRlbXAgPSBbXTtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcIm5vdCBlbXB0eVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hpcC5nZXRTaGlwKCkuY29tcCA9IHRlbXA7XG5cbiAgICAgIHNoaXAuZ2V0U2hpcCgpLmNvbXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBib2FyZFtpdGVtWzBdXVtpdGVtWzFdXSA9IHNoaXA7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcG9wdWxhdGVCZCA9ICgpID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYWxsU2hpcHMpO1xuICAgIGNvbnN0IGRpcmVjdGlvbnMgPSBbXCJob3Jpem9udGFsXCIsIFwidmVydGljYWxcIl07XG5cbiAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgY29uc3Qgc2hpcCA9IGFsbFNoaXBzW2tleV07XG4gICAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG5cbiAgICAgIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IGRpcmVjdGlvbnNbel07XG4gICAgICBsZXQgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBsZXQgZml0ID0gaXNGaXQodGVtcCk7XG5cbiAgICAgIHdoaWxlICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IGZpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyZWN0aW9uc1t6XTtcbiAgICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICAgIGZpdCA9IGlzRml0KHRlbXApO1xuICAgICAgfVxuXG4gICAgICBwbGFjZVNoaXAoeCwgeSwgc2hpcCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9ICh4LCB5KSA9PiB7XG4gICAgaWYgKGJvYXJkW3hdW3ldID09PSBudWxsKSBtaXNzZXMucHVzaChbeCwgeV0pO1xuICAgIGVsc2Uge1xuICAgICAgYm9hcmRbeF1beV0uaGl0KCk7XG4gICAgICBib2FyZFt4XVt5XS5nZXRTaGlwKCkuaGl0Q29vci5wdXNoKFt4LCB5XSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGlzQWxsU3VuayA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IE9iamVjdC52YWx1ZXMoYWxsU2hpcHMpO1xuICAgIGxldCBzdGF0dXMgPSBmYWxzZTtcblxuICAgIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIGlmIChzaGlwLmdldFNoaXAoKS5zdW5rID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gKHN0YXR1cyA9IGZhbHNlKTtcbiAgICAgIH0gZWxzZSBzdGF0dXMgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNyZWF0ZUJvYXJkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRCb2FyZCxcbiAgICBnZXRTaGlwcyxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGdldE1pc3NlcyxcbiAgICBpc0FsbFN1bmssXG4gICAgcG9wdWxhdGVCZCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IEdhbWVib2FyZCB9O1xuIiwiaW1wb3J0IHsgR2FtZWJvYXJkIH0gZnJvbSBcIi4vZ2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9IChudW1iZXIpID0+IHtcbiAgbGV0IHdpbiA9IGZhbHNlO1xuICBsZXQgYm9hcmQgPSBHYW1lYm9hcmQoKTtcbiAgbGV0IGlzQ29tcCA9IGZhbHNlO1xuXG4gIHJldHVybiB7XG4gICAgbnVtYmVyLFxuICAgIHdpbixcbiAgICBib2FyZCxcbiAgICBpc0NvbXAsXG4gIH07XG59O1xuXG5leHBvcnQgeyBQbGF5ZXIgfTtcbiIsImNvbnN0IGZpbGxTcXIgPSAoc3FyLCB0YWcpID0+IHtcbiAgaWYgKHNxciA9PT0gbnVsbCkge1xuICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGJsdWU7XCIpO1xuICB9XG59O1xuXG5jb25zdCByZW5kZXJTaGlwID0gKHBsYXllcikgPT4ge1xuICBsZXQgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHNMaXN0ID0gT2JqZWN0LmtleXMoc2hpcHNPYmopO1xuXG4gIHNoaXBzTGlzdC5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29tcCA9IHNoaXBzT2JqW3NoaXBdLmdldFNoaXAoKS5jb21wO1xuXG4gICAgaWYgKGNvbXAubGVuZ3RoICE9PSAwKSB7XG4gICAgICBjb25zdCB4Q29vciA9IGNvbXBbMF1bMF07XG4gICAgICBjb25zdCB5Q29vciA9IGNvbXBbMF1bMV07XG4gICAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcHNPYmpbc2hpcF0pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGJvYXJkO1xufTtcblxuY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIHBsYXllci5ib2FyZC5jcmVhdGVCb2FyZCgpO1xuXG4gIHJlbmRlclNoaXAocGxheWVyKTtcblxuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBwbGF5ZXJOdW0gPSBwbGF5ZXIubnVtYmVyO1xuICBsZXQgY3VycmVudEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJvYXJkJHtwbGF5ZXJOdW19YCk7XG5cbiAgd2hpbGUgKGN1cnJlbnRCb2FyZC5sYXN0RWxlbWVudENoaWxkKVxuICAgIGN1cnJlbnRCb2FyZC5yZW1vdmVDaGlsZChjdXJyZW50Qm9hcmQubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm9hcmQubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwbGF5ZXJOdW19LXNxdWFyZWApO1xuXG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS14XCIsIGAke2l9YCk7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS15XCIsIGAke2p9YCk7XG5cbiAgICAgIGZpbGxTcXIoYm9hcmRbaV1bal0sIHNxdWFyZSk7XG5cbiAgICAgIGN1cnJlbnRCb2FyZC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50Qm9hcmQ7XG59O1xuXG5jb25zdCBncmFiUGxheWVyU2hpcHMgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IHNoaXBzT2JqID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNoaXBzID0gT2JqZWN0LmtleXMoc2hpcHNPYmopO1xuICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxheWVyJHtwbGF5ZXIubnVtYmVyfS1zaGlwc2ApO1xuXG4gIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgIG9wdGlvbi50ZXh0Q29udGVudCA9IHNoaXA7XG4gICAgc2VsZWN0aW9uLmFwcGVuZENoaWxkKG9wdGlvbik7XG4gIH0pO1xuXG4gIHJldHVybiBzZWxlY3Rpb247XG59O1xuXG5jb25zdCBpbml0UGxhY2VTaGlwID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxhY2VTaGlwQnRuLSR7cGxheWVyLm51bWJlcn1gKTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgY29uc3QgeENvb3IgPSBwYXJzZUludChcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LXlgKS52YWx1ZVxuICAgICk7XG4gICAgY29uc3QgeUNvb3IgPSBwYXJzZUludChcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LXhgKS52YWx1ZVxuICAgICk7XG4gICAgY29uc3Qgc2hpcE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LXNoaXBzYFxuICAgICkudmFsdWU7XG5cbiAgICBjb25zdCBvcmllbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LW9yaWVudGBcbiAgICApLnZhbHVlO1xuXG4gICAgY29uc3Qgc2hpcCA9IHBsYXllci5ib2FyZC5nZXRTaGlwcygpW3NoaXBOYW1lXTtcblxuICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gb3JpZW50O1xuICAgIGNvbnNvbGUubG9nKG9yaWVudCk7XG5cbiAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcCk7XG4gICAgcmVuZGVyQm9hcmQocGxheWVyKTtcbiAgfSk7XG59O1xuXG5jb25zdCByZW5kZXJGb3JtID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBwbGF5ZXJObyA9IHBsYXllci5udW1iZXI7XG5cbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllck5vfWApO1xuXG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9ybVwiKTtcbiAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTtcbiAgY29uc3Qgb3JpZW50YXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuICBjb25zdCBpbnB1dFggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gIGNvbnN0IGlucHV0WSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgY29uc3QgY3Jvc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICBjb25zdCBsb25nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgY29uc3QgZmluID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcblxuICBmb3JtLnNldEF0dHJpYnV0ZShcImlkXCIsIGBwbGF5ZXIke3BsYXllck5vfS1mb3JtYCk7XG5cbiAgc2VsZWN0aW9uLnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJzaGlwc1wiKTtcbiAgc2VsZWN0aW9uLnNldEF0dHJpYnV0ZShcImlkXCIsIGBwbGF5ZXIke3BsYXllck5vfS1zaGlwc2ApO1xuXG4gIG9yaWVudGF0aW9uLnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJvcmllbnRhdGlvblwiKTtcbiAgb3JpZW50YXRpb24uc2V0QXR0cmlidXRlKFwiaWRcIiwgYHBsYXllciR7cGxheWVyTm99LW9yaWVudGApO1xuXG4gIGlucHV0WC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dFwiKTtcbiAgaW5wdXRYLnNldEF0dHJpYnV0ZShcImlkXCIsIGBwbGF5ZXIke3BsYXllck5vfS14YCk7XG4gIGlucHV0WC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwieC1jb29yXCIpO1xuICBpbnB1dFguc2V0QXR0cmlidXRlKFwicGxhY2Vob2xkZXJcIiwgXCJ4XCIpO1xuXG4gIGlucHV0WS5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dFwiKTtcbiAgaW5wdXRZLnNldEF0dHJpYnV0ZShcImlkXCIsIGBwbGF5ZXIke3BsYXllck5vfS15YCk7XG4gIGlucHV0WS5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwieS1jb29yXCIpO1xuICBpbnB1dFkuc2V0QXR0cmlidXRlKFwicGxhY2Vob2xkZXJcIiwgXCJ5XCIpO1xuXG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBgcGxhY2VTaGlwQnRuLSR7cGxheWVyTm99YCk7XG4gIGJ1dHRvbi50ZXh0Q29udGVudCA9IFwiUGxhY2VcIjtcblxuICBmaW4uc2V0QXR0cmlidXRlKFwiaWRcIiwgYHBsYXllciR7cGxheWVyTm99LWZpbkJ0bmApO1xuICBmaW4udGV4dENvbnRlbnQgPSBcIkZpbmlzaCBzZXQgdXBcIjtcblxuICBjcm9zcy50ZXh0Q29udGVudCA9IFwiaG9yaXpvbnRhbFwiO1xuICBsb25nLnRleHRDb250ZW50ID0gXCJ2ZXJ0aWNhbFwiO1xuXG4gIG9yaWVudGF0aW9uLmFwcGVuZChjcm9zcywgbG9uZyk7XG4gIGZvcm0uYXBwZW5kKHNlbGVjdGlvbiwgaW5wdXRYLCBpbnB1dFksIG9yaWVudGF0aW9uLCBidXR0b24sIGZpbik7XG4gIG1haW4uYXBwZW5kQ2hpbGQoZm9ybSk7XG5cbiAgcmV0dXJuIG1haW47XG59O1xuXG5jb25zdCBpbml0RmluU2V0dXAgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LWZpbkJ0bmApO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyLm51bWJlcn0tZm9ybWApO1xuICBjb25zdCBzaGlwc09iaiA9IHBsYXllci5ib2FyZC5nZXRTaGlwcygpO1xuICBjb25zdCBzaGlwcyA9IE9iamVjdC52YWx1ZXMoc2hpcHNPYmopO1xuICBsZXQgaXNBbGxQbGFjZWQgPSBmYWxzZTtcblxuICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29tcCA9IHNoaXAuZ2V0U2hpcCgpLmNvbXA7XG4gICAgaWYgKGNvbXAubGVuZ3RoICE9PSAwKSByZXR1cm4gKGlzQWxsUGxhY2VkID0gZmFsc2UpO1xuICAgIGVsc2UgaXNBbGxQbGFjZWQgPSB0cnVlO1xuICB9KTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgY29uc3QgY29tcCA9IHNoaXAuZ2V0U2hpcCgpLmNvbXA7XG4gICAgICBpZiAoY29tcC5sZW5ndGggIT09IDApIHJldHVybiAoaXNBbGxQbGFjZWQgPSBmYWxzZSk7XG4gICAgICBlbHNlIGlzQWxsUGxhY2VkID0gdHJ1ZTtcbiAgICB9KTtcblxuICAgIGlzQWxsUGxhY2VkXG4gICAgICA/IGZvcm0uc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBub25lO1wiKVxuICAgICAgOiBjb25zb2xlLmxvZyhcIlBsZWFzZSBwbGFjZSBhbGwgdGhlIHNoaXBzIGZpcnN0XCIpO1xuXG4gICAgaGlkZUJvYXJkKHBsYXllcik7XG5cbiAgICBpZiAocGxheWVyLm51bWJlciA9PT0gXCJUd29cIikge1xuICAgICAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGhpZGVCb2FyZCA9IChwbGF5ZXIpID0+IHtcbiAgbGV0IHNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuJHtwbGF5ZXIubnVtYmVyfS1zcXVhcmVgKTtcblxuICBzcXVhcmVzLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmF5O1wiKTtcbiAgfSk7XG59O1xuXG5jb25zdCBpbml0cGxheUJ0biA9IChQT25lLCBQVHdvKSA9PiB7XG4gIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlhbG9nXCIpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheVwiKTtcblxuICBwbGF5QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgcGxheWVyID0gcGxheVdpbmRvdy5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuXG4gICAgaWYgKHBsYXllciA9PT0gXCJwbGF5ZXItVHdvXCIpIHtcbiAgICAgIHJlbmRlckJvYXJkKFBPbmUpO1xuICAgICAgcmVuZGVyUGxheUJkKFBUd28pO1xuICAgICAgcGxheVdpbmRvdy5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGBwbGF5ZXItJHtQT25lLm51bWJlcn1gKTtcbiAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICB9IGVsc2UgaWYgKHBsYXllciA9PT0gXCJwbGF5ZXItT25lXCIpIHtcbiAgICAgIHJlbmRlckJvYXJkKFBUd28pO1xuICAgICAgcmVuZGVyUGxheUJkKFBPbmUpO1xuICAgICAgcGxheVdpbmRvdy5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGBwbGF5ZXItJHtQVHdvLm51bWJlcn1gKTtcbiAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgcmVuZGVyUGxheUJkID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBtaXNzZXMgPSBwbGF5ZXIuYm9hcmQuZ2V0TWlzc2VzKCk7XG4gIGNvbnN0IGN1cnJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNib2FyZCR7cGxheWVyLm51bWJlcn1gKTtcblxuICB3aGlsZSAoY3VyckJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpXG4gICAgY3VyckJvYXJkLnJlbW92ZUNoaWxkKGN1cnJCb2FyZC5sYXN0RWxlbWVudENoaWxkKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBib2FyZC5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgaXRlbSA9IGJvYXJkW2ldW2pdO1xuXG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoYCR7cGxheWVyLm51bWJlcn0tc3F1YXJlYCk7XG5cbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIiwgYCR7aX1gKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIiwgYCR7an1gKTtcblxuICAgICAgaW5pdFNxckJ0bihwbGF5ZXIsIHNxdWFyZSk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbSAhPT0gbnVsbCAmJlxuICAgICAgICBpdGVtLmdldFNoaXAoKS5oaXRDb3VudCA+IDAgJiZcbiAgICAgICAgaXRlbS5nZXRTaGlwKCkuaGl0Q29vci5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IGAke2l9YCAmJiBpdGVtWzFdID09PSBgJHtqfWA7XG4gICAgICAgIH0pXG4gICAgICApIHtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIG1pc3Nlcy5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IGAke2l9YCAmJiBpdGVtWzFdID09PSBgJHtqfWA7XG4gICAgICAgIH0pXG4gICAgICApIHtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogZ3JlZW47XCIpO1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICB9XG5cbiAgICAgIGN1cnJCb2FyZC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgIH1cbiAgfVxufTtcblxuY29uc3QgaW5pdFNxckJ0biA9IChwbGF5ZXIsIHNxdWFyZSkgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZDtcbiAgY29uc3QgYm9hcmRMaXN0ID0gYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gIGNvbnN0IHggPSBzcXVhcmUuZ2V0QXR0cmlidXRlKFwiZGF0YS14XCIpO1xuICBjb25zdCB5ID0gc3F1YXJlLmdldEF0dHJpYnV0ZShcImRhdGEteVwiKTtcblxuICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICBpZiAoYm9hcmRMaXN0W3hdW3ldID09PSBudWxsKSB7XG4gICAgICBoaWRlQm9hcmQocGxheWVyKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHJlZDtcIik7XG4gICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgY29tcE1vZGUgPSAocGxheWVyKSA9PiB7XG4gIHBsYXllci5ib2FyZC5wb3B1bGF0ZUJkKCk7XG4gIHJlbmRlckJvYXJkKHBsYXllcik7XG59O1xuXG5leHBvcnQge1xuICByZW5kZXJCb2FyZCxcbiAgZ3JhYlBsYXllclNoaXBzLFxuICBpbml0UGxhY2VTaGlwLFxuICByZW5kZXJGb3JtLFxuICBpbml0RmluU2V0dXAsXG4gIGluaXRwbGF5QnRuLFxuICBjb21wTW9kZSxcbn07XG4iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCB7XG4gIHJlbmRlckJvYXJkLFxuICBncmFiUGxheWVyU2hpcHMsXG4gIGluaXRQbGFjZVNoaXAsXG4gIHJlbmRlckZvcm0sXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxufSBmcm9tIFwiLi9ET01cIjtcblxubGV0IHBsYXllck9uZSA9IFBsYXllcihcIk9uZVwiKTtcbmxldCBwbGF5ZXJUd28gPSBQbGF5ZXIoXCJUd29cIik7XG5cbnJlbmRlckJvYXJkKHBsYXllck9uZSk7XG5yZW5kZXJCb2FyZChwbGF5ZXJUd28pO1xuXG5yZW5kZXJGb3JtKHBsYXllck9uZSk7XG5yZW5kZXJGb3JtKHBsYXllclR3byk7XG5cbmdyYWJQbGF5ZXJTaGlwcyhwbGF5ZXJPbmUpO1xuZ3JhYlBsYXllclNoaXBzKHBsYXllclR3byk7XG5cbmluaXRQbGFjZVNoaXAocGxheWVyT25lKTtcbmluaXRQbGFjZVNoaXAocGxheWVyVHdvKTtcblxuaW5pdEZpblNldHVwKHBsYXllck9uZSk7XG5pbml0RmluU2V0dXAocGxheWVyVHdvKTtcblxuaW5pdHBsYXlCdG4ocGxheWVyT25lLCBwbGF5ZXJUd28pO1xuXG5jb21wTW9kZShwbGF5ZXJUd28pO1xuXG4vKiBcblxuXG4gICAgY29uc3QgbGVuZ3RoID0gc2hpcC5nZXRTaGlwKCkubGVuZ3RoO1xuICAgIGNvbnN0IG9yaWVudGF0aW9uID0gc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb247XG4gICAgbGV0IGEgPSB4O1xuICAgIGxldCBiID0geTtcblxuICAgIGNvbnN0IHBvcHVsYXRlQmQgPSAoKSA9PiB7XG5cbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYWxsU2hpcHMpO1xuXG4gICAgYWxsU2hpcHMuZm9yRWFjaChzaGlwID0+IHtcbiAgICAgIGNvbnN0IGJvYXQgPSBhbGxTaGlwc1tzaGlwXTtcbiAgICAgIGNvbnN0IGxlbmd0aCA9IGJvYXQuZ2V0U2hpcCgpLmxlbmd0aDtcblxuICAgICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGxldCB6ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG4gICAgfSlcbiAgfVxuXG4gIGNvbnN0IGNvbXBNb2RlID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBzaGlwc09iaiA9IHBsYXllci5ib2FyZC5nZXRTaGlwcygpO1xuICBjb25zdCBzaGlwc0xpc3QgPSBPYmplY3Qua2V5cyhzaGlwc09iaik7XG4gIGNvbnN0IGRpcmVjdGlvbnMgPSBbXCJob3Jpem9udGFsXCIsIFwidmVydGljYWxcIl07XG5cbiAgc2hpcHNMaXN0LmZvckVhY2goKHNoaXApID0+IHtcbiAgICBjb25zdCBib2F0ID0gc2hpcHNPYmpbc2hpcF07XG5cbiAgICBjb25zdCBsZW5ndGggPSBib2F0LmdldFNoaXAoKS5sZW5ndGg7XG5cbiAgICBsZXQgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICBsZXQgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgY29uc29sZS5sb2coc2hpcCwgeCwgeSwgbGVuZ3RoKTtcblxuICAgIGNvbnN0IGRpciA9IGRpcmVjdGlvbnNbel07XG5cbiAgICBpZiAoZGlyID09PSBcImhvcml6b250YWxcIikge1xuICAgICAgd2hpbGUgKHkgKyBsZW5ndGggLSAxID4gOSB8fCBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKVt4XVt5XSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIndlcmtcIik7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHdoaWxlICh4ICsgbGVuZ3RoIC0gMSA+IDkgfHwgcGxheWVyLmJvYXJkLmdldEJvYXJkKClbeF1beV0gIT09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJ3ZXJrXCIpO1xuICAgICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGJvYXQuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyO1xuXG4gICAgcGxheWVyLmJvYXJkLnBsYWNlU2hpcCh4LCB5LCBib2F0KTtcblxuICAgIGNvbnNvbGUubG9nKHgsIHksIGRpcik7XG4gICAgY29uc29sZS5sb2coYm9hdC5nZXRTaGlwKCksIHNoaXApO1xuICB9KTtcblxuICByZW5kZXJCb2FyZChwbGF5ZXIpO1xufTtcbiAqL1xuIl0sIm5hbWVzIjpbIlNoaXAiLCJuIiwic2hpcE9iaiIsImdldFNoaXAiLCJoaXQiLCJoaXRDb3VudCIsImxlbmd0aCIsInN1bmsiLCJpc1N1bmsiLCJHYW1lYm9hcmQiLCJib2FyZCIsIm1pc3NlcyIsImFsbFNoaXBzIiwibF9zaGlwIiwibV9zaGlwX0kiLCJtX3NoaXBfSUkiLCJzX3NoaXBfSSIsInNfc2hpcF9JSSIsInNfc2hpcF9JSUkiLCJ4c19zaGlwX0kiLCJ4c19zaGlwX0lJIiwieHNfc2hpcF9JSUkiLCJ4c19zaGlwX0lWIiwiaXNGaXQiLCJhcnIiLCJzdGF0dXMiLCJmb3JFYWNoIiwiaXRlbSIsIngiLCJ5IiwiY3JlYXRlQ29tcCIsInNoaXAiLCJ0ZW1wIiwiYSIsImIiLCJvcmllbnRhdGlvbiIsInB1c2giLCJwbGFjZVNoaXAiLCJjb25zb2xlIiwibG9nIiwiY29tcCIsImNyZWF0ZUJvYXJkIiwiaSIsImoiLCJnZXRCb2FyZCIsImdldFNoaXBzIiwicmVjZWl2ZUF0dGFjayIsImhpdENvb3IiLCJnZXRNaXNzZXMiLCJpc0FsbFN1bmsiLCJzaGlwcyIsIk9iamVjdCIsInZhbHVlcyIsInBvcHVsYXRlQmQiLCJrZXlzIiwiZGlyZWN0aW9ucyIsImtleSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInoiLCJmaXQiLCJQbGF5ZXIiLCJudW1iZXIiLCJ3aW4iLCJpc0NvbXAiLCJyZW5kZXJCb2FyZCIsInBsYXllciIsInNoaXBzT2JqIiwieENvb3IiLCJ5Q29vciIsInJlbmRlclNoaXAiLCJwbGF5ZXJOdW0iLCJjdXJyZW50Qm9hcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibGFzdEVsZW1lbnRDaGlsZCIsInJlbW92ZUNoaWxkIiwic3F1YXJlIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiZ3JhYlBsYXllclNoaXBzIiwic2VsZWN0aW9uIiwicXVlcnlTZWxlY3RvciIsIm9wdGlvbiIsInRleHRDb250ZW50IiwiaW5pdFBsYWNlU2hpcCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJwYXJzZUludCIsInZhbHVlIiwic2hpcE5hbWUiLCJvcmllbnQiLCJyZW5kZXJGb3JtIiwicGxheWVyTm8iLCJtYWluIiwiZm9ybSIsImlucHV0WCIsImlucHV0WSIsImJ1dHRvbiIsImNyb3NzIiwibG9uZyIsImZpbiIsImFwcGVuZCIsImluaXRGaW5TZXR1cCIsImlzQWxsUGxhY2VkIiwiaGlkZUJvYXJkIiwic2hvd01vZGFsIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbmRlclBsYXlCZCIsImN1cnJCb2FyZCIsImluaXRTcXJCdG4iLCJmaW5kIiwiYm9hcmRMaXN0IiwiZGlhbG9nIiwiZ2V0QXR0cmlidXRlIiwicGxheWVyT25lIiwicGxheWVyVHdvIiwiUE9uZSIsIlBUd28iLCJwbGF5V2luZG93IiwiY2xvc2UiLCJpbml0cGxheUJ0biJdLCJzb3VyY2VSb290IjoiIn0=