(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk}},t=()=>{let t=[],o=[],r=[],n={l_ship:e(4),m_ship_I:e(3),m_ship_II:e(3),s_ship_I:e(2),s_ship_II:e(2),s_ship_III:e(2),xs_ship_I:e(1),xs_ship_II:e(1),xs_ship_III:e(1),xs_ship_IV:e(1)};const l=e=>{let o=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(r=e[0],n=e[1],null!==t[r][n]))return o=!1;var r,n})),o},a=(e,t,o)=>{const r=o.getShip().length;let n=[],l=e,a=t;if("horizontal"===o.getShip().orientation)for(;a!==t+r;)n.push([e,a]),a+=1;else for(;l!==e+r;)n.push([l,t]),l+=1;return n},s=(e,o,r)=>{let n=[],s=!0;return o+length-1>9||e>9||e+length-1>9||o>9?console.log("error"):(n=a(e,o,r),s=l(n),!1===s?(s=!0,n=[],console.log("not empty")):(r.getShip().comp=n,r.getShip().comp.forEach((e=>{t[e[0]][e[1]]=r})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let o=0;o<10;o++)t[e][o]=null}return t},placeShip:s,getBoard:()=>t,getShips:()=>n,receiveAttack:(e,n)=>(null===t[e][n]?o.push([e,n]):(r.push([e,n]),t[e][n].hit(),t[e][n].getShip().hitCoor.push([e,n])),t),getMisses:()=>o,getHits:()=>r,isAllSunk:()=>{const e=Object.values(n);let t=!1;return e.forEach((e=>{if(!1===e.getShip().sunk)return t=!1;t=!0})),t},populateBd:()=>{const e=Object.keys(n),o=["horizontal","vertical"];return e.forEach((e=>{const t=n[e],r=t.getShip().length;let c=Math.floor(10*Math.random()),i=Math.floor(10*Math.random()),u=Math.floor(2*Math.random());t.getShip().orientation=o[u];let d=a(c,i,t),h=l(d);for(;i+r-1>9||c+r-1>9||!1===h;)c=Math.floor(10*Math.random()),i=Math.floor(10*Math.random()),u=Math.floor(2*Math.random()),t.getShip().orientation=o[u],d=a(c,i,t),h=l(d);s(c,i,t)})),t}}},o=e=>({number:e,win:!1,board:t(),isComp:!1}),r=(e,t,o,r,n)=>{const l=e.board.getMisses();null===t?l.find((e=>e[0]===r&&e[1]===n))?o.setAttribute("style","background-color: yellow;"):o.setAttribute("style","background-color: blue;"):t.getShip().hitCoor.find((e=>e[0]===r&&e[1]===n))&&o.setAttribute("style","background-color: red;")},n=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((o=>{const r=t[o].getShip().comp;if(0!==r.length){const n=r[0][0],l=r[0][1];e.board.placeShip(n,l,t[o])}}))})(e);const t=e.board.getBoard(),o=e.number;let n=document.getElementById(`board${o}`);for(;n.lastElementChild;)n.removeChild(n.lastElementChild);for(let l=0;l<t.length;l++)for(let a=0;a<t.length;a++){const s=document.createElement("div");s.classList.add(`${o}-square`),s.setAttribute("data-x",`${l}`),s.setAttribute("data-y",`${a}`),r(e,t[l][a],s,l,a),n.appendChild(s)}return n},l=e=>{const t=e.board.getShips(),o=Object.keys(t),r=document.querySelector(`#player${e.number}-ships`);return o.forEach((e=>{const t=document.createElement("option");t.textContent=e,r.appendChild(t)})),r},a=e=>{document.querySelector(`#placeShipBtn-${e.number}`).addEventListener("click",(t=>{t.preventDefault();const o=parseInt(document.querySelector(`#player${e.number}-y`).value),r=parseInt(document.querySelector(`#player${e.number}-x`).value),l=document.querySelector(`#player${e.number}-ships`).value,a=document.querySelector(`#player${e.number}-orient`).value,s=e.board.getShips()[l];s.getShip().orientation=a,console.log(a),e.board.placeShip(o,r,s),n(e)}))},s=e=>{const t=document.querySelector("main"),o=document.querySelector(`#player${e.number}-finBtn`),r=document.querySelector(`#player${e.number}-form`),n=e.board.getShips(),l=Object.values(n);let a=!1;o.addEventListener("click",(o=>{o.preventDefault();const n=t.getAttribute("class");l.forEach((e=>{const t=e.getShip().comp;return a=0!==t.length})),a?r.setAttribute("style","display: none;"):console.log("Please place all the ships first"),c(e),("pvc"===n||"Two"===e.number)&&document.querySelector(".dialog").showModal()}))},c=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},i=(e,t)=>{const o=document.querySelector("main"),r=document.querySelector(".dialog"),l=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(a=>{a.preventDefault();let s=l.getAttribute("data-id");if("player-Two"===s)return n(e),u(t),l.setAttribute("data-id",`player-${e.number}`),r.close();if("player-One"===s){const a=o.getAttribute("class");return l.setAttribute("data-id",`player-${t.number}`),console.log(a),"pvc"===a?(h(e,t),r.close()):(n(t),u(e),r.close())}}))},u=e=>{const t=e.board.getBoard(),o=e.board.getMisses(),r=document.querySelector(`#board${e.number}`);for(;r.lastElementChild;)r.removeChild(r.lastElementChild);for(let n=0;n<t.length;n++)for(let l=0;l<t.length;l++){const a=t[n][l],s=document.createElement("button");s.classList.add(`${e.number}-square`),s.setAttribute("data-x",`${n}`),s.setAttribute("data-y",`${l}`),d(e,s),null!==a&&a.getShip().hitCount>0&&a.getShip().hitCoor.find((e=>e[0]===n&&e[1]===l))&&(s.setAttribute("style","background-color: red;"),s.setAttribute("disabled","")),o.find((e=>e[0]===n&&e[1]===l))&&(s.setAttribute("style","background-color: green;"),s.setAttribute("disabled","")),r.appendChild(s)}},d=(e,t)=>{const o=e.board,r=o.getBoard(),n=document.querySelector(".dialog"),l=parseInt(t.getAttribute("data-x")),a=parseInt(t.getAttribute("data-y"));t.addEventListener("click",(s=>{s.preventDefault(),o.receiveAttack(l,a),null===r[l][a]?(c(e),t.setAttribute("style","background-color: red;"),n.showModal()):t.setAttribute("style","background-color: green;")}))},h=(e,t)=>{const o=e.board,r=o.getBoard(),l=o.getMisses(),a=o.getHits(),s=document.querySelector("#play-window");let c=Math.floor(10*Math.random()),i=Math.floor(10*Math.random()),d=!0;for(;!0===d;)console.log(l),console.log(a),l.find((e=>e[0]===c&&e[1]===i))||a.find((e=>e[0]===c&&e[1]===i))?(c=Math.floor(10*Math.random()),i=Math.floor(10*Math.random())):(o.receiveAttack(c,i),null===r[c][i]?(s.setAttribute("data-id",`player-${e.number}`),n(e),u(t),d=!1):(console.log("continuing"),c=Math.floor(10*Math.random()),i=Math.floor(10*Math.random())))},p=document.querySelector(".game_mode"),m=document.querySelector("#pvp"),b=document.querySelector("#pvc"),g=o("One"),y=o("Two");m.addEventListener("click",(e=>(e.preventDefault(),n(g),n(y),l(g),l(y),a(g),a(y),s(g),s(y),i(g,y),p.close()))),b.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main"),o=document.querySelector("#playerTwo-form");var r;return n(g),n(y),l(g),a(g),s(g),s(y),i(g,y),(r=y).board.populateBd(),n(r),o.setAttribute("style","display: none;"),t.classList.add("pvc"),p.close()})),document.addEventListener("onload",p.showModal())})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FFWnVDLEVBQVNSLE9BQU8sSUFHekJ0QyxTQUFTZSxpQkFBaUIsU0FBVStCLEVBQVNoQixZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL0RPTS5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTaGlwID0gKG4pID0+IHtcbiAgbGV0IHNoaXBPYmogPSB7fTtcblxuICBzaGlwT2JqW1wibGVuZ3RoXCJdID0gbjtcbiAgc2hpcE9ialtcImhpdENvdW50XCJdID0gMDtcbiAgc2hpcE9ialtcInN1bmtcIl0gPSBmYWxzZTtcbiAgc2hpcE9ialtcIm9yaWVudGF0aW9uXCJdID0gXCJob3Jpem9udGFsXCI7XG4gIHNoaXBPYmpbXCJjb21wXCJdID0gW107XG4gIHNoaXBPYmpbXCJoaXRDb29yXCJdID0gW107XG5cbiAgY29uc3QgZ2V0U2hpcCA9ICgpID0+IHNoaXBPYmo7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIHNoaXBPYmouaGl0Q291bnQgKz0gMTtcbiAgICBpZiAoc2hpcE9iai5oaXRDb3VudCA9PT0gc2hpcE9iai5sZW5ndGgpIHNoaXBPYmouc3VuayA9IHRydWU7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwT2JqLnN1bmsgPT09IHRydWUgPyB0cnVlIDogZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRTaGlwLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG59O1xuXG5leHBvcnQgeyBTaGlwIH07XG4iLCJpbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSAoKSA9PiB7XG4gIGxldCBib2FyZCA9IFtdO1xuICBsZXQgbWlzc2VzID0gW107XG4gIGxldCBoaXRzID0gW107XG5cbiAgbGV0IGFsbFNoaXBzID0ge1xuICAgIGxfc2hpcDogU2hpcCg0KSxcbiAgICBtX3NoaXBfSTogU2hpcCgzKSxcbiAgICBtX3NoaXBfSUk6IFNoaXAoMyksXG4gICAgc19zaGlwX0k6IFNoaXAoMiksXG4gICAgc19zaGlwX0lJOiBTaGlwKDIpLFxuICAgIHNfc2hpcF9JSUk6IFNoaXAoMiksXG4gICAgeHNfc2hpcF9JOiBTaGlwKDEpLFxuICAgIHhzX3NoaXBfSUk6IFNoaXAoMSksXG4gICAgeHNfc2hpcF9JSUk6IFNoaXAoMSksXG4gICAgeHNfc2hpcF9JVjogU2hpcCgxKSxcbiAgfTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkO1xuICBjb25zdCBnZXRNaXNzZXMgPSAoKSA9PiBtaXNzZXM7XG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4gYWxsU2hpcHM7XG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiBoaXRzO1xuXG4gIGNvbnN0IGNyZWF0ZUJvYXJkID0gKCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgYm9hcmRbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBib2FyZFtpXVtqXSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGlzRW1wdHkgPSAoeCwgeSkgPT4ge1xuICAgIHJldHVybiBib2FyZFt4XVt5XSA9PT0gbnVsbCA/IHRydWUgOiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBpc0ZpdCA9IChhcnIpID0+IHtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIGFyci5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBpZiAoaXRlbVswXSA+IDkgfHwgaXRlbVsxXSA+IDkgfHwgIWlzRW1wdHkoaXRlbVswXSwgaXRlbVsxXSkpXG4gICAgICAgIHJldHVybiAoc3RhdHVzID0gZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfTtcblxuICBjb25zdCBjcmVhdGVDb21wID0gKHgsIHksIHNoaXApID0+IHtcbiAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG4gICAgY29uc3Qgb3JpZW50YXRpb24gPSBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbjtcbiAgICBsZXQgdGVtcCA9IFtdO1xuICAgIGxldCBhID0geDtcbiAgICBsZXQgYiA9IHk7XG5cbiAgICBpZiAob3JpZW50YXRpb24gPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICB3aGlsZSAoYiAhPT0geSArIGxlbmd0aCkge1xuICAgICAgICB0ZW1wLnB1c2goW3gsIGJdKTtcbiAgICAgICAgYiArPSAxO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB3aGlsZSAoYSAhPT0geCArIGxlbmd0aCkge1xuICAgICAgICB0ZW1wLnB1c2goW2EsIHldKTtcbiAgICAgICAgYSArPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0ZW1wO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9ICh4LCB5LCBzaGlwKSA9PiB7XG4gICAgbGV0IHRlbXAgPSBbXTtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIGlmICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IHkgPiA5KSB7XG4gICAgICByZXR1cm4gY29uc29sZS5sb2coXCJlcnJvclwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBzdGF0dXMgPSBpc0ZpdCh0ZW1wKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdHVzID09PSBmYWxzZSkge1xuICAgICAgc3RhdHVzID0gdHJ1ZTtcbiAgICAgIHRlbXAgPSBbXTtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcIm5vdCBlbXB0eVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hpcC5nZXRTaGlwKCkuY29tcCA9IHRlbXA7XG5cbiAgICAgIHNoaXAuZ2V0U2hpcCgpLmNvbXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBib2FyZFtpdGVtWzBdXVtpdGVtWzFdXSA9IHNoaXA7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcG9wdWxhdGVCZCA9ICgpID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYWxsU2hpcHMpO1xuICAgIGNvbnN0IGRpcmVjdGlvbnMgPSBbXCJob3Jpem9udGFsXCIsIFwidmVydGljYWxcIl07XG5cbiAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgY29uc3Qgc2hpcCA9IGFsbFNoaXBzW2tleV07XG4gICAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG5cbiAgICAgIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IGRpcmVjdGlvbnNbel07XG4gICAgICBsZXQgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBsZXQgZml0ID0gaXNGaXQodGVtcCk7XG5cbiAgICAgIHdoaWxlICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IGZpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyZWN0aW9uc1t6XTtcbiAgICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICAgIGZpdCA9IGlzRml0KHRlbXApO1xuICAgICAgfVxuXG4gICAgICBwbGFjZVNoaXAoeCwgeSwgc2hpcCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9ICh4LCB5KSA9PiB7XG4gICAgaWYgKGJvYXJkW3hdW3ldID09PSBudWxsKSBtaXNzZXMucHVzaChbeCwgeV0pO1xuICAgIGVsc2Uge1xuICAgICAgaGl0cy5wdXNoKFt4LCB5XSk7XG4gICAgICBib2FyZFt4XVt5XS5oaXQoKTtcbiAgICAgIGJvYXJkW3hdW3ldLmdldFNoaXAoKS5oaXRDb29yLnB1c2goW3gsIHldKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgaXNBbGxTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhhbGxTaGlwcyk7XG4gICAgbGV0IHN0YXR1cyA9IGZhbHNlO1xuXG4gICAgc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgaWYgKHNoaXAuZ2V0U2hpcCgpLnN1bmsgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiAoc3RhdHVzID0gZmFsc2UpO1xuICAgICAgfSBlbHNlIHN0YXR1cyA9IHRydWU7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY3JlYXRlQm9hcmQsXG4gICAgcGxhY2VTaGlwLFxuICAgIGdldEJvYXJkLFxuICAgIGdldFNoaXBzLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgZ2V0TWlzc2VzLFxuICAgIGdldEhpdHMsXG4gICAgaXNBbGxTdW5rLFxuICAgIHBvcHVsYXRlQmQsXG4gIH07XG59O1xuXG5leHBvcnQgeyBHYW1lYm9hcmQgfTtcbiIsImltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5jb25zdCBQbGF5ZXIgPSAobnVtYmVyKSA9PiB7XG4gIGxldCB3aW4gPSBmYWxzZTtcbiAgbGV0IGJvYXJkID0gR2FtZWJvYXJkKCk7XG4gIGxldCBpc0NvbXAgPSBmYWxzZTtcblxuICByZXR1cm4ge1xuICAgIG51bWJlcixcbiAgICB3aW4sXG4gICAgYm9hcmQsXG4gICAgaXNDb21wLFxuICB9O1xufTtcblxuZXhwb3J0IHsgUGxheWVyIH07XG4iLCJjb25zdCBmaWxsU3FyID0gKHBsYXllciwgc3FyLCB0YWcsIHgsIHkpID0+IHtcbiAgY29uc3QgbWlzc2VzID0gcGxheWVyLmJvYXJkLmdldE1pc3NlcygpO1xuXG4gIGlmIChzcXIgPT09IG51bGwpIHtcbiAgICBpZiAoXG4gICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHllbGxvdztcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGJsdWU7XCIpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChcbiAgICBzcXIuZ2V0U2hpcCgpLmhpdENvb3IuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICB9KVxuICApIHtcbiAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICB9XG59O1xuXG5jb25zdCByZW5kZXJTaGlwID0gKHBsYXllcikgPT4ge1xuICBsZXQgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHNMaXN0ID0gT2JqZWN0LmtleXMoc2hpcHNPYmopO1xuXG4gIHNoaXBzTGlzdC5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29tcCA9IHNoaXBzT2JqW3NoaXBdLmdldFNoaXAoKS5jb21wO1xuXG4gICAgaWYgKGNvbXAubGVuZ3RoICE9PSAwKSB7XG4gICAgICBjb25zdCB4Q29vciA9IGNvbXBbMF1bMF07XG4gICAgICBjb25zdCB5Q29vciA9IGNvbXBbMF1bMV07XG4gICAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcHNPYmpbc2hpcF0pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGJvYXJkO1xufTtcblxuY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIHBsYXllci5ib2FyZC5jcmVhdGVCb2FyZCgpO1xuXG4gIHJlbmRlclNoaXAocGxheWVyKTtcblxuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBwbGF5ZXJOdW0gPSBwbGF5ZXIubnVtYmVyO1xuICBsZXQgY3VycmVudEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJvYXJkJHtwbGF5ZXJOdW19YCk7XG5cbiAgd2hpbGUgKGN1cnJlbnRCb2FyZC5sYXN0RWxlbWVudENoaWxkKVxuICAgIGN1cnJlbnRCb2FyZC5yZW1vdmVDaGlsZChjdXJyZW50Qm9hcmQubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm9hcmQubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwbGF5ZXJOdW19LXNxdWFyZWApO1xuXG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS14XCIsIGAke2l9YCk7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS15XCIsIGAke2p9YCk7XG5cbiAgICAgIGZpbGxTcXIocGxheWVyLCBib2FyZFtpXVtqXSwgc3F1YXJlLCBpLCBqKTtcblxuICAgICAgY3VycmVudEJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRCb2FyZDtcbn07XG5cbmNvbnN0IGdyYWJQbGF5ZXJTaGlwcyA9IChwbGF5ZXIpID0+IHtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHMgPSBPYmplY3Qua2V5cyhzaGlwc09iaik7XG4gIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LXNoaXBzYCk7XG5cbiAgc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gICAgb3B0aW9uLnRleHRDb250ZW50ID0gc2hpcDtcbiAgICBzZWxlY3Rpb24uYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdGlvbjtcbn07XG5cbmNvbnN0IGluaXRQbGFjZVNoaXAgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGFjZVNoaXBCdG4tJHtwbGF5ZXIubnVtYmVyfWApO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCB4Q29vciA9IHBhcnNlSW50KFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyLm51bWJlcn0teWApLnZhbHVlXG4gICAgKTtcbiAgICBjb25zdCB5Q29vciA9IHBhcnNlSW50KFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyLm51bWJlcn0teGApLnZhbHVlXG4gICAgKTtcbiAgICBjb25zdCBzaGlwTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI3BsYXllciR7cGxheWVyLm51bWJlcn0tc2hpcHNgXG4gICAgKS52YWx1ZTtcblxuICAgIGNvbnN0IG9yaWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI3BsYXllciR7cGxheWVyLm51bWJlcn0tb3JpZW50YFxuICAgICkudmFsdWU7XG5cbiAgICBjb25zdCBzaGlwID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKClbc2hpcE5hbWVdO1xuXG4gICAgc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBvcmllbnQ7XG4gICAgY29uc29sZS5sb2cob3JpZW50KTtcblxuICAgIHBsYXllci5ib2FyZC5wbGFjZVNoaXAoeENvb3IsIHlDb29yLCBzaGlwKTtcbiAgICByZW5kZXJCb2FyZChwbGF5ZXIpO1xuICB9KTtcbn07XG5cbmNvbnN0IGluaXRGaW5TZXR1cCA9IChwbGF5ZXIpID0+IHtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxheWVyJHtwbGF5ZXIubnVtYmVyfS1maW5CdG5gKTtcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LWZvcm1gKTtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHMgPSBPYmplY3QudmFsdWVzKHNoaXBzT2JqKTtcbiAgbGV0IGlzQWxsUGxhY2VkID0gZmFsc2U7XG5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNvbnN0IG1vZGUgPSBtYWluLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpO1xuXG4gICAgc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgY29uc3QgY29tcCA9IHNoaXAuZ2V0U2hpcCgpLmNvbXA7XG4gICAgICBpZiAoY29tcC5sZW5ndGggPT09IDApIHJldHVybiAoaXNBbGxQbGFjZWQgPSBmYWxzZSk7XG4gICAgICBlbHNlIHJldHVybiAoaXNBbGxQbGFjZWQgPSB0cnVlKTtcbiAgICB9KTtcblxuICAgIGlzQWxsUGxhY2VkXG4gICAgICA/IGZvcm0uc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBub25lO1wiKVxuICAgICAgOiBjb25zb2xlLmxvZyhcIlBsZWFzZSBwbGFjZSBhbGwgdGhlIHNoaXBzIGZpcnN0XCIpO1xuXG4gICAgaGlkZUJvYXJkKHBsYXllcik7XG5cbiAgICBpZiAobW9kZSA9PT0gXCJwdmNcIiB8fCBwbGF5ZXIubnVtYmVyID09PSBcIlR3b1wiKSB7XG4gICAgICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgaGlkZUJvYXJkID0gKHBsYXllcikgPT4ge1xuICBsZXQgc3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke3BsYXllci5udW1iZXJ9LXNxdWFyZWApO1xuXG4gIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyYXk7XCIpO1xuICB9KTtcbn07XG5cbmNvbnN0IGluaXRwbGF5QnRuID0gKFBPbmUsIFBUd28pID0+IHtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgY29uc3QgcGxheVdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheS13aW5kb3dcIik7XG4gIGNvbnN0IHBsYXlCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYXlcIik7XG5cbiAgcGxheUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IHBsYXllciA9IHBsYXlXaW5kb3cuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcblxuICAgIGlmIChwbGF5ZXIgPT09IFwicGxheWVyLVR3b1wiKSB7XG4gICAgICByZW5kZXJCb2FyZChQT25lKTtcbiAgICAgIHJlbmRlclBsYXlCZChQVHdvKTtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7UE9uZS5udW1iZXJ9YCk7XG4gICAgICByZXR1cm4gZGlhbG9nLmNsb3NlKCk7XG4gICAgfSBlbHNlIGlmIChwbGF5ZXIgPT09IFwicGxheWVyLU9uZVwiKSB7XG4gICAgICBjb25zdCBtb2RlID0gbWFpbi5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKTtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7UFR3by5udW1iZXJ9YCk7XG4gICAgICBjb25zb2xlLmxvZyhtb2RlKTtcbiAgICAgIGlmIChtb2RlID09PSBcInB2Y1wiKSB7XG4gICAgICAgIGF1dG9BdGsoUE9uZSwgUFR3byk7XG4gICAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlbmRlckJvYXJkKFBUd28pO1xuICAgICAgICByZW5kZXJQbGF5QmQoUE9uZSk7XG4gICAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgcmVuZGVyUGxheUJkID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBtaXNzZXMgPSBwbGF5ZXIuYm9hcmQuZ2V0TWlzc2VzKCk7XG4gIGNvbnN0IGN1cnJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNib2FyZCR7cGxheWVyLm51bWJlcn1gKTtcblxuICB3aGlsZSAoY3VyckJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpXG4gICAgY3VyckJvYXJkLnJlbW92ZUNoaWxkKGN1cnJCb2FyZC5sYXN0RWxlbWVudENoaWxkKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBib2FyZC5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgaXRlbSA9IGJvYXJkW2ldW2pdO1xuXG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoYCR7cGxheWVyLm51bWJlcn0tc3F1YXJlYCk7XG5cbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIiwgYCR7aX1gKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIiwgYCR7an1gKTtcblxuICAgICAgaW5pdFNxckJ0bihwbGF5ZXIsIHNxdWFyZSk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbSAhPT0gbnVsbCAmJlxuICAgICAgICBpdGVtLmdldFNoaXAoKS5oaXRDb3VudCA+IDAgJiZcbiAgICAgICAgaXRlbS5nZXRTaGlwKCkuaGl0Q29vci5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IGkgJiYgaXRlbVsxXSA9PT0gajtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0gaSAmJiBpdGVtWzFdID09PSBqO1xuICAgICAgICB9KVxuICAgICAgKSB7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiKTtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgfVxuXG4gICAgICBjdXJyQm9hcmQuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGluaXRTcXJCdG4gPSAocGxheWVyLCBzcXVhcmUpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBwbGF5ZXIuYm9hcmQ7XG4gIGNvbnN0IGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlhbG9nXCIpO1xuICBjb25zdCB4ID0gcGFyc2VJbnQoc3F1YXJlLmdldEF0dHJpYnV0ZShcImRhdGEteFwiKSk7XG4gIGNvbnN0IHkgPSBwYXJzZUludChzcXVhcmUuZ2V0QXR0cmlidXRlKFwiZGF0YS15XCIpKTtcblxuICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICBpZiAoYm9hcmRMaXN0W3hdW3ldID09PSBudWxsKSB7XG4gICAgICBoaWRlQm9hcmQocGxheWVyKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHJlZDtcIik7XG4gICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgY29tcE1vZGUgPSAocGxheWVyKSA9PiB7XG4gIHBsYXllci5ib2FyZC5wb3B1bGF0ZUJkKCk7XG4gIHJlbmRlckJvYXJkKHBsYXllcik7XG59O1xuXG5jb25zdCBhdXRvQXRrID0gKHBsYXlPbmUsIHBsYXlUd28pID0+IHtcbiAgY29uc3QgYm9hcmQgPSBwbGF5T25lLmJvYXJkO1xuICBjb25zdCBib2FyZExpc3QgPSBib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBtaXNzZXMgPSBib2FyZC5nZXRNaXNzZXMoKTtcbiAgY29uc3QgaGl0cyA9IGJvYXJkLmdldEhpdHMoKTtcbiAgY29uc3QgcGxheVdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheS13aW5kb3dcIik7XG4gIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgbGV0IGNvbnQgPSB0cnVlO1xuXG4gIHdoaWxlIChjb250ID09PSB0cnVlKSB7XG4gICAgY29uc29sZS5sb2cobWlzc2VzKTtcbiAgICBjb25zb2xlLmxvZyhoaXRzKTtcbiAgICBpZiAoXG4gICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSkgfHxcbiAgICAgIGhpdHMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcblxuICAgIGlmIChib2FyZExpc3RbeF1beV0gPT09IG51bGwpIHtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7cGxheU9uZS5udW1iZXJ9YCk7XG4gICAgICByZW5kZXJCb2FyZChwbGF5T25lKTtcbiAgICAgIHJlbmRlclBsYXlCZChwbGF5VHdvKTtcbiAgICAgIGNvbnQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJjb250aW51aW5nXCIpO1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQge1xuICByZW5kZXJCb2FyZCxcbiAgZ3JhYlBsYXllclNoaXBzLFxuICBpbml0UGxhY2VTaGlwLFxuICBpbml0RmluU2V0dXAsXG4gIGluaXRwbGF5QnRuLFxuICBjb21wTW9kZSxcbn07XG4iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCB7XG4gIHJlbmRlckJvYXJkLFxuICBncmFiUGxheWVyU2hpcHMsXG4gIGluaXRQbGFjZVNoaXAsXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxufSBmcm9tIFwiLi9ET01cIjtcblxuY29uc3QgZ2FtZU1vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWVfbW9kZVwiKTtcbmNvbnN0IHB2cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHZwXCIpO1xuY29uc3QgcHZjQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwdmNcIik7XG5jb25zdCBwbGF5ZXJPbmUgPSBQbGF5ZXIoXCJPbmVcIik7XG5jb25zdCBwbGF5ZXJUd28gPSBQbGF5ZXIoXCJUd29cIik7XG5cbnB2cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJPbmUpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJUd28pO1xuXG4gIGdyYWJQbGF5ZXJTaGlwcyhwbGF5ZXJPbmUpO1xuICBncmFiUGxheWVyU2hpcHMocGxheWVyVHdvKTtcblxuICBpbml0UGxhY2VTaGlwKHBsYXllck9uZSk7XG4gIGluaXRQbGFjZVNoaXAocGxheWVyVHdvKTtcblxuICBpbml0RmluU2V0dXAocGxheWVyT25lKTtcbiAgaW5pdEZpblNldHVwKHBsYXllclR3byk7XG5cbiAgaW5pdHBsYXlCdG4ocGxheWVyT25lLCBwbGF5ZXJUd28pO1xuXG4gIHJldHVybiBnYW1lTW9kZS5jbG9zZSgpO1xufSk7XG5cbnB2Y0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheWVyVHdvLWZvcm1cIik7XG5cbiAgcmVuZGVyQm9hcmQocGxheWVyT25lKTtcbiAgcmVuZGVyQm9hcmQocGxheWVyVHdvKTtcbiAgZ3JhYlBsYXllclNoaXBzKHBsYXllck9uZSk7XG4gIGluaXRQbGFjZVNoaXAocGxheWVyT25lKTtcbiAgaW5pdEZpblNldHVwKHBsYXllck9uZSk7XG4gIGluaXRGaW5TZXR1cChwbGF5ZXJUd28pO1xuICBpbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgY29tcE1vZGUocGxheWVyVHdvKTtcblxuICBmb3JtLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiZGlzcGxheTogbm9uZTtcIik7XG4gIG1haW4uY2xhc3NMaXN0LmFkZChcInB2Y1wiKTtcblxuICByZXR1cm4gZ2FtZU1vZGUuY2xvc2UoKTtcbn0pO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwib25sb2FkXCIsIGdhbWVNb2RlLnNob3dNb2RhbCgpKTtcbiJdLCJuYW1lcyI6WyJTaGlwIiwibiIsInNoaXBPYmoiLCJnZXRTaGlwIiwiaGl0IiwiaGl0Q291bnQiLCJsZW5ndGgiLCJzdW5rIiwiaXNTdW5rIiwiR2FtZWJvYXJkIiwiYm9hcmQiLCJtaXNzZXMiLCJoaXRzIiwiYWxsU2hpcHMiLCJsX3NoaXAiLCJtX3NoaXBfSSIsIm1fc2hpcF9JSSIsInNfc2hpcF9JIiwic19zaGlwX0lJIiwic19zaGlwX0lJSSIsInhzX3NoaXBfSSIsInhzX3NoaXBfSUkiLCJ4c19zaGlwX0lJSSIsInhzX3NoaXBfSVYiLCJpc0ZpdCIsImFyciIsInN0YXR1cyIsImZvckVhY2giLCJpdGVtIiwieCIsInkiLCJjcmVhdGVDb21wIiwic2hpcCIsInRlbXAiLCJhIiwiYiIsIm9yaWVudGF0aW9uIiwicHVzaCIsInBsYWNlU2hpcCIsImNvbnNvbGUiLCJsb2ciLCJjb21wIiwiY3JlYXRlQm9hcmQiLCJpIiwiaiIsImdldEJvYXJkIiwiZ2V0U2hpcHMiLCJyZWNlaXZlQXR0YWNrIiwiaGl0Q29vciIsImdldE1pc3NlcyIsImdldEhpdHMiLCJpc0FsbFN1bmsiLCJzaGlwcyIsIk9iamVjdCIsInZhbHVlcyIsInBvcHVsYXRlQmQiLCJrZXlzIiwiZGlyZWN0aW9ucyIsImtleSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInoiLCJmaXQiLCJQbGF5ZXIiLCJudW1iZXIiLCJ3aW4iLCJpc0NvbXAiLCJmaWxsU3FyIiwicGxheWVyIiwic3FyIiwidGFnIiwiZmluZCIsInNldEF0dHJpYnV0ZSIsInJlbmRlckJvYXJkIiwic2hpcHNPYmoiLCJ4Q29vciIsInlDb29yIiwicmVuZGVyU2hpcCIsInBsYXllck51bSIsImN1cnJlbnRCb2FyZCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJsYXN0RWxlbWVudENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzcXVhcmUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJncmFiUGxheWVyU2hpcHMiLCJzZWxlY3Rpb24iLCJxdWVyeVNlbGVjdG9yIiwib3B0aW9uIiwidGV4dENvbnRlbnQiLCJpbml0UGxhY2VTaGlwIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInBhcnNlSW50IiwidmFsdWUiLCJzaGlwTmFtZSIsIm9yaWVudCIsImluaXRGaW5TZXR1cCIsIm1haW4iLCJidXR0b24iLCJmb3JtIiwiaXNBbGxQbGFjZWQiLCJtb2RlIiwiZ2V0QXR0cmlidXRlIiwiaGlkZUJvYXJkIiwic2hvd01vZGFsIiwicXVlcnlTZWxlY3RvckFsbCIsImluaXRwbGF5QnRuIiwiUE9uZSIsIlBUd28iLCJkaWFsb2ciLCJwbGF5V2luZG93IiwicmVuZGVyUGxheUJkIiwiY2xvc2UiLCJhdXRvQXRrIiwiY3VyckJvYXJkIiwiaW5pdFNxckJ0biIsImJvYXJkTGlzdCIsInBsYXlPbmUiLCJwbGF5VHdvIiwiY29udCIsImdhbWVNb2RlIiwicHZwQnRuIiwicHZjQnRuIiwicGxheWVyT25lIiwicGxheWVyVHdvIl0sInNvdXJjZVJvb3QiOiIifQ==