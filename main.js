(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk,resetShip:()=>(t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],t)}},t=()=>{let t=[],r=[],o=[],n={battleship:e(4),cruiser_I:e(3),cruiser_II:e(3),destroyer_I:e(2),destroyer_II:e(2),destroyer_III:e(2),submarine_I:e(1),submarine_II:e(1),submarine_III:e(1),submarine_IV:e(1)};const a=e=>{let r=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(o=e[0],n=e[1],null!==t[o][n]))return r=!1;var o,n})),r},l=(e,t,r)=>{const o=r.getShip().length;let n=[],a=e,l=t;if("horizontal"===r.getShip().orientation)for(;l!==t+o;)n.push([e,l]),l+=1;else for(;a!==e+o;)n.push([a,t]),a+=1;return n},u=(e,r,o)=>{let n=[],u=!0;return r+length-1>9||e>9||e+length-1>9||r>9?alert("Ship is out of bound"):(n=l(e,r,o),u=a(n),!1===u?(u=!0,n=[],alert("square is already occupied")):(o.getShip().comp=n,o.getShip().comp.forEach((e=>{t[e[0]][e[1]]=o})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e][r]=null}return t},placeShip:u,getBoard:()=>t,getShips:()=>n,receiveAttack:(e,n)=>(null===t[e][n]?r.push([e,n]):(o.push([e,n]),t[e][n].hit(),t[e][n].getShip().hitCoor.push([e,n])),t),getMisses:()=>r,getHits:()=>o,isAllSunk:()=>{const e=Object.values(n);let t=!0;return e.forEach((e=>{if(!e.isSunk())return t=!1})),t},populateBd:()=>{const e=Object.keys(n),r=["horizontal","vertical"];return e.forEach((e=>{const t=n[e],o=t.getShip().length;let c=Math.floor(10*Math.random()),d=Math.floor(10*Math.random()),s=Math.floor(2*Math.random());t.getShip().orientation=r[s];let i=l(c,d,t),m=a(i);for(;d+o-1>9||c+o-1>9||!1===m;)c=Math.floor(10*Math.random()),d=Math.floor(10*Math.random()),s=Math.floor(2*Math.random()),t.getShip().orientation=r[s],i=l(c,d,t),m=a(i);u(c,d,t)})),t},resetBoard:()=>{const e=Object.keys(n);t=[],r=[],o=[],e.forEach((e=>{n[e].resetShip()}))}}},r=e=>({number:e,win:!1,board:t(),isComp:!1}),o=(e,t,r,o,n)=>{const a=e.board.getMisses();null===t?a.find((e=>e[0]===o&&e[1]===n))?r.setAttribute("style","background-color: yellow;"):r.setAttribute("style","background-color: blue;"):t.getShip().hitCoor.find((e=>e[0]===o&&e[1]===n))&&r.setAttribute("style","background-color: red;")},n=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((r=>{const o=t[r].getShip().comp;if(0!==o.length){const n=o[0][0],a=o[0][1];e.board.placeShip(n,a,t[r])}}))})(e);const t=e.board.getBoard(),r=e.number;let n=document.getElementById(`board${r}`);for(;n.lastElementChild;)n.removeChild(n.lastElementChild);for(let a=0;a<t.length;a++)for(let l=0;l<t.length;l++){const u=document.createElement("div");u.classList.add(`${r}-square`),u.setAttribute("data-x",`${a}`),u.setAttribute("data-y",`${l}`),o(e,t[a][l],u,a,l),n.appendChild(u)}return n},a=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},l=(e,t,r)=>{let o,n,a;for("player-Two"===r?(o=t.board.getBoard(),n=t.board.getMisses(),a=document.querySelector(`#board${t.number}`)):(o=e.board.getBoard(),n=e.board.getMisses(),a=document.querySelector(`#board${e.number}`));a.lastElementChild;)a.removeChild(a.lastElementChild);for(let l=0;l<o.length;l++)for(let c=0;c<o.length;c++){const d=o[l][c],s=document.createElement("button");"player-One"===r?s.classList.add(`${e.number}-square`):s.classList.add(`${t.number}-square`),s.setAttribute("data-x",`${l}`),s.setAttribute("data-y",`${c}`),u(e,t,s),null!==d&&d.getShip().hitCount>0&&d.getShip().hitCoor.find((e=>e[0]===l&&e[1]===c))&&(s.setAttribute("style","background-color: red;"),s.setAttribute("disabled","")),n.find((e=>e[0]===l&&e[1]===c))&&(s.setAttribute("style","background-color: green;"),s.setAttribute("disabled","")),a.appendChild(s)}},u=(e,t,r)=>{const o=document.querySelector(".dialog"),n=parseInt(r.getAttribute("data-x")),l=parseInt(r.getAttribute("data-y")),u=document.querySelector(".winner"),c=document.querySelector(".end-game"),d=document.querySelector("#play-window"),s=document.querySelector(".player-name"),i=document.querySelector("main");r.addEventListener("click",(m=>{m.preventDefault();const h=r.getAttribute("class"),p=d.getAttribute("data-id"),b=i.getAttribute("class");let y,g;y="One-square"===h?e.board:t.board,g=y.getBoard(),y.receiveAttack(n,l),null===g[n][l]?(a("One-square"===h?t:e),r.setAttribute("style","background-color: yellow;"),s.textContent="pvc"===b?"Computer`s turn!":"player-One"===p?"Player Two`s turn!":"Player One`s turn!",o.showModal()):(r.setAttribute("style","background-color: red;"),y.isAllSunk()&&(r.setAttribute("style","background-color: red;"),c.showModal(),u.textContent="player-Two"===p?"Congratulations Player Two!":"Congratulations Player One!"))}))},c=e=>{const t=e.board.getShips()[document.querySelector("#ships").value].getShip().length,r=document.querySelector(".shape");for(let e=1;e<=t;e++){const e=document.createElement("div");e.classList.add("square"),r.appendChild(e)}},d=document.querySelector(".game_mode"),s=document.querySelector("#pvp"),i=document.querySelector("#pvc"),m=document.querySelectorAll(".restart"),h=document.querySelector(".end-game"),p=document.querySelector("form"),b=document.querySelector("#ships");let y=r("One"),g=r("Two");var S,f;S=y,f=g,document.querySelector("#placeShipBtn").addEventListener("click",(e=>{e.preventDefault();let t=document.querySelector("form").getAttribute("id");const r=parseInt(document.querySelector("#y-coor").value),o=parseInt(document.querySelector("#x-coor").value),a=document.querySelector("#ships").value,l=document.querySelector("#orientation").value;let u;u="playerOne-form"===t?S.board.getShips()[a]:f.board.getShips()[a],u.getShip().orientation=l,Number.isNaN(r)||Number.isNaN(o)||("playerOne-form"===t?(S.board.placeShip(r,o,u),n(S)):(f.board.placeShip(r,o,u),n(f)))})),((e,t)=>{const r=document.querySelector("main"),o=document.querySelector("#finBtn"),n=document.querySelector("form"),l=document.querySelector(".player-name");let u=!1;o.addEventListener("click",(o=>{let c;o.preventDefault();const d=r.getAttribute("class");let s=n.getAttribute("id");if(c="playerOne-form"===s?e.board.getShips():t.board.getShips(),Object.values(c).forEach((e=>{const t=e.getShip().comp;return u=0!==t.length})),u){const r=document.querySelector("#x-coor"),o=document.querySelector("#y-coor"),u=document.querySelector("#battleship");if(r.value="",o.value="",u.removeAttribute("selected"),u.setAttribute("selected",""),"playerOne-form"===s&&(n.setAttribute("id","playerTwo-form"),a(e)),"pvc"===d||"playerTwo-form"===s){n.setAttribute("style","display: none;"),a(t);const e=document.querySelector(".dialog");l.textContent="Player One`s turn!",e.showModal()}}else alert("Please place all the ships first")}))})(y,g),((e,t)=>{const r=document.querySelector("main"),o=document.querySelector(".dialog"),a=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(u=>{u.preventDefault();let c=a.getAttribute("data-id");if("player-Two"===c)return n(e),l(e,t,c),a.setAttribute("data-id",`player-${e.number}`),o.close();if("player-One"===c){const u=r.getAttribute("class");return a.setAttribute("data-id",`player-${t.number}`),"pvc"===u?(((e,t)=>{const r=e.board,o=r.getBoard(),a=r.getMisses(),u=r.getHits(),c=document.querySelector("#play-window"),d=document.querySelector(".winner"),s=document.querySelector(".end-game");let i=Math.floor(10*Math.random()),m=Math.floor(10*Math.random()),h=!0;for(;!0===h;)if(a.find((e=>e[0]===i&&e[1]===m))||u.find((e=>e[0]===i&&e[1]===m)))i=Math.floor(10*Math.random()),m=Math.floor(10*Math.random());else if(r.receiveAttack(i,m),null===o[i][m]){const r=`player-${t.number}`;c.setAttribute("data-id",`player-${e.number}`),n(e),l(e,t,r),h=!1}else e.board.isAllSunk()?(h=!1,s.showModal(),d.textContent="Computer won!"):(i=Math.floor(10*Math.random()),m=Math.floor(10*Math.random()))})(e,t),o.close()):(n(t),l(e,t,c),o.close())}}))})(y,g),((e,t)=>{const r=document.querySelector("form");document.querySelector("#random").addEventListener("click",(o=>{o.preventDefault(),"playerOne-form"===r.getAttribute("id")?(e.board.populateBd(),n(e)):(t.board.populateBd(),n(t))}))})(y,g),n(y),n(g),c(y),s.addEventListener("click",(e=>(e.preventDefault(),d.close()))),i.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main");var r;return(r=g).board.populateBd(),n(r),a(r),t.classList.add("pvc"),d.close()})),m.forEach((e=>e.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main"),r=document.querySelector("#play-window"),o=document.querySelector("#x-coor"),a=document.querySelector("#y-coor"),l=document.querySelector("#battleship");h.close(),p.setAttribute("id","playerOne-form"),p.removeAttribute("style"),t.classList.remove("pvc"),r.setAttribute("data-id","player-Two"),o.value="",a.value="",l.removeAttribute("selected"),l.setAttribute("selected",""),y.board.resetBoard(),g.board.resetBoard(),n(y),n(g),d.showModal()})))),b.addEventListener("change",(()=>{const e=document.querySelector(".shape");for(;e.lastElementChild;)e.removeChild(e.lastElementChild);c(y)})),document.addEventListener("onload",d.showModal())})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aUQsU0FBU2dCLGNBQWMsV0FDM0JoRSxFQUFJZ0QsU0FBU2dCLGNBQWMsV0FDM0JrQyxFQUFNbEQsU0FBU2dCLGNBQWMsZUFFbkNNLEVBQU9rQyxRQUVQLEVBQUtoRSxhQUFhLEtBQU0sa0JBQ3hCLEVBQUsyRCxnQkFBZ0IsU0FDckIxQixFQUFLbkIsVUFBVXlELE9BQU8sT0FDdEJ4QyxFQUFPL0IsYUFBYSxVQUFXLGNBRS9CekMsRUFBRW9GLE1BQVEsR0FDVm5GLEVBQUVtRixNQUFRLEdBQ1ZlLEVBQUlDLGdCQUFnQixZQUNwQkQsRUFBSTFELGFBQWEsV0FBWSxJQUU3QmlELEVBQVU3RyxNQUFNa0QsYUFDaEI0RCxFQUFVOUcsTUFBTWtELGFBRWhCVyxFQUFZZ0QsR0FDWmhELEVBQVlpRCxHQUNaTCxFQUFTSixXQUFXLE1BSXhCLEVBQU9QLGlCQUFpQixVQUFVLEtBQ2hDLE1BQU1VLEVBQVlwQyxTQUFTZ0IsY0FBYyxVQUV6QyxLQUFPb0IsRUFBVWxDLGtCQUNma0MsRUFBVWpDLFlBQVlpQyxFQUFVbEMsa0JBRWxDZ0MsRUFBWU8sRUFBVSxJQUd4QnpDLFNBQVMwQixpQkFBaUIsU0FBVVcsRUFBU0osWSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9ET00uanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IChuKSA9PiB7XG4gIGxldCBzaGlwT2JqID0ge307XG5cbiAgc2hpcE9ialtcImxlbmd0aFwiXSA9IG47XG4gIHNoaXBPYmpbXCJoaXRDb3VudFwiXSA9IDA7XG4gIHNoaXBPYmpbXCJzdW5rXCJdID0gZmFsc2U7XG4gIHNoaXBPYmpbXCJvcmllbnRhdGlvblwiXSA9IFwiaG9yaXpvbnRhbFwiO1xuICBzaGlwT2JqW1wiY29tcFwiXSA9IFtdO1xuICBzaGlwT2JqW1wiaGl0Q29vclwiXSA9IFtdO1xuXG4gIGNvbnN0IGdldFNoaXAgPSAoKSA9PiBzaGlwT2JqO1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBzaGlwT2JqLmhpdENvdW50ICs9IDE7XG4gICAgaWYgKHNoaXBPYmouaGl0Q291bnQgPT09IHNoaXBPYmoubGVuZ3RoKSBzaGlwT2JqLnN1bmsgPSB0cnVlO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcE9iai5zdW5rID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuICB9O1xuXG4gIGNvbnN0IHJlc2V0U2hpcCA9ICgpID0+IHtcbiAgICBzaGlwT2JqLmxlbmd0aCA9IG47XG4gICAgc2hpcE9iai5oaXRDb3VudCA9IDA7XG4gICAgc2hpcE9iai5zdW5rID0gZmFsc2U7XG4gICAgc2hpcE9iai5vcmllbnRhdGlvbiA9IFwiaG9yaXpvbnRhbFwiO1xuICAgIHNoaXBPYmouY29tcCA9IFtdO1xuICAgIHNoaXBPYmouaGl0Q29vciA9IFtdO1xuXG4gICAgcmV0dXJuIHNoaXBPYmo7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRTaGlwLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gICAgcmVzZXRTaGlwLFxuICB9O1xufTtcblxuZXhwb3J0IHsgU2hpcCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcblxuY29uc3QgR2FtZWJvYXJkID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXTtcbiAgbGV0IG1pc3NlcyA9IFtdO1xuICBsZXQgaGl0cyA9IFtdO1xuXG4gIGxldCBhbGxTaGlwcyA9IHtcbiAgICBiYXR0bGVzaGlwOiBTaGlwKDQpLFxuICAgIGNydWlzZXJfSTogU2hpcCgzKSxcbiAgICBjcnVpc2VyX0lJOiBTaGlwKDMpLFxuICAgIGRlc3Ryb3llcl9JOiBTaGlwKDIpLFxuICAgIGRlc3Ryb3llcl9JSTogU2hpcCgyKSxcbiAgICBkZXN0cm95ZXJfSUlJOiBTaGlwKDIpLFxuICAgIHN1Ym1hcmluZV9JOiBTaGlwKDEpLFxuICAgIHN1Ym1hcmluZV9JSTogU2hpcCgxKSxcbiAgICBzdWJtYXJpbmVfSUlJOiBTaGlwKDEpLFxuICAgIHN1Ym1hcmluZV9JVjogU2hpcCgxKSxcbiAgfTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkO1xuICBjb25zdCBnZXRNaXNzZXMgPSAoKSA9PiBtaXNzZXM7XG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4gYWxsU2hpcHM7XG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiBoaXRzO1xuXG4gIGNvbnN0IGNyZWF0ZUJvYXJkID0gKCkgPT4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgYm9hcmRbaV0gPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBib2FyZFtpXVtqXSA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvYXJkO1xuICB9O1xuXG4gIGNvbnN0IGlzRW1wdHkgPSAoeCwgeSkgPT4ge1xuICAgIHJldHVybiBib2FyZFt4XVt5XSA9PT0gbnVsbCA/IHRydWUgOiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBpc0ZpdCA9IChhcnIpID0+IHtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIGFyci5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBpZiAoaXRlbVswXSA+IDkgfHwgaXRlbVsxXSA+IDkgfHwgIWlzRW1wdHkoaXRlbVswXSwgaXRlbVsxXSkpXG4gICAgICAgIHJldHVybiAoc3RhdHVzID0gZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfTtcblxuICBjb25zdCBjcmVhdGVDb21wID0gKHgsIHksIHNoaXApID0+IHtcbiAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG4gICAgY29uc3Qgb3JpZW50YXRpb24gPSBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbjtcbiAgICBsZXQgdGVtcCA9IFtdO1xuICAgIGxldCBhID0geDtcbiAgICBsZXQgYiA9IHk7XG5cbiAgICBpZiAob3JpZW50YXRpb24gPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICB3aGlsZSAoYiAhPT0geSArIGxlbmd0aCkge1xuICAgICAgICB0ZW1wLnB1c2goW3gsIGJdKTtcbiAgICAgICAgYiArPSAxO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB3aGlsZSAoYSAhPT0geCArIGxlbmd0aCkge1xuICAgICAgICB0ZW1wLnB1c2goW2EsIHldKTtcbiAgICAgICAgYSArPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0ZW1wO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9ICh4LCB5LCBzaGlwKSA9PiB7XG4gICAgbGV0IHRlbXAgPSBbXTtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIGlmICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IHkgPiA5KSB7XG4gICAgICByZXR1cm4gYWxlcnQoXCJTaGlwIGlzIG91dCBvZiBib3VuZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBzdGF0dXMgPSBpc0ZpdCh0ZW1wKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdHVzID09PSBmYWxzZSkge1xuICAgICAgc3RhdHVzID0gdHJ1ZTtcbiAgICAgIHRlbXAgPSBbXTtcbiAgICAgIHJldHVybiBhbGVydChcInNxdWFyZSBpcyBhbHJlYWR5IG9jY3VwaWVkXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaGlwLmdldFNoaXAoKS5jb21wID0gdGVtcDtcblxuICAgICAgc2hpcC5nZXRTaGlwKCkuY29tcC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGJvYXJkW2l0ZW1bMF1dW2l0ZW1bMV1dID0gc2hpcDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCBwb3B1bGF0ZUJkID0gKCkgPT4ge1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhhbGxTaGlwcyk7XG4gICAgY29uc3QgZGlyZWN0aW9ucyA9IFtcImhvcml6b250YWxcIiwgXCJ2ZXJ0aWNhbFwiXTtcblxuICAgIGtleXMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCBzaGlwID0gYWxsU2hpcHNba2V5XTtcbiAgICAgIGNvbnN0IGxlbmd0aCA9IHNoaXAuZ2V0U2hpcCgpLmxlbmd0aDtcblxuICAgICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGxldCB6ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyZWN0aW9uc1t6XTtcbiAgICAgIGxldCB0ZW1wID0gY3JlYXRlQ29tcCh4LCB5LCBzaGlwKTtcbiAgICAgIGxldCBmaXQgPSBpc0ZpdCh0ZW1wKTtcblxuICAgICAgd2hpbGUgKHkgKyBsZW5ndGggLSAxID4gOSB8fCB4ICsgbGVuZ3RoIC0gMSA+IDkgfHwgZml0ID09PSBmYWxzZSkge1xuICAgICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICB6ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICAgICAgc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBkaXJlY3Rpb25zW3pdO1xuICAgICAgICB0ZW1wID0gY3JlYXRlQ29tcCh4LCB5LCBzaGlwKTtcbiAgICAgICAgZml0ID0gaXNGaXQodGVtcCk7XG4gICAgICB9XG5cbiAgICAgIHBsYWNlU2hpcCh4LCB5LCBzaGlwKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHgsIHkpID0+IHtcbiAgICBpZiAoYm9hcmRbeF1beV0gPT09IG51bGwpIG1pc3Nlcy5wdXNoKFt4LCB5XSk7XG4gICAgZWxzZSB7XG4gICAgICBoaXRzLnB1c2goW3gsIHldKTtcbiAgICAgIGJvYXJkW3hdW3ldLmhpdCgpO1xuICAgICAgYm9hcmRbeF1beV0uZ2V0U2hpcCgpLmhpdENvb3IucHVzaChbeCwgeV0pO1xuICAgIH1cblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCBpc0FsbFN1bmsgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBPYmplY3QudmFsdWVzKGFsbFNoaXBzKTtcbiAgICBsZXQgc3RhdHVzID0gdHJ1ZTtcblxuICAgIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIGlmICghc2hpcC5pc1N1bmsoKSkge1xuICAgICAgICByZXR1cm4gKHN0YXR1cyA9IGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBzdGF0dXM7XG4gIH07XG5cbiAgY29uc3QgcmVzZXRCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYWxsU2hpcHMpO1xuICAgIGJvYXJkID0gW107XG4gICAgbWlzc2VzID0gW107XG4gICAgaGl0cyA9IFtdO1xuXG4gICAga2V5cy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBhbGxTaGlwc1tzaGlwXS5yZXNldFNoaXAoKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNyZWF0ZUJvYXJkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRCb2FyZCxcbiAgICBnZXRTaGlwcyxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGdldE1pc3NlcyxcbiAgICBnZXRIaXRzLFxuICAgIGlzQWxsU3VuayxcbiAgICBwb3B1bGF0ZUJkLFxuICAgIHJlc2V0Qm9hcmQsXG4gIH07XG59O1xuXG5leHBvcnQgeyBHYW1lYm9hcmQgfTtcbiIsImltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5jb25zdCBQbGF5ZXIgPSAobnVtYmVyKSA9PiB7XG4gIGxldCB3aW4gPSBmYWxzZTtcbiAgbGV0IGJvYXJkID0gR2FtZWJvYXJkKCk7XG4gIGxldCBpc0NvbXAgPSBmYWxzZTtcblxuICByZXR1cm4ge1xuICAgIG51bWJlcixcbiAgICB3aW4sXG4gICAgYm9hcmQsXG4gICAgaXNDb21wLFxuICB9O1xufTtcblxuZXhwb3J0IHsgUGxheWVyIH07XG4iLCJjb25zdCBmaWxsU3FyID0gKHBsYXllciwgc3FyLCB0YWcsIHgsIHkpID0+IHtcbiAgY29uc3QgbWlzc2VzID0gcGxheWVyLmJvYXJkLmdldE1pc3NlcygpO1xuXG4gIGlmIChzcXIgPT09IG51bGwpIHtcbiAgICBpZiAoXG4gICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHllbGxvdztcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGJsdWU7XCIpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChcbiAgICBzcXIuZ2V0U2hpcCgpLmhpdENvb3IuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICB9KVxuICApIHtcbiAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICB9XG59O1xuXG5jb25zdCByZW5kZXJTaGlwID0gKHBsYXllcikgPT4ge1xuICBsZXQgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHNMaXN0ID0gT2JqZWN0LmtleXMoc2hpcHNPYmopO1xuXG4gIHNoaXBzTGlzdC5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29tcCA9IHNoaXBzT2JqW3NoaXBdLmdldFNoaXAoKS5jb21wO1xuXG4gICAgaWYgKGNvbXAubGVuZ3RoICE9PSAwKSB7XG4gICAgICBjb25zdCB4Q29vciA9IGNvbXBbMF1bMF07XG4gICAgICBjb25zdCB5Q29vciA9IGNvbXBbMF1bMV07XG4gICAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcHNPYmpbc2hpcF0pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGJvYXJkO1xufTtcblxuY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIHBsYXllci5ib2FyZC5jcmVhdGVCb2FyZCgpO1xuXG4gIHJlbmRlclNoaXAocGxheWVyKTtcblxuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBwbGF5ZXJOdW0gPSBwbGF5ZXIubnVtYmVyO1xuICBsZXQgY3VycmVudEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJvYXJkJHtwbGF5ZXJOdW19YCk7XG5cbiAgd2hpbGUgKGN1cnJlbnRCb2FyZC5sYXN0RWxlbWVudENoaWxkKVxuICAgIGN1cnJlbnRCb2FyZC5yZW1vdmVDaGlsZChjdXJyZW50Qm9hcmQubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm9hcmQubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwbGF5ZXJOdW19LXNxdWFyZWApO1xuXG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS14XCIsIGAke2l9YCk7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS15XCIsIGAke2p9YCk7XG5cbiAgICAgIGZpbGxTcXIocGxheWVyLCBib2FyZFtpXVtqXSwgc3F1YXJlLCBpLCBqKTtcblxuICAgICAgY3VycmVudEJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRCb2FyZDtcbn07XG5cbmNvbnN0IGluaXRQbGFjZVNoaXAgPSAocE9uZSwgcFR3bykgPT4ge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxhY2VTaGlwQnRuYCk7XG5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKTtcbiAgICBsZXQgaWQgPSBmb3JtLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuXG4gICAgY29uc3QgeENvb3IgPSBwYXJzZUludChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjeS1jb29yYCkudmFsdWUpO1xuICAgIGNvbnN0IHlDb29yID0gcGFyc2VJbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3gtY29vcmApLnZhbHVlKTtcbiAgICBjb25zdCBzaGlwTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNzaGlwc2ApLnZhbHVlO1xuXG4gICAgY29uc3Qgb3JpZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI29yaWVudGF0aW9uYCkudmFsdWU7XG5cbiAgICBsZXQgc2hpcDtcbiAgICBpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiXG4gICAgICA/IChzaGlwID0gcE9uZS5ib2FyZC5nZXRTaGlwcygpW3NoaXBOYW1lXSlcbiAgICAgIDogKHNoaXAgPSBwVHdvLmJvYXJkLmdldFNoaXBzKClbc2hpcE5hbWVdKTtcblxuICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gb3JpZW50O1xuXG4gICAgaWYgKE51bWJlci5pc05hTih4Q29vcikgfHwgTnVtYmVyLmlzTmFOKHlDb29yKSkgcmV0dXJuO1xuICAgIGVsc2Uge1xuICAgICAgaWYgKGlkID09PSBcInBsYXllck9uZS1mb3JtXCIpIHtcbiAgICAgICAgcE9uZS5ib2FyZC5wbGFjZVNoaXAoeENvb3IsIHlDb29yLCBzaGlwKTtcbiAgICAgICAgcmVuZGVyQm9hcmQocE9uZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwVHdvLmJvYXJkLnBsYWNlU2hpcCh4Q29vciwgeUNvb3IsIHNoaXApO1xuICAgICAgICByZW5kZXJCb2FyZChwVHdvKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgaW5pdEZpblNldHVwID0gKHBPbmUsIHBUd28pID0+IHtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZmluQnRuYCk7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBmb3JtYCk7XG4gIGNvbnN0IHBsYXllck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1uYW1lXCIpO1xuXG4gIGxldCBpc0FsbFBsYWNlZCA9IGZhbHNlO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBsZXQgc2hpcHNPYmo7XG4gICAgY29uc3QgbW9kZSA9IG1haW4uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIik7XG4gICAgbGV0IGlkID0gZm9ybS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcblxuICAgIGlkID09PSBcInBsYXllck9uZS1mb3JtXCJcbiAgICAgID8gKHNoaXBzT2JqID0gcE9uZS5ib2FyZC5nZXRTaGlwcygpKVxuICAgICAgOiAoc2hpcHNPYmogPSBwVHdvLmJvYXJkLmdldFNoaXBzKCkpO1xuXG4gICAgY29uc3Qgc2hpcHMgPSBPYmplY3QudmFsdWVzKHNoaXBzT2JqKTtcblxuICAgIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIGNvbnN0IGNvbXAgPSBzaGlwLmdldFNoaXAoKS5jb21wO1xuICAgICAgaWYgKGNvbXAubGVuZ3RoID09PSAwKSByZXR1cm4gKGlzQWxsUGxhY2VkID0gZmFsc2UpO1xuICAgICAgZWxzZSByZXR1cm4gKGlzQWxsUGxhY2VkID0gdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpZiAoaXNBbGxQbGFjZWQpIHtcbiAgICAgIGNvbnN0IHggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3gtY29vclwiKTtcbiAgICAgIGNvbnN0IHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ktY29vclwiKTtcbiAgICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYmF0dGxlc2hpcFwiKTtcblxuICAgICAgeC52YWx1ZSA9IFwiXCI7XG4gICAgICB5LnZhbHVlID0gXCJcIjtcbiAgICAgIG9wdC5yZW1vdmVBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiKTtcbiAgICAgIG9wdC5zZXRBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiLCBcIlwiKTtcblxuICAgICAgaWYgKGlkID09PSBcInBsYXllck9uZS1mb3JtXCIpIHtcbiAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcInBsYXllclR3by1mb3JtXCIpO1xuICAgICAgICBoaWRlQm9hcmQocE9uZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChtb2RlID09PSBcInB2Y1wiIHx8IGlkID09PSBcInBsYXllclR3by1mb3JtXCIpIHtcbiAgICAgICAgZm9ybS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImRpc3BsYXk6IG5vbmU7XCIpO1xuICAgICAgICBoaWRlQm9hcmQocFR3byk7XG4gICAgICAgIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlhbG9nXCIpO1xuICAgICAgICBwbGF5ZXJOYW1lLnRleHRDb250ZW50ID0gXCJQbGF5ZXIgT25lYHMgdHVybiFcIjtcbiAgICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhbGVydChcIlBsZWFzZSBwbGFjZSBhbGwgdGhlIHNoaXBzIGZpcnN0XCIpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBoaWRlQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIGxldCBzcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLiR7cGxheWVyLm51bWJlcn0tc3F1YXJlYCk7XG5cbiAgc3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogZ3JheTtcIik7XG4gIH0pO1xufTtcblxuY29uc3QgaW5pdHBsYXlCdG4gPSAoUE9uZSwgUFR3bykgPT4ge1xuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG4gIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlhbG9nXCIpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheVwiKTtcblxuICBwbGF5QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgcGxheWVyID0gcGxheVdpbmRvdy5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuXG4gICAgaWYgKHBsYXllciA9PT0gXCJwbGF5ZXItVHdvXCIpIHtcbiAgICAgIHJlbmRlckJvYXJkKFBPbmUpO1xuICAgICAgcmVuZGVyUGxheUJkKFBPbmUsIFBUd28sIHBsYXllcik7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke1BPbmUubnVtYmVyfWApO1xuICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgIH0gZWxzZSBpZiAocGxheWVyID09PSBcInBsYXllci1PbmVcIikge1xuICAgICAgY29uc3QgbW9kZSA9IG1haW4uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIik7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke1BUd28ubnVtYmVyfWApO1xuICAgICAgaWYgKG1vZGUgPT09IFwicHZjXCIpIHtcbiAgICAgICAgYXV0b0F0ayhQT25lLCBQVHdvKTtcbiAgICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVuZGVyQm9hcmQoUFR3byk7XG4gICAgICAgIHJlbmRlclBsYXlCZChQT25lLCBQVHdvLCBwbGF5ZXIpO1xuICAgICAgICByZXR1cm4gZGlhbG9nLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IHJlbmRlclBsYXlCZCA9IChwT25lLCBwVHdvLCBpZCkgPT4ge1xuICBsZXQgYm9hcmQ7XG4gIGxldCBtaXNzZXM7XG4gIGxldCBjdXJyQm9hcmQ7XG5cbiAgaWYgKGlkID09PSBcInBsYXllci1Ud29cIikge1xuICAgIGJvYXJkID0gcFR3by5ib2FyZC5nZXRCb2FyZCgpO1xuICAgIG1pc3NlcyA9IHBUd28uYm9hcmQuZ2V0TWlzc2VzKCk7XG4gICAgY3VyckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2JvYXJkJHtwVHdvLm51bWJlcn1gKTtcbiAgfSBlbHNlIHtcbiAgICBib2FyZCA9IHBPbmUuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgICBtaXNzZXMgPSBwT25lLmJvYXJkLmdldE1pc3NlcygpO1xuICAgIGN1cnJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNib2FyZCR7cE9uZS5udW1iZXJ9YCk7XG4gIH1cblxuICB3aGlsZSAoY3VyckJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpXG4gICAgY3VyckJvYXJkLnJlbW92ZUNoaWxkKGN1cnJCb2FyZC5sYXN0RWxlbWVudENoaWxkKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBib2FyZC5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgaXRlbSA9IGJvYXJkW2ldW2pdO1xuXG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgaWYgKGlkID09PSBcInBsYXllci1PbmVcIikge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwT25lLm51bWJlcn0tc3F1YXJlYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwVHdvLm51bWJlcn0tc3F1YXJlYCk7XG4gICAgICB9XG5cbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIiwgYCR7aX1gKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIiwgYCR7an1gKTtcblxuICAgICAgaW5pdFNxckJ0bihwT25lLCBwVHdvLCBzcXVhcmUpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0gIT09IG51bGwgJiZcbiAgICAgICAgaXRlbS5nZXRTaGlwKCkuaGl0Q291bnQgPiAwICYmXG4gICAgICAgIGl0ZW0uZ2V0U2hpcCgpLmhpdENvb3IuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICAgIHJldHVybiBpdGVtWzBdID09PSBpICYmIGl0ZW1bMV0gPT09IGo7XG4gICAgICAgIH0pXG4gICAgICApIHtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIG1pc3Nlcy5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IGkgJiYgaXRlbVsxXSA9PT0gajtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjtcIik7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICAgIH1cblxuICAgICAgY3VyckJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBpbml0U3FyQnRuID0gKHBPbmUsIHBUd28sIHNxdWFyZSkgPT4ge1xuICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgY29uc3QgeCA9IHBhcnNlSW50KHNxdWFyZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIikpO1xuICBjb25zdCB5ID0gcGFyc2VJbnQoc3F1YXJlLmdldEF0dHJpYnV0ZShcImRhdGEteVwiKSk7XG4gIGNvbnN0IHdpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud2lubmVyXCIpO1xuICBjb25zdCBlbmRNc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVuZC1nYW1lXCIpO1xuICBjb25zdCB3aW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYXktd2luZG93XCIpO1xuICBjb25zdCBwbGF5ZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItbmFtZVwiKTtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuXG4gIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3Qgc3F1YXJlSWQgPSBzcXVhcmUuZ2V0QXR0cmlidXRlKFwiY2xhc3NcIik7XG4gICAgY29uc3QgaWQgPSB3aW5kb3cuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcbiAgICBjb25zdCBtb2RlID0gbWFpbi5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKTtcbiAgICBsZXQgYm9hcmQ7XG4gICAgbGV0IGJvYXJkTGlzdDtcblxuICAgIGlmIChzcXVhcmVJZCA9PT0gXCJPbmUtc3F1YXJlXCIpIHtcbiAgICAgIGJvYXJkID0gcE9uZS5ib2FyZDtcbiAgICB9IGVsc2Uge1xuICAgICAgYm9hcmQgPSBwVHdvLmJvYXJkO1xuICAgIH1cblxuICAgIGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG5cbiAgICBib2FyZC5yZWNlaXZlQXR0YWNrKHgsIHkpO1xuICAgIGlmIChib2FyZExpc3RbeF1beV0gPT09IG51bGwpIHtcbiAgICAgIGlmIChzcXVhcmVJZCA9PT0gXCJPbmUtc3F1YXJlXCIpIHtcbiAgICAgICAgaGlkZUJvYXJkKHBUd28pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGlkZUJvYXJkKHBPbmUpO1xuICAgICAgfVxuXG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7XCIpO1xuXG4gICAgICBpZiAobW9kZSA9PT0gXCJwdmNcIikge1xuICAgICAgICBwbGF5ZXJOYW1lLnRleHRDb250ZW50ID0gXCJDb21wdXRlcmBzIHR1cm4hXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZCA9PT0gXCJwbGF5ZXItT25lXCJcbiAgICAgICAgICA/IChwbGF5ZXJOYW1lLnRleHRDb250ZW50ID0gXCJQbGF5ZXIgVHdvYHMgdHVybiFcIilcbiAgICAgICAgICA6IChwbGF5ZXJOYW1lLnRleHRDb250ZW50ID0gXCJQbGF5ZXIgT25lYHMgdHVybiFcIik7XG4gICAgICB9XG5cbiAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcblxuICAgICAgaWYgKGJvYXJkLmlzQWxsU3VuaygpKSB7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHJlZDtcIik7XG4gICAgICAgIGVuZE1zZy5zaG93TW9kYWwoKTtcbiAgICAgICAgaWYgKGlkID09PSBcInBsYXllci1Ud29cIikge1xuICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IGBDb25ncmF0dWxhdGlvbnMgUGxheWVyIFR3byFgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IGBDb25ncmF0dWxhdGlvbnMgUGxheWVyIE9uZSFgO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGNvbXBNb2RlID0gKHBsYXllcikgPT4ge1xuICBwbGF5ZXIuYm9hcmQucG9wdWxhdGVCZCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXIpO1xuICBoaWRlQm9hcmQocGxheWVyKTtcbn07XG5cbmNvbnN0IGF1dG9BdGsgPSAocGxheU9uZSwgcGxheVR3bykgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXlPbmUuYm9hcmQ7XG4gIGNvbnN0IGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IG1pc3NlcyA9IGJvYXJkLmdldE1pc3NlcygpO1xuICBjb25zdCBoaXRzID0gYm9hcmQuZ2V0SGl0cygpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgY29uc3Qgd2lubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53aW5uZXJcIik7XG4gIGNvbnN0IGVuZE1zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZW5kLWdhbWVcIik7XG4gIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgbGV0IGNvbnQgPSB0cnVlO1xuXG4gIHdoaWxlIChjb250ID09PSB0cnVlKSB7XG4gICAgaWYgKFxuICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICAgIH0pIHx8XG4gICAgICBoaXRzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG5cbiAgICBpZiAoYm9hcmRMaXN0W3hdW3ldID09PSBudWxsKSB7XG4gICAgICBjb25zdCBpZCA9IGBwbGF5ZXItJHtwbGF5VHdvLm51bWJlcn1gO1xuICAgICAgcGxheVdpbmRvdy5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGBwbGF5ZXItJHtwbGF5T25lLm51bWJlcn1gKTtcbiAgICAgIHJlbmRlckJvYXJkKHBsYXlPbmUpO1xuICAgICAgcmVuZGVyUGxheUJkKHBsYXlPbmUsIHBsYXlUd28sIGlkKTtcbiAgICAgIGNvbnQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHBsYXlPbmUuYm9hcmQuaXNBbGxTdW5rKCkpIHtcbiAgICAgICAgY29udCA9IGZhbHNlO1xuICAgICAgICBlbmRNc2cuc2hvd01vZGFsKCk7XG4gICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IFwiQ29tcHV0ZXIgd29uIVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGluaXRSYW5kQnRuID0gKHBPbmUsIHBUd28pID0+IHtcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpO1xuICBjb25zdCByYW5kQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyYW5kb21cIik7XG5cbiAgcmFuZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBpZCA9IGZvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIik7XG5cbiAgICBpZiAoaWQgPT09IFwicGxheWVyT25lLWZvcm1cIikge1xuICAgICAgcE9uZS5ib2FyZC5wb3B1bGF0ZUJkKCk7XG4gICAgICByZW5kZXJCb2FyZChwT25lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcFR3by5ib2FyZC5wb3B1bGF0ZUJkKCk7XG4gICAgICByZW5kZXJCb2FyZChwVHdvKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgcmVuZGVyU2hhcGUgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IHNoaXBzT2JqID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNlbGVjdGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzaGlwc1wiKTtcbiAgY29uc3QgbmFtZSA9IHNlbGVjdGVkLnZhbHVlO1xuICBjb25zdCBzaGlwID0gc2hpcHNPYmpbbmFtZV07XG4gIGNvbnN0IGxlbmd0aCA9IHNoaXAuZ2V0U2hpcCgpLmxlbmd0aDtcbiAgY29uc3Qgc2hhcGVDb250ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zaGFwZVwiKTtcblxuICBmb3IgKGxldCBpID0gMTsgaSA8PSBsZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJzcXVhcmVcIik7XG4gICAgc2hhcGVDb250LmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gIH1cbn07XG5cbmV4cG9ydCB7XG4gIHJlbmRlckJvYXJkLFxuICBpbml0UGxhY2VTaGlwLFxuICBpbml0RmluU2V0dXAsXG4gIGluaXRwbGF5QnRuLFxuICBjb21wTW9kZSxcbiAgaW5pdFJhbmRCdG4sXG4gIHJlbmRlclNoYXBlLFxufTtcbiIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IHtcbiAgcmVuZGVyQm9hcmQsXG4gIGluaXRQbGFjZVNoaXAsXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxuICBpbml0UmFuZEJ0bixcbiAgcmVuZGVyU2hhcGUsXG59IGZyb20gXCIuL0RPTVwiO1xuXG5jb25zdCBnYW1lTW9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FtZV9tb2RlXCIpO1xuY29uc3QgcHZwQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwdnBcIik7XG5jb25zdCBwdmNCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3B2Y1wiKTtcbmNvbnN0IHJlc3RhcnRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJlc3RhcnRcIik7XG5jb25zdCBlbmRNc2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVuZC1nYW1lXCIpO1xuY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpO1xuY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzaGlwc1wiKTtcbmxldCBwbGF5ZXJPbmUgPSBQbGF5ZXIoXCJPbmVcIik7XG5sZXQgcGxheWVyVHdvID0gUGxheWVyKFwiVHdvXCIpO1xuXG5pbml0UGxhY2VTaGlwKHBsYXllck9uZSwgcGxheWVyVHdvKTtcbmluaXRGaW5TZXR1cChwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5pbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5pbml0UmFuZEJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5yZW5kZXJCb2FyZChwbGF5ZXJPbmUpO1xucmVuZGVyQm9hcmQocGxheWVyVHdvKTtcbnJlbmRlclNoYXBlKHBsYXllck9uZSk7XG5cbnB2cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICByZXR1cm4gZ2FtZU1vZGUuY2xvc2UoKTtcbn0pO1xuXG5wdmNCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuXG4gIGNvbXBNb2RlKHBsYXllclR3byk7XG5cbiAgbWFpbi5jbGFzc0xpc3QuYWRkKFwicHZjXCIpO1xuXG4gIHJldHVybiBnYW1lTW9kZS5jbG9zZSgpO1xufSk7XG5cbnJlc3RhcnRCdG4uZm9yRWFjaCgoYnV0dG9uKSA9PlxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbiAgICBjb25zdCB3aW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYXktd2luZG93XCIpO1xuICAgIGNvbnN0IHggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3gtY29vclwiKTtcbiAgICBjb25zdCB5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN5LWNvb3JcIik7XG4gICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNiYXR0bGVzaGlwXCIpO1xuXG4gICAgZW5kTXNnLmNsb3NlKCk7XG5cbiAgICBmb3JtLnNldEF0dHJpYnV0ZShcImlkXCIsIFwicGxheWVyT25lLWZvcm1cIik7XG4gICAgZm9ybS5yZW1vdmVBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcbiAgICBtYWluLmNsYXNzTGlzdC5yZW1vdmUoXCJwdmNcIik7XG4gICAgd2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgXCJwbGF5ZXItVHdvXCIpO1xuXG4gICAgeC52YWx1ZSA9IFwiXCI7XG4gICAgeS52YWx1ZSA9IFwiXCI7XG4gICAgb3B0LnJlbW92ZUF0dHJpYnV0ZShcInNlbGVjdGVkXCIpO1xuICAgIG9wdC5zZXRBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiLCBcIlwiKTtcblxuICAgIHBsYXllck9uZS5ib2FyZC5yZXNldEJvYXJkKCk7XG4gICAgcGxheWVyVHdvLmJvYXJkLnJlc2V0Qm9hcmQoKTtcblxuICAgIHJlbmRlckJvYXJkKHBsYXllck9uZSk7XG4gICAgcmVuZGVyQm9hcmQocGxheWVyVHdvKTtcbiAgICBnYW1lTW9kZS5zaG93TW9kYWwoKTtcbiAgfSlcbik7XG5cbnNlbGVjdC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsICgpID0+IHtcbiAgY29uc3Qgc2hhcGVDb250ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zaGFwZVwiKTtcblxuICB3aGlsZSAoc2hhcGVDb250Lmxhc3RFbGVtZW50Q2hpbGQpXG4gICAgc2hhcGVDb250LnJlbW92ZUNoaWxkKHNoYXBlQ29udC5sYXN0RWxlbWVudENoaWxkKTtcblxuICByZW5kZXJTaGFwZShwbGF5ZXJPbmUpO1xufSk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmxvYWRcIiwgZ2FtZU1vZGUuc2hvd01vZGFsKCkpO1xuIl0sIm5hbWVzIjpbIlNoaXAiLCJuIiwic2hpcE9iaiIsImdldFNoaXAiLCJoaXQiLCJoaXRDb3VudCIsImxlbmd0aCIsInN1bmsiLCJpc1N1bmsiLCJyZXNldFNoaXAiLCJvcmllbnRhdGlvbiIsImNvbXAiLCJoaXRDb29yIiwiR2FtZWJvYXJkIiwiYm9hcmQiLCJtaXNzZXMiLCJoaXRzIiwiYWxsU2hpcHMiLCJiYXR0bGVzaGlwIiwiY3J1aXNlcl9JIiwiY3J1aXNlcl9JSSIsImRlc3Ryb3llcl9JIiwiZGVzdHJveWVyX0lJIiwiZGVzdHJveWVyX0lJSSIsInN1Ym1hcmluZV9JIiwic3VibWFyaW5lX0lJIiwic3VibWFyaW5lX0lJSSIsInN1Ym1hcmluZV9JViIsImlzRml0IiwiYXJyIiwic3RhdHVzIiwiZm9yRWFjaCIsIml0ZW0iLCJ4IiwieSIsImNyZWF0ZUNvbXAiLCJzaGlwIiwidGVtcCIsImEiLCJiIiwicHVzaCIsInBsYWNlU2hpcCIsImFsZXJ0IiwiY3JlYXRlQm9hcmQiLCJpIiwiaiIsImdldEJvYXJkIiwiZ2V0U2hpcHMiLCJyZWNlaXZlQXR0YWNrIiwiZ2V0TWlzc2VzIiwiZ2V0SGl0cyIsImlzQWxsU3VuayIsInNoaXBzIiwiT2JqZWN0IiwidmFsdWVzIiwicG9wdWxhdGVCZCIsImtleXMiLCJkaXJlY3Rpb25zIiwia2V5IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwieiIsImZpdCIsInJlc2V0Qm9hcmQiLCJQbGF5ZXIiLCJudW1iZXIiLCJ3aW4iLCJpc0NvbXAiLCJmaWxsU3FyIiwicGxheWVyIiwic3FyIiwidGFnIiwiZmluZCIsInNldEF0dHJpYnV0ZSIsInJlbmRlckJvYXJkIiwic2hpcHNPYmoiLCJ4Q29vciIsInlDb29yIiwicmVuZGVyU2hpcCIsInBsYXllck51bSIsImN1cnJlbnRCb2FyZCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJsYXN0RWxlbWVudENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzcXVhcmUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJoaWRlQm9hcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVuZGVyUGxheUJkIiwicE9uZSIsInBUd28iLCJpZCIsImN1cnJCb2FyZCIsInF1ZXJ5U2VsZWN0b3IiLCJpbml0U3FyQnRuIiwiZGlhbG9nIiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJ3aW5uZXIiLCJlbmRNc2ciLCJ3aW5kb3ciLCJwbGF5ZXJOYW1lIiwibWFpbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJzcXVhcmVJZCIsIm1vZGUiLCJib2FyZExpc3QiLCJ0ZXh0Q29udGVudCIsInNob3dNb2RhbCIsInJlbmRlclNoYXBlIiwidmFsdWUiLCJzaGFwZUNvbnQiLCJnYW1lTW9kZSIsInB2cEJ0biIsInB2Y0J0biIsInJlc3RhcnRCdG4iLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iLCJzaGlwTmFtZSIsIm9yaWVudCIsIk51bWJlciIsImlzTmFOIiwiYnV0dG9uIiwiZm9ybSIsImlzQWxsUGxhY2VkIiwib3B0IiwicmVtb3ZlQXR0cmlidXRlIiwiaW5pdEZpblNldHVwIiwiUE9uZSIsIlBUd28iLCJwbGF5V2luZG93IiwiY2xvc2UiLCJwbGF5T25lIiwicGxheVR3byIsImNvbnQiLCJhdXRvQXRrIiwiaW5pdHBsYXlCdG4iLCJpbml0UmFuZEJ0biIsInJlbW92ZSJdLCJzb3VyY2VSb290IjoiIn0=