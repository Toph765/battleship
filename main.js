(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.xCoor=null,t.yCoor=null,t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk}},t=()=>{let t=[],r=[],o={l_ship:e(4),m_ship_I:e(3),m_ship_II:e(3),s_ship_I:e(2),s_ship_II:e(2),s_ship_III:e(2),xs_ship_I:e(1),xs_ship_II:e(1),xs_ship_III:e(1),xs_ship_IV:e(1)};const n=e=>{let r=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(o=e[0],n=e[1],null!==t[o][n]))return r=!1;var o,n})),r},l=(e,t,r)=>{const o=r.getShip().length;let n=[],l=e,a=t;if("horizontal"===r.getShip().orientation)for(;a!==t+o;)n.push([e,a]),a+=1;else for(;l!==e+o;)n.push([l,t]),l+=1;return n},a=(e,r,o)=>{let a=[],i=!0;return r+length-1>9||e>9||e+length-1>9||r>9?console.log("error"):(a=l(e,r,o),i=n(a),!1===i?(i=!0,a=[],console.log("not empty")):(o.getShip().comp=a,o.getShip().comp.forEach((e=>{t[e[0]][e[1]]=o})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e][r]=null}return t},placeShip:a,getBoard:()=>t,getShips:()=>o,receiveAttack:(e,o)=>(null===t[e][o]?r.push([e,o]):(t[e][o].hit(),t[e][o].getShip().hitCoor.push([e,o])),t),getMisses:()=>r,isAllSunk:()=>{const e=Object.values(o);let t=!1;return e.forEach((e=>{if(!1===e.getShip().sunk)return t=!1;t=!0})),t},populateBd:()=>{const e=Object.keys(o),r=["horizontal","vertical"];return e.forEach((e=>{const t=o[e],i=t.getShip().length;let u=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),c=Math.floor(2*Math.random());t.getShip().orientation=r[c];let d=l(u,s,t),p=n(d);for(;s+i-1>9||u+i-1>9||!1===p;)u=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),c=Math.floor(2*Math.random()),t.getShip().orientation=r[c],d=l(u,s,t),p=n(d);a(u,s,t)})),t}}},r=e=>({number:e,win:!1,board:t(),isComp:!1}),o=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((r=>{const o=t[r].getShip().comp;if(0!==o.length){const n=o[0][0],l=o[0][1];e.board.placeShip(n,l,t[r])}}))})(e);const t=e.board.getBoard(),r=e.number;let o=document.getElementById(`board${r}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++){const l=document.createElement("div");l.classList.add(`${r}-square`),l.setAttribute("data-x",`${e}`),l.setAttribute("data-y",`${n}`),null===t[e][n]&&l.setAttribute("style","background-color: blue;"),o.appendChild(l)}return o},n=e=>{const t=e.board.getShips(),r=Object.keys(t),o=document.querySelector(`#player${e.number}-ships`);return r.forEach((e=>{const t=document.createElement("option");t.textContent=e,o.appendChild(t)})),o},l=e=>{document.querySelector(`#placeShipBtn-${e.number}`).addEventListener("click",(t=>{t.preventDefault();const r=parseInt(document.querySelector(`#player${e.number}-y`).value),n=parseInt(document.querySelector(`#player${e.number}-x`).value),l=document.querySelector(`#player${e.number}-ships`).value,a=document.querySelector(`#player${e.number}-orient`).value,i=e.board.getShips()[l];i.getShip().orientation=a,console.log(a),e.board.placeShip(r,n,i),o(e)}))},a=e=>{const t=e.number,r=document.querySelector(`#player${t}`),o=document.createElement("form"),n=document.createElement("select"),l=document.createElement("select"),a=document.createElement("input"),i=document.createElement("input"),u=document.createElement("button"),s=document.createElement("option"),c=document.createElement("option"),d=document.createElement("button");return o.setAttribute("id",`player${t}-form`),n.setAttribute("name","ships"),n.setAttribute("id",`player${t}-ships`),l.setAttribute("name","orientation"),l.setAttribute("id",`player${t}-orient`),a.setAttribute("type","text"),a.setAttribute("id",`player${t}-x`),a.setAttribute("name","x-coor"),a.setAttribute("placeholder","x"),i.setAttribute("type","text"),i.setAttribute("id",`player${t}-y`),i.setAttribute("name","y-coor"),i.setAttribute("placeholder","y"),u.setAttribute("id",`placeShipBtn-${t}`),u.textContent="Place",d.setAttribute("id",`player${t}-finBtn`),d.textContent="Finish set up",s.textContent="horizontal",c.textContent="vertical",l.append(s,c),o.append(n,a,i,l,u,d),r.appendChild(o),r},i=e=>{const t=document.querySelector(`#player${e.number}-finBtn`),r=document.querySelector(`#player${e.number}-form`),o=e.board.getShips(),n=Object.values(o);let l=!1;t.addEventListener("click",(t=>{t.preventDefault(),n.forEach((e=>{const t=e.getShip().comp;return l=0!==t.length})),l?r.setAttribute("style","display: none;"):console.log("Please place all the ships first"),u(e),"Two"===e.number&&document.querySelector(".dialog").showModal()}))},u=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},s=e=>{const t=e.board.getBoard(),r=e.board.getMisses(),o=document.querySelector(`#board${e.number}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let n=0;n<t.length;n++)for(let l=0;l<t.length;l++){const a=t[n][l],i=document.createElement("button");i.classList.add(`${e.number}-square`),i.setAttribute("data-x",`${n}`),i.setAttribute("data-y",`${l}`),c(e,i),null!==a&&a.getShip().hitCount>0&&a.getShip().hitCoor.find((e=>e[0]===`${n}`&&e[1]===`${l}`))&&(i.setAttribute("style","background-color: red;"),i.setAttribute("disabled","")),r.find((e=>e[0]===`${n}`&&e[1]===`${l}`))&&(i.setAttribute("style","background-color: green;"),i.setAttribute("disabled","")),o.appendChild(i)}},c=(e,t)=>{const r=e.board,o=r.getBoard(),n=document.querySelector(".dialog"),l=t.getAttribute("data-x"),a=t.getAttribute("data-y");t.addEventListener("click",(i=>{i.preventDefault(),r.receiveAttack(l,a),null===o[l][a]?(u(e),t.setAttribute("style","background-color: red;"),n.showModal()):t.setAttribute("style","background-color: green;")}))};let d=r("One"),p=r("Two");var h;o(d),o(p),a(d),a(p),n(d),n(p),l(d),l(p),i(d),i(p),((e,t)=>{const r=document.querySelector(".dialog"),n=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(l=>{l.preventDefault();let a=n.getAttribute("data-id");return"player-Two"===a?(o(e),s(t),n.setAttribute("data-id",`player-${e.number}`),r.close()):"player-One"===a?(o(t),s(e),n.setAttribute("data-id",`player-${t.number}`),r.close()):void 0}))})(d,p),(h=p).board.populateBd(),o(h)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUFBYSxVQUFXLFVBQVV3QyxFQUFLM0QsVUFDM0N1RCxFQUFPTyxTQUNNLGVBQVgxRCxHQUNURCxFQUFZeUQsR0FDWlYsRUFBYVMsR0FDYkUsRUFBVzFDLGFBQWEsVUFBVyxVQUFVeUMsRUFBSzVELFVBQzNDdUQsRUFBT08sY0FKVCxDQUtQLEdBQ0EsRUMvS0pDLENBQVlOLEVBQVdDLElEb1BMdEQsRUNsUFRzRCxHRG1QQS9HLE1BQU0yQyxhQUNiYSxFQUFZQyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL0RPTS5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTaGlwID0gKG4pID0+IHtcbiAgbGV0IHNoaXBPYmogPSB7fTtcblxuICBzaGlwT2JqW1wibGVuZ3RoXCJdID0gbjtcbiAgc2hpcE9ialtcImhpdENvdW50XCJdID0gMDtcbiAgc2hpcE9ialtcInN1bmtcIl0gPSBmYWxzZTtcbiAgc2hpcE9ialtcIm9yaWVudGF0aW9uXCJdID0gXCJob3Jpem9udGFsXCI7XG4gIHNoaXBPYmpbXCJjb21wXCJdID0gW107XG4gIHNoaXBPYmpbXCJ4Q29vclwiXSA9IG51bGw7XG4gIHNoaXBPYmpbXCJ5Q29vclwiXSA9IG51bGw7XG4gIHNoaXBPYmpbXCJoaXRDb29yXCJdID0gW107XG5cbiAgY29uc3QgZ2V0U2hpcCA9ICgpID0+IHNoaXBPYmo7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIHNoaXBPYmouaGl0Q291bnQgKz0gMTtcbiAgICBpZiAoc2hpcE9iai5oaXRDb3VudCA9PT0gc2hpcE9iai5sZW5ndGgpIHNoaXBPYmouc3VuayA9IHRydWU7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIHJldHVybiBzaGlwT2JqLnN1bmsgPT09IHRydWUgPyB0cnVlIDogZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRTaGlwLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gIH07XG59O1xuXG5leHBvcnQgeyBTaGlwIH07XG4iLCJpbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSAoKSA9PiB7XG4gIGxldCBib2FyZCA9IFtdO1xuICBsZXQgbWlzc2VzID0gW107XG5cbiAgbGV0IGFsbFNoaXBzID0ge1xuICAgIGxfc2hpcDogU2hpcCg0KSxcbiAgICBtX3NoaXBfSTogU2hpcCgzKSxcbiAgICBtX3NoaXBfSUk6IFNoaXAoMyksXG4gICAgc19zaGlwX0k6IFNoaXAoMiksXG4gICAgc19zaGlwX0lJOiBTaGlwKDIpLFxuICAgIHNfc2hpcF9JSUk6IFNoaXAoMiksXG4gICAgeHNfc2hpcF9JOiBTaGlwKDEpLFxuICAgIHhzX3NoaXBfSUk6IFNoaXAoMSksXG4gICAgeHNfc2hpcF9JSUk6IFNoaXAoMSksXG4gICAgeHNfc2hpcF9JVjogU2hpcCgxKSxcbiAgfTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkO1xuICBjb25zdCBnZXRNaXNzZXMgPSAoKSA9PiBtaXNzZXM7XG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4gYWxsU2hpcHM7XG5cbiAgY29uc3QgY3JlYXRlQm9hcmQgPSAoKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBib2FyZFtpXSA9IFtdO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICAgIGJvYXJkW2ldW2pdID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgaXNFbXB0eSA9ICh4LCB5KSA9PiB7XG4gICAgcmV0dXJuIGJvYXJkW3hdW3ldID09PSBudWxsID8gdHJ1ZSA6IGZhbHNlO1xuICB9O1xuXG4gIGNvbnN0IGlzRml0ID0gKGFycikgPT4ge1xuICAgIGxldCBzdGF0dXMgPSB0cnVlO1xuXG4gICAgYXJyLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGlmIChpdGVtWzBdID4gOSB8fCBpdGVtWzFdID4gOSB8fCAhaXNFbXB0eShpdGVtWzBdLCBpdGVtWzFdKSlcbiAgICAgICAgcmV0dXJuIChzdGF0dXMgPSBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZUNvbXAgPSAoeCwgeSwgc2hpcCkgPT4ge1xuICAgIGNvbnN0IGxlbmd0aCA9IHNoaXAuZ2V0U2hpcCgpLmxlbmd0aDtcbiAgICBjb25zdCBvcmllbnRhdGlvbiA9IHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uO1xuICAgIGxldCB0ZW1wID0gW107XG4gICAgbGV0IGEgPSB4O1xuICAgIGxldCBiID0geTtcblxuICAgIGlmIChvcmllbnRhdGlvbiA9PT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgIHdoaWxlIChiICE9PSB5ICsgbGVuZ3RoKSB7XG4gICAgICAgIHRlbXAucHVzaChbeCwgYl0pO1xuICAgICAgICBiICs9IDE7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHdoaWxlIChhICE9PSB4ICsgbGVuZ3RoKSB7XG4gICAgICAgIHRlbXAucHVzaChbYSwgeV0pO1xuICAgICAgICBhICs9IDE7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRlbXA7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHgsIHksIHNoaXApID0+IHtcbiAgICBsZXQgdGVtcCA9IFtdO1xuICAgIGxldCBzdGF0dXMgPSB0cnVlO1xuXG4gICAgaWYgKHkgKyBsZW5ndGggLSAxID4gOSB8fCB4ID4gOSB8fCB4ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeSA+IDkpIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcImVycm9yXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZW1wID0gY3JlYXRlQ29tcCh4LCB5LCBzaGlwKTtcbiAgICAgIHN0YXR1cyA9IGlzRml0KHRlbXApO1xuICAgIH1cblxuICAgIGlmIChzdGF0dXMgPT09IGZhbHNlKSB7XG4gICAgICBzdGF0dXMgPSB0cnVlO1xuICAgICAgdGVtcCA9IFtdO1xuICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwibm90IGVtcHR5XCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaGlwLmdldFNoaXAoKS5jb21wID0gdGVtcDtcblxuICAgICAgc2hpcC5nZXRTaGlwKCkuY29tcC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGJvYXJkW2l0ZW1bMF1dW2l0ZW1bMV1dID0gc2hpcDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCBwb3B1bGF0ZUJkID0gKCkgPT4ge1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhhbGxTaGlwcyk7XG4gICAgY29uc3QgZGlyZWN0aW9ucyA9IFtcImhvcml6b250YWxcIiwgXCJ2ZXJ0aWNhbFwiXTtcblxuICAgIGtleXMuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCBzaGlwID0gYWxsU2hpcHNba2V5XTtcbiAgICAgIGNvbnN0IGxlbmd0aCA9IHNoaXAuZ2V0U2hpcCgpLmxlbmd0aDtcblxuICAgICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGxldCB6ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyZWN0aW9uc1t6XTtcbiAgICAgIGxldCB0ZW1wID0gY3JlYXRlQ29tcCh4LCB5LCBzaGlwKTtcbiAgICAgIGxldCBmaXQgPSBpc0ZpdCh0ZW1wKTtcblxuICAgICAgd2hpbGUgKHkgKyBsZW5ndGggLSAxID4gOSB8fCB4ICsgbGVuZ3RoIC0gMSA+IDkgfHwgZml0ID09PSBmYWxzZSkge1xuICAgICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICB6ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICAgICAgc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBkaXJlY3Rpb25zW3pdO1xuICAgICAgICB0ZW1wID0gY3JlYXRlQ29tcCh4LCB5LCBzaGlwKTtcbiAgICAgICAgZml0ID0gaXNGaXQodGVtcCk7XG4gICAgICB9XG5cbiAgICAgIHBsYWNlU2hpcCh4LCB5LCBzaGlwKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKHgsIHkpID0+IHtcbiAgICBpZiAoYm9hcmRbeF1beV0gPT09IG51bGwpIG1pc3Nlcy5wdXNoKFt4LCB5XSk7XG4gICAgZWxzZSB7XG4gICAgICBib2FyZFt4XVt5XS5oaXQoKTtcbiAgICAgIGJvYXJkW3hdW3ldLmdldFNoaXAoKS5oaXRDb29yLnB1c2goW3gsIHldKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgaXNBbGxTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhhbGxTaGlwcyk7XG4gICAgbGV0IHN0YXR1cyA9IGZhbHNlO1xuXG4gICAgc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgaWYgKHNoaXAuZ2V0U2hpcCgpLnN1bmsgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiAoc3RhdHVzID0gZmFsc2UpO1xuICAgICAgfSBlbHNlIHN0YXR1cyA9IHRydWU7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY3JlYXRlQm9hcmQsXG4gICAgcGxhY2VTaGlwLFxuICAgIGdldEJvYXJkLFxuICAgIGdldFNoaXBzLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgZ2V0TWlzc2VzLFxuICAgIGlzQWxsU3VuayxcbiAgICBwb3B1bGF0ZUJkLFxuICB9O1xufTtcblxuZXhwb3J0IHsgR2FtZWJvYXJkIH07XG4iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcblxuY29uc3QgUGxheWVyID0gKG51bWJlcikgPT4ge1xuICBsZXQgd2luID0gZmFsc2U7XG4gIGxldCBib2FyZCA9IEdhbWVib2FyZCgpO1xuICBsZXQgaXNDb21wID0gZmFsc2U7XG5cbiAgcmV0dXJuIHtcbiAgICBudW1iZXIsXG4gICAgd2luLFxuICAgIGJvYXJkLFxuICAgIGlzQ29tcCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFBsYXllciB9O1xuIiwiY29uc3QgZmlsbFNxciA9IChzcXIsIHRhZykgPT4ge1xuICBpZiAoc3FyID09PSBudWxsKSB7XG4gICAgdGFnLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogYmx1ZTtcIik7XG4gIH1cbn07XG5cbmNvbnN0IHJlbmRlclNoaXAgPSAocGxheWVyKSA9PiB7XG4gIGxldCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBzaGlwc09iaiA9IHBsYXllci5ib2FyZC5nZXRTaGlwcygpO1xuICBjb25zdCBzaGlwc0xpc3QgPSBPYmplY3Qua2V5cyhzaGlwc09iaik7XG5cbiAgc2hpcHNMaXN0LmZvckVhY2goKHNoaXApID0+IHtcbiAgICBjb25zdCBjb21wID0gc2hpcHNPYmpbc2hpcF0uZ2V0U2hpcCgpLmNvbXA7XG5cbiAgICBpZiAoY29tcC5sZW5ndGggIT09IDApIHtcbiAgICAgIGNvbnN0IHhDb29yID0gY29tcFswXVswXTtcbiAgICAgIGNvbnN0IHlDb29yID0gY29tcFswXVsxXTtcbiAgICAgIHBsYXllci5ib2FyZC5wbGFjZVNoaXAoeENvb3IsIHlDb29yLCBzaGlwc09ialtzaGlwXSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gYm9hcmQ7XG59O1xuXG5jb25zdCByZW5kZXJCb2FyZCA9IChwbGF5ZXIpID0+IHtcbiAgcGxheWVyLmJvYXJkLmNyZWF0ZUJvYXJkKCk7XG5cbiAgcmVuZGVyU2hpcChwbGF5ZXIpO1xuXG4gIGNvbnN0IGJvYXJkID0gcGxheWVyLmJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IHBsYXllck51bSA9IHBsYXllci5udW1iZXI7XG4gIGxldCBjdXJyZW50Qm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYm9hcmQke3BsYXllck51bX1gKTtcblxuICB3aGlsZSAoY3VycmVudEJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpXG4gICAgY3VycmVudEJvYXJkLnJlbW92ZUNoaWxkKGN1cnJlbnRCb2FyZC5sYXN0RWxlbWVudENoaWxkKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBib2FyZC5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKGAke3BsYXllck51bX0tc3F1YXJlYCk7XG5cbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIiwgYCR7aX1gKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIiwgYCR7an1gKTtcblxuICAgICAgZmlsbFNxcihib2FyZFtpXVtqXSwgc3F1YXJlKTtcblxuICAgICAgY3VycmVudEJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRCb2FyZDtcbn07XG5cbmNvbnN0IGdyYWJQbGF5ZXJTaGlwcyA9IChwbGF5ZXIpID0+IHtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHMgPSBPYmplY3Qua2V5cyhzaGlwc09iaik7XG4gIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGF5ZXIke3BsYXllci5udW1iZXJ9LXNoaXBzYCk7XG5cbiAgc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gICAgb3B0aW9uLnRleHRDb250ZW50ID0gc2hpcDtcbiAgICBzZWxlY3Rpb24uYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdGlvbjtcbn07XG5cbmNvbnN0IGluaXRQbGFjZVNoaXAgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNwbGFjZVNoaXBCdG4tJHtwbGF5ZXIubnVtYmVyfWApO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCB4Q29vciA9IHBhcnNlSW50KFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyLm51bWJlcn0teWApLnZhbHVlXG4gICAgKTtcbiAgICBjb25zdCB5Q29vciA9IHBhcnNlSW50KFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyLm51bWJlcn0teGApLnZhbHVlXG4gICAgKTtcbiAgICBjb25zdCBzaGlwTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI3BsYXllciR7cGxheWVyLm51bWJlcn0tc2hpcHNgXG4gICAgKS52YWx1ZTtcblxuICAgIGNvbnN0IG9yaWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI3BsYXllciR7cGxheWVyLm51bWJlcn0tb3JpZW50YFxuICAgICkudmFsdWU7XG5cbiAgICBjb25zdCBzaGlwID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKClbc2hpcE5hbWVdO1xuXG4gICAgc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBvcmllbnQ7XG4gICAgY29uc29sZS5sb2cob3JpZW50KTtcblxuICAgIHBsYXllci5ib2FyZC5wbGFjZVNoaXAoeENvb3IsIHlDb29yLCBzaGlwKTtcbiAgICByZW5kZXJCb2FyZChwbGF5ZXIpO1xuICB9KTtcbn07XG5cbmNvbnN0IHJlbmRlckZvcm0gPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IHBsYXllck5vID0gcGxheWVyLm51bWJlcjtcblxuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyTm99YCk7XG5cbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xuICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuICBjb25zdCBvcmllbnRhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gIGNvbnN0IGlucHV0WCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgY29uc3QgaW5wdXRZID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICBjb25zdCBjcm9zcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gIGNvbnN0IGxvbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICBjb25zdCBmaW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuXG4gIGZvcm0uc2V0QXR0cmlidXRlKFwiaWRcIiwgYHBsYXllciR7cGxheWVyTm99LWZvcm1gKTtcblxuICBzZWxlY3Rpb24uc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcInNoaXBzXCIpO1xuICBzZWxlY3Rpb24uc2V0QXR0cmlidXRlKFwiaWRcIiwgYHBsYXllciR7cGxheWVyTm99LXNoaXBzYCk7XG5cbiAgb3JpZW50YXRpb24uc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcIm9yaWVudGF0aW9uXCIpO1xuICBvcmllbnRhdGlvbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBgcGxheWVyJHtwbGF5ZXJOb30tb3JpZW50YCk7XG5cbiAgaW5wdXRYLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICBpbnB1dFguc2V0QXR0cmlidXRlKFwiaWRcIiwgYHBsYXllciR7cGxheWVyTm99LXhgKTtcbiAgaW5wdXRYLnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJ4LWNvb3JcIik7XG4gIGlucHV0WC5zZXRBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiLCBcInhcIik7XG5cbiAgaW5wdXRZLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICBpbnB1dFkuc2V0QXR0cmlidXRlKFwiaWRcIiwgYHBsYXllciR7cGxheWVyTm99LXlgKTtcbiAgaW5wdXRZLnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJ5LWNvb3JcIik7XG4gIGlucHV0WS5zZXRBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiLCBcInlcIik7XG5cbiAgYnV0dG9uLnNldEF0dHJpYnV0ZShcImlkXCIsIGBwbGFjZVNoaXBCdG4tJHtwbGF5ZXJOb31gKTtcbiAgYnV0dG9uLnRleHRDb250ZW50ID0gXCJQbGFjZVwiO1xuXG4gIGZpbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBgcGxheWVyJHtwbGF5ZXJOb30tZmluQnRuYCk7XG4gIGZpbi50ZXh0Q29udGVudCA9IFwiRmluaXNoIHNldCB1cFwiO1xuXG4gIGNyb3NzLnRleHRDb250ZW50ID0gXCJob3Jpem9udGFsXCI7XG4gIGxvbmcudGV4dENvbnRlbnQgPSBcInZlcnRpY2FsXCI7XG5cbiAgb3JpZW50YXRpb24uYXBwZW5kKGNyb3NzLCBsb25nKTtcbiAgZm9ybS5hcHBlbmQoc2VsZWN0aW9uLCBpbnB1dFgsIGlucHV0WSwgb3JpZW50YXRpb24sIGJ1dHRvbiwgZmluKTtcbiAgbWFpbi5hcHBlbmRDaGlsZChmb3JtKTtcblxuICByZXR1cm4gbWFpbjtcbn07XG5cbmNvbnN0IGluaXRGaW5TZXR1cCA9IChwbGF5ZXIpID0+IHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYXllciR7cGxheWVyLm51bWJlcn0tZmluQnRuYCk7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjcGxheWVyJHtwbGF5ZXIubnVtYmVyfS1mb3JtYCk7XG4gIGNvbnN0IHNoaXBzT2JqID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhzaGlwc09iaik7XG4gIGxldCBpc0FsbFBsYWNlZCA9IGZhbHNlO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBjb25zdCBjb21wID0gc2hpcC5nZXRTaGlwKCkuY29tcDtcbiAgICAgIGlmIChjb21wLmxlbmd0aCA9PT0gMCkgcmV0dXJuIChpc0FsbFBsYWNlZCA9IGZhbHNlKTtcbiAgICAgIGVsc2UgcmV0dXJuIChpc0FsbFBsYWNlZCA9IHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXNBbGxQbGFjZWRcbiAgICAgID8gZm9ybS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImRpc3BsYXk6IG5vbmU7XCIpXG4gICAgICA6IGNvbnNvbGUubG9nKFwiUGxlYXNlIHBsYWNlIGFsbCB0aGUgc2hpcHMgZmlyc3RcIik7XG5cbiAgICBoaWRlQm9hcmQocGxheWVyKTtcblxuICAgIGlmIChwbGF5ZXIubnVtYmVyID09PSBcIlR3b1wiKSB7XG4gICAgICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgaGlkZUJvYXJkID0gKHBsYXllcikgPT4ge1xuICBsZXQgc3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke3BsYXllci5udW1iZXJ9LXNxdWFyZWApO1xuXG4gIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyYXk7XCIpO1xuICB9KTtcbn07XG5cbmNvbnN0IGluaXRwbGF5QnRuID0gKFBPbmUsIFBUd28pID0+IHtcbiAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gIGNvbnN0IHBsYXlXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYXktd2luZG93XCIpO1xuICBjb25zdCBwbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5XCIpO1xuXG4gIHBsYXlCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCBwbGF5ZXIgPSBwbGF5V2luZG93LmdldEF0dHJpYnV0ZShcImRhdGEtaWRcIik7XG5cbiAgICBpZiAocGxheWVyID09PSBcInBsYXllci1Ud29cIikge1xuICAgICAgcmVuZGVyQm9hcmQoUE9uZSk7XG4gICAgICByZW5kZXJQbGF5QmQoUFR3byk7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke1BPbmUubnVtYmVyfWApO1xuICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgIH0gZWxzZSBpZiAocGxheWVyID09PSBcInBsYXllci1PbmVcIikge1xuICAgICAgcmVuZGVyQm9hcmQoUFR3byk7XG4gICAgICByZW5kZXJQbGF5QmQoUE9uZSk7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke1BUd28ubnVtYmVyfWApO1xuICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCByZW5kZXJQbGF5QmQgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IGJvYXJkID0gcGxheWVyLmJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IG1pc3NlcyA9IHBsYXllci5ib2FyZC5nZXRNaXNzZXMoKTtcbiAgY29uc3QgY3VyckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2JvYXJkJHtwbGF5ZXIubnVtYmVyfWApO1xuXG4gIHdoaWxlIChjdXJyQm9hcmQubGFzdEVsZW1lbnRDaGlsZClcbiAgICBjdXJyQm9hcmQucmVtb3ZlQ2hpbGQoY3VyckJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJvYXJkLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBpdGVtID0gYm9hcmRbaV1bal07XG5cbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwbGF5ZXIubnVtYmVyfS1zcXVhcmVgKTtcblxuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteFwiLCBgJHtpfWApO1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteVwiLCBgJHtqfWApO1xuXG4gICAgICBpbml0U3FyQnRuKHBsYXllciwgc3F1YXJlKTtcblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtICE9PSBudWxsICYmXG4gICAgICAgIGl0ZW0uZ2V0U2hpcCgpLmhpdENvdW50ID4gMCAmJlxuICAgICAgICBpdGVtLmdldFNoaXAoKS5oaXRDb29yLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0gYCR7aX1gICYmIGl0ZW1bMV0gPT09IGAke2p9YDtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0gYCR7aX1gICYmIGl0ZW1bMV0gPT09IGAke2p9YDtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjtcIik7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICAgIH1cblxuICAgICAgY3VyckJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBpbml0U3FyQnRuID0gKHBsYXllciwgc3F1YXJlKSA9PiB7XG4gIGNvbnN0IGJvYXJkID0gcGxheWVyLmJvYXJkO1xuICBjb25zdCBib2FyZExpc3QgPSBib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgY29uc3QgeCA9IHNxdWFyZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIik7XG4gIGNvbnN0IHkgPSBzcXVhcmUuZ2V0QXR0cmlidXRlKFwiZGF0YS15XCIpO1xuXG4gIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBib2FyZC5yZWNlaXZlQXR0YWNrKHgsIHkpO1xuICAgIGlmIChib2FyZExpc3RbeF1beV0gPT09IG51bGwpIHtcbiAgICAgIGhpZGVCb2FyZChwbGF5ZXIpO1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogZ3JlZW47XCIpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBjb21wTW9kZSA9IChwbGF5ZXIpID0+IHtcbiAgcGxheWVyLmJvYXJkLnBvcHVsYXRlQmQoKTtcbiAgcmVuZGVyQm9hcmQocGxheWVyKTtcbn07XG5cbmV4cG9ydCB7XG4gIHJlbmRlckJvYXJkLFxuICBncmFiUGxheWVyU2hpcHMsXG4gIGluaXRQbGFjZVNoaXAsXG4gIHJlbmRlckZvcm0sXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxufTtcbiIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IHtcbiAgcmVuZGVyQm9hcmQsXG4gIGdyYWJQbGF5ZXJTaGlwcyxcbiAgaW5pdFBsYWNlU2hpcCxcbiAgcmVuZGVyRm9ybSxcbiAgaW5pdEZpblNldHVwLFxuICBpbml0cGxheUJ0bixcbiAgY29tcE1vZGUsXG59IGZyb20gXCIuL0RPTVwiO1xuXG5sZXQgcGxheWVyT25lID0gUGxheWVyKFwiT25lXCIpO1xubGV0IHBsYXllclR3byA9IFBsYXllcihcIlR3b1wiKTtcblxucmVuZGVyQm9hcmQocGxheWVyT25lKTtcbnJlbmRlckJvYXJkKHBsYXllclR3byk7XG5cbnJlbmRlckZvcm0ocGxheWVyT25lKTtcbnJlbmRlckZvcm0ocGxheWVyVHdvKTtcblxuZ3JhYlBsYXllclNoaXBzKHBsYXllck9uZSk7XG5ncmFiUGxheWVyU2hpcHMocGxheWVyVHdvKTtcblxuaW5pdFBsYWNlU2hpcChwbGF5ZXJPbmUpO1xuaW5pdFBsYWNlU2hpcChwbGF5ZXJUd28pO1xuXG5pbml0RmluU2V0dXAocGxheWVyT25lKTtcbmluaXRGaW5TZXR1cChwbGF5ZXJUd28pO1xuXG5pbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbmNvbXBNb2RlKHBsYXllclR3byk7XG5cbi8qIFxuXG5cbiAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG4gICAgY29uc3Qgb3JpZW50YXRpb24gPSBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbjtcbiAgICBsZXQgYSA9IHg7XG4gICAgbGV0IGIgPSB5O1xuXG4gICAgY29uc3QgcG9wdWxhdGVCZCA9ICgpID0+IHtcblxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhhbGxTaGlwcyk7XG5cbiAgICBhbGxTaGlwcy5mb3JFYWNoKHNoaXAgPT4ge1xuICAgICAgY29uc3QgYm9hdCA9IGFsbFNoaXBzW3NoaXBdO1xuICAgICAgY29uc3QgbGVuZ3RoID0gYm9hdC5nZXRTaGlwKCkubGVuZ3RoO1xuXG4gICAgICBsZXQgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgbGV0IHogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTtcbiAgICB9KVxuICB9XG5cbiAgY29uc3QgY29tcE1vZGUgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IHNoaXBzT2JqID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNoaXBzTGlzdCA9IE9iamVjdC5rZXlzKHNoaXBzT2JqKTtcbiAgY29uc3QgZGlyZWN0aW9ucyA9IFtcImhvcml6b250YWxcIiwgXCJ2ZXJ0aWNhbFwiXTtcblxuICBzaGlwc0xpc3QuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgIGNvbnN0IGJvYXQgPSBzaGlwc09ialtzaGlwXTtcblxuICAgIGNvbnN0IGxlbmd0aCA9IGJvYXQuZ2V0U2hpcCgpLmxlbmd0aDtcblxuICAgIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGxldCB6ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICBjb25zb2xlLmxvZyhzaGlwLCB4LCB5LCBsZW5ndGgpO1xuXG4gICAgY29uc3QgZGlyID0gZGlyZWN0aW9uc1t6XTtcblxuICAgIGlmIChkaXIgPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICB3aGlsZSAoeSArIGxlbmd0aCAtIDEgPiA5IHx8IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpW3hdW3ldICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwid2Vya1wiKTtcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgd2hpbGUgKHggKyBsZW5ndGggLSAxID4gOSB8fCBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKVt4XVt5XSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIndlcmtcIik7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYm9hdC5nZXRTaGlwKCkub3JpZW50YXRpb24gPSBkaXI7XG5cbiAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHgsIHksIGJvYXQpO1xuXG4gICAgY29uc29sZS5sb2coeCwgeSwgZGlyKTtcbiAgICBjb25zb2xlLmxvZyhib2F0LmdldFNoaXAoKSwgc2hpcCk7XG4gIH0pO1xuXG4gIHJlbmRlckJvYXJkKHBsYXllcik7XG59O1xuICovXG4iXSwibmFtZXMiOlsiU2hpcCIsIm4iLCJzaGlwT2JqIiwiZ2V0U2hpcCIsImhpdCIsImhpdENvdW50IiwibGVuZ3RoIiwic3VuayIsImlzU3VuayIsIkdhbWVib2FyZCIsImJvYXJkIiwibWlzc2VzIiwiYWxsU2hpcHMiLCJsX3NoaXAiLCJtX3NoaXBfSSIsIm1fc2hpcF9JSSIsInNfc2hpcF9JIiwic19zaGlwX0lJIiwic19zaGlwX0lJSSIsInhzX3NoaXBfSSIsInhzX3NoaXBfSUkiLCJ4c19zaGlwX0lJSSIsInhzX3NoaXBfSVYiLCJpc0ZpdCIsImFyciIsInN0YXR1cyIsImZvckVhY2giLCJpdGVtIiwieCIsInkiLCJjcmVhdGVDb21wIiwic2hpcCIsInRlbXAiLCJhIiwiYiIsIm9yaWVudGF0aW9uIiwicHVzaCIsInBsYWNlU2hpcCIsImNvbnNvbGUiLCJsb2ciLCJjb21wIiwiY3JlYXRlQm9hcmQiLCJpIiwiaiIsImdldEJvYXJkIiwiZ2V0U2hpcHMiLCJyZWNlaXZlQXR0YWNrIiwiaGl0Q29vciIsImdldE1pc3NlcyIsImlzQWxsU3VuayIsInNoaXBzIiwiT2JqZWN0IiwidmFsdWVzIiwicG9wdWxhdGVCZCIsImtleXMiLCJkaXJlY3Rpb25zIiwia2V5IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwieiIsImZpdCIsIlBsYXllciIsIm51bWJlciIsIndpbiIsImlzQ29tcCIsInJlbmRlckJvYXJkIiwicGxheWVyIiwic2hpcHNPYmoiLCJ4Q29vciIsInlDb29yIiwicmVuZGVyU2hpcCIsInBsYXllck51bSIsImN1cnJlbnRCb2FyZCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJsYXN0RWxlbWVudENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzcXVhcmUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJncmFiUGxheWVyU2hpcHMiLCJzZWxlY3Rpb24iLCJxdWVyeVNlbGVjdG9yIiwib3B0aW9uIiwidGV4dENvbnRlbnQiLCJpbml0UGxhY2VTaGlwIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInBhcnNlSW50IiwidmFsdWUiLCJzaGlwTmFtZSIsIm9yaWVudCIsInJlbmRlckZvcm0iLCJwbGF5ZXJObyIsIm1haW4iLCJmb3JtIiwiaW5wdXRYIiwiaW5wdXRZIiwiYnV0dG9uIiwiY3Jvc3MiLCJsb25nIiwiZmluIiwiYXBwZW5kIiwiaW5pdEZpblNldHVwIiwiaXNBbGxQbGFjZWQiLCJoaWRlQm9hcmQiLCJzaG93TW9kYWwiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVuZGVyUGxheUJkIiwiY3VyckJvYXJkIiwiaW5pdFNxckJ0biIsImZpbmQiLCJib2FyZExpc3QiLCJkaWFsb2ciLCJnZXRBdHRyaWJ1dGUiLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iLCJQT25lIiwiUFR3byIsInBsYXlXaW5kb3ciLCJjbG9zZSIsImluaXRwbGF5QnRuIl0sInNvdXJjZVJvb3QiOiIifQ==