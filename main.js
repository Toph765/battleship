(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk}},t=()=>{let t=[],r=[],o=[],n={l_ship:e(4),m_ship_I:e(3),m_ship_II:e(3),s_ship_I:e(2),s_ship_II:e(2),s_ship_III:e(2),xs_ship_I:e(1),xs_ship_II:e(1),xs_ship_III:e(1),xs_ship_IV:e(1)};const a=e=>{let r=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(o=e[0],n=e[1],null!==t[o][n]))return r=!1;var o,n})),r},l=(e,t,r)=>{const o=r.getShip().length;let n=[],a=e,l=t;if("horizontal"===r.getShip().orientation)for(;l!==t+o;)n.push([e,l]),l+=1;else for(;a!==e+o;)n.push([a,t]),a+=1;return n},i=(e,r,o)=>{let n=[],i=!0;return r+length-1>9||e>9||e+length-1>9||r>9?alert("Ship is out of bound"):(n=l(e,r,o),i=a(n),!1===i?(i=!0,n=[],alert("square is already occupied")):(o.getShip().comp=n,o.getShip().comp.forEach((e=>{t[e[0]][e[1]]=o})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e][r]=null}return t},placeShip:i,getBoard:()=>t,getShips:()=>n,receiveAttack:(e,n)=>(null===t[e][n]?r.push([e,n]):(o.push([e,n]),t[e][n].hit(),t[e][n].getShip().hitCoor.push([e,n])),t),getMisses:()=>r,getHits:()=>o,isAllSunk:()=>{const e=Object.values(n);let t=!0;return e.forEach((e=>{if(!e.isSunk())return t=!1})),t},populateBd:()=>{const e=Object.keys(n),r=["horizontal","vertical"];return e.forEach((e=>{const t=n[e],o=t.getShip().length;let s=Math.floor(10*Math.random()),u=Math.floor(10*Math.random()),d=Math.floor(2*Math.random());t.getShip().orientation=r[d];let c=l(s,u,t),h=a(c);for(;u+o-1>9||s+o-1>9||!1===h;)s=Math.floor(10*Math.random()),u=Math.floor(10*Math.random()),d=Math.floor(2*Math.random()),t.getShip().orientation=r[d],c=l(s,u,t),h=a(c);i(s,u,t)})),t}}},r=e=>({number:e,win:!1,board:t(),isComp:!1}),o=(e,t,r,o,n)=>{const a=e.board.getMisses();null===t?a.find((e=>e[0]===o&&e[1]===n))?r.setAttribute("style","background-color: yellow;"):r.setAttribute("style","background-color: blue;"):t.getShip().hitCoor.find((e=>e[0]===o&&e[1]===n))&&r.setAttribute("style","background-color: red;")},n=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((r=>{const o=t[r].getShip().comp;if(0!==o.length){const n=o[0][0],a=o[0][1];e.board.placeShip(n,a,t[r])}}))})(e);const t=e.board.getBoard(),r=e.number;let n=document.getElementById(`board${r}`);for(;n.lastElementChild;)n.removeChild(n.lastElementChild);for(let a=0;a<t.length;a++)for(let l=0;l<t.length;l++){const i=document.createElement("div");i.classList.add(`${r}-square`),i.setAttribute("data-x",`${a}`),i.setAttribute("data-y",`${l}`),o(e,t[a][l],i,a,l),n.appendChild(i)}return n},a=(e,t)=>{let r;"playerOne-form"===document.querySelector("form").getAttribute("id")?r=e.board.getShips():t.board.getShips();const o=Object.keys(r),n=document.querySelector("#ships");return o.forEach((e=>{const t=document.createElement("option");t.textContent=e,n.appendChild(t)})),n},l=(e,t)=>{document.querySelector("#placeShipBtn").addEventListener("click",(r=>{r.preventDefault();let o=document.querySelector("form").getAttribute("id");const a=parseInt(document.querySelector("#y-coor").value),l=parseInt(document.querySelector("#x-coor").value),i=document.querySelector("#ships").value,s=document.querySelector("#orientation").value;let u;u="playerOne-form"===o?e.board.getShips()[i]:t.board.getShips()[i],u.getShip().orientation=s,Number.isNaN(a)||Number.isNaN(l)||("playerOne-form"===o?(e.board.placeShip(a,l,u),n(e)):(t.board.placeShip(a,l,u),n(t)))}))},i=(e,t)=>{const r=document.querySelector("main"),o=document.querySelector("#finBtn"),n=document.querySelector("form");let a=!1;o.addEventListener("click",(o=>{let l;o.preventDefault();const i=r.getAttribute("class");let u=n.getAttribute("id");l="playerOne-form"===u?e.board.getShips():t.board.getShips(),Object.values(l).forEach((e=>{const t=e.getShip().comp;return a=0!==t.length})),a?("playerOne-form"===u&&(n.setAttribute("id","playerTwo-form"),s(e)),("pvc"===i||"playerTwo-form"===u)&&(n.setAttribute("style","display: none;"),s(t),document.querySelector(".dialog").showModal())):alert("Please place all the ships first")}))},s=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},u=(e,t)=>{const r=document.querySelector("main"),o=document.querySelector(".dialog"),a=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(l=>{l.preventDefault();let i=a.getAttribute("data-id");if("player-Two"===i)return n(e),d(t),a.setAttribute("data-id",`player-${e.number}`),o.close();if("player-One"===i){const l=r.getAttribute("class");return a.setAttribute("data-id",`player-${t.number}`),"pvc"===l?(h(e,t),o.close()):(n(t),d(e),o.close())}}))},d=e=>{const t=e.board.getBoard(),r=e.board.getMisses(),o=document.querySelector(`#board${e.number}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let n=0;n<t.length;n++)for(let a=0;a<t.length;a++){const l=t[n][a],i=document.createElement("button");i.classList.add(`${e.number}-square`),i.setAttribute("data-x",`${n}`),i.setAttribute("data-y",`${a}`),c(e,i),null!==l&&l.getShip().hitCount>0&&l.getShip().hitCoor.find((e=>e[0]===n&&e[1]===a))&&(i.setAttribute("style","background-color: red;"),i.setAttribute("disabled","")),r.find((e=>e[0]===n&&e[1]===a))&&(i.setAttribute("style","background-color: green;"),i.setAttribute("disabled","")),o.appendChild(i)}},c=(e,t)=>{const r=e.board,o=r.getBoard(),n=document.querySelector(".dialog"),a=parseInt(t.getAttribute("data-x")),l=parseInt(t.getAttribute("data-y")),i=document.querySelector(".player"),u=document.querySelector(".end-game");t.addEventListener("click",(d=>{d.preventDefault(),r.receiveAttack(a,l),null===o[a][l]?(s(e),t.setAttribute("style","background-color: red;"),n.showModal()):(t.setAttribute("style","background-color: green;"),e.board.isAllSunk()&&(u.showModal(),"One"===e.number?i.textContent="Congratulations Player Two!":i.textContent="Congratulations Player One!"))}))},h=(e,t)=>{const r=e.board,o=r.getBoard(),a=r.getMisses(),l=r.getHits(),i=document.querySelector("#play-window");let s=Math.floor(10*Math.random()),u=Math.floor(10*Math.random()),c=!0;for(;!0===c;)a.find((e=>e[0]===s&&e[1]===u))||l.find((e=>e[0]===s&&e[1]===u))?(s=Math.floor(10*Math.random()),u=Math.floor(10*Math.random())):(r.receiveAttack(s,u),null===o[s][u]?(i.setAttribute("data-id",`player-${e.number}`),n(e),d(t),c=!1):(s=Math.floor(10*Math.random()),u=Math.floor(10*Math.random())))},p=document.querySelector(".game_mode"),m=document.querySelector("#pvp"),b=document.querySelector("#pvc"),g=r("One"),y=r("Two");m.addEventListener("click",(e=>(e.preventDefault(),n(g),n(y),a(g,y),l(g,y),i(g,y),u(g,y),p.close()))),b.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main");var r;return n(g),n(y),a(g,y),l(g,y),i(g,y),u(g,y),(r=y).board.populateBd(),n(r),s(r),t.classList.add("pvc"),p.close()})),document.addEventListener("onload",p.showModal())})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRUMsaUJBRUYsTUFBTVMsRUFBTzdCLFNBQVNZLGNBQWMsUUR3UHJCLElBQUN4QixFQzNPaEIsT0FYQUssRUFBWStELEdBQ1ovRCxFQUFZZ0UsR0FDWmhELEVBQWdCK0MsRUFBV0MsR0FDM0J4QyxFQUFjdUMsRUFBV0MsR0FDekI3QixFQUFhNEIsRUFBV0MsR0FDeEJwQixFQUFZbUIsRUFBV0MsSURpUFByRSxFQy9PUHFFLEdEZ1BGL0gsTUFBTTRDLGFBQ2JtQixFQUFZTCxHQUNaOEMsRUFBVTlDLEdDaFBWeUMsRUFBS3ZCLFVBQVVDLElBQUksT0FFWjhDLEVBQVNWLE9BQU8sSUFHekIzQyxTQUFTa0IsaUJBQWlCLFNBQVVtQyxFQUFTbEIsWSIsInNvdXJjZXMiOlsid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9ET00uanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IChuKSA9PiB7XG4gIGxldCBzaGlwT2JqID0ge307XG5cbiAgc2hpcE9ialtcImxlbmd0aFwiXSA9IG47XG4gIHNoaXBPYmpbXCJoaXRDb3VudFwiXSA9IDA7XG4gIHNoaXBPYmpbXCJzdW5rXCJdID0gZmFsc2U7XG4gIHNoaXBPYmpbXCJvcmllbnRhdGlvblwiXSA9IFwiaG9yaXpvbnRhbFwiO1xuICBzaGlwT2JqW1wiY29tcFwiXSA9IFtdO1xuICBzaGlwT2JqW1wiaGl0Q29vclwiXSA9IFtdO1xuXG4gIGNvbnN0IGdldFNoaXAgPSAoKSA9PiBzaGlwT2JqO1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBzaGlwT2JqLmhpdENvdW50ICs9IDE7XG4gICAgaWYgKHNoaXBPYmouaGl0Q291bnQgPT09IHNoaXBPYmoubGVuZ3RoKSBzaGlwT2JqLnN1bmsgPSB0cnVlO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICByZXR1cm4gc2hpcE9iai5zdW5rID09PSB0cnVlID8gdHJ1ZSA6IGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0U2hpcCxcbiAgICBoaXQsXG4gICAgaXNTdW5rLFxuICB9O1xufTtcblxuZXhwb3J0IHsgU2hpcCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcblxuY29uc3QgR2FtZWJvYXJkID0gKCkgPT4ge1xuICBsZXQgYm9hcmQgPSBbXTtcbiAgbGV0IG1pc3NlcyA9IFtdO1xuICBsZXQgaGl0cyA9IFtdO1xuXG4gIGxldCBhbGxTaGlwcyA9IHtcbiAgICBsX3NoaXA6IFNoaXAoNCksXG4gICAgbV9zaGlwX0k6IFNoaXAoMyksXG4gICAgbV9zaGlwX0lJOiBTaGlwKDMpLFxuICAgIHNfc2hpcF9JOiBTaGlwKDIpLFxuICAgIHNfc2hpcF9JSTogU2hpcCgyKSxcbiAgICBzX3NoaXBfSUlJOiBTaGlwKDIpLFxuICAgIHhzX3NoaXBfSTogU2hpcCgxKSxcbiAgICB4c19zaGlwX0lJOiBTaGlwKDEpLFxuICAgIHhzX3NoaXBfSUlJOiBTaGlwKDEpLFxuICAgIHhzX3NoaXBfSVY6IFNoaXAoMSksXG4gIH07XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiBib2FyZDtcbiAgY29uc3QgZ2V0TWlzc2VzID0gKCkgPT4gbWlzc2VzO1xuICBjb25zdCBnZXRTaGlwcyA9ICgpID0+IGFsbFNoaXBzO1xuICBjb25zdCBnZXRIaXRzID0gKCkgPT4gaGl0cztcblxuICBjb25zdCBjcmVhdGVCb2FyZCA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGJvYXJkW2ldID0gW107XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgYm9hcmRbaV1bal0gPSBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCBpc0VtcHR5ID0gKHgsIHkpID0+IHtcbiAgICByZXR1cm4gYm9hcmRbeF1beV0gPT09IG51bGwgPyB0cnVlIDogZmFsc2U7XG4gIH07XG5cbiAgY29uc3QgaXNGaXQgPSAoYXJyKSA9PiB7XG4gICAgbGV0IHN0YXR1cyA9IHRydWU7XG5cbiAgICBhcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgaWYgKGl0ZW1bMF0gPiA5IHx8IGl0ZW1bMV0gPiA5IHx8ICFpc0VtcHR5KGl0ZW1bMF0sIGl0ZW1bMV0pKVxuICAgICAgICByZXR1cm4gKHN0YXR1cyA9IGZhbHNlKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdGF0dXM7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlQ29tcCA9ICh4LCB5LCBzaGlwKSA9PiB7XG4gICAgY29uc3QgbGVuZ3RoID0gc2hpcC5nZXRTaGlwKCkubGVuZ3RoO1xuICAgIGNvbnN0IG9yaWVudGF0aW9uID0gc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb247XG4gICAgbGV0IHRlbXAgPSBbXTtcbiAgICBsZXQgYSA9IHg7XG4gICAgbGV0IGIgPSB5O1xuXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSBcImhvcml6b250YWxcIikge1xuICAgICAgd2hpbGUgKGIgIT09IHkgKyBsZW5ndGgpIHtcbiAgICAgICAgdGVtcC5wdXNoKFt4LCBiXSk7XG4gICAgICAgIGIgKz0gMTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgd2hpbGUgKGEgIT09IHggKyBsZW5ndGgpIHtcbiAgICAgICAgdGVtcC5wdXNoKFthLCB5XSk7XG4gICAgICAgIGEgKz0gMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGVtcDtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoeCwgeSwgc2hpcCkgPT4ge1xuICAgIGxldCB0ZW1wID0gW107XG4gICAgbGV0IHN0YXR1cyA9IHRydWU7XG5cbiAgICBpZiAoeSArIGxlbmd0aCAtIDEgPiA5IHx8IHggPiA5IHx8IHggKyBsZW5ndGggLSAxID4gOSB8fCB5ID4gOSkge1xuICAgICAgcmV0dXJuIGFsZXJ0KFwiU2hpcCBpcyBvdXQgb2YgYm91bmRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRlbXAgPSBjcmVhdGVDb21wKHgsIHksIHNoaXApO1xuICAgICAgc3RhdHVzID0gaXNGaXQodGVtcCk7XG4gICAgfVxuXG4gICAgaWYgKHN0YXR1cyA9PT0gZmFsc2UpIHtcbiAgICAgIHN0YXR1cyA9IHRydWU7XG4gICAgICB0ZW1wID0gW107XG4gICAgICByZXR1cm4gYWxlcnQoXCJzcXVhcmUgaXMgYWxyZWFkeSBvY2N1cGllZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hpcC5nZXRTaGlwKCkuY29tcCA9IHRlbXA7XG5cbiAgICAgIHNoaXAuZ2V0U2hpcCgpLmNvbXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBib2FyZFtpdGVtWzBdXVtpdGVtWzFdXSA9IHNoaXA7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcG9wdWxhdGVCZCA9ICgpID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYWxsU2hpcHMpO1xuICAgIGNvbnN0IGRpcmVjdGlvbnMgPSBbXCJob3Jpem9udGFsXCIsIFwidmVydGljYWxcIl07XG5cbiAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgY29uc3Qgc2hpcCA9IGFsbFNoaXBzW2tleV07XG4gICAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG5cbiAgICAgIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IGRpcmVjdGlvbnNbel07XG4gICAgICBsZXQgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBsZXQgZml0ID0gaXNGaXQodGVtcCk7XG5cbiAgICAgIHdoaWxlICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IGZpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyZWN0aW9uc1t6XTtcbiAgICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICAgIGZpdCA9IGlzRml0KHRlbXApO1xuICAgICAgfVxuXG4gICAgICBwbGFjZVNoaXAoeCwgeSwgc2hpcCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9ICh4LCB5KSA9PiB7XG4gICAgaWYgKGJvYXJkW3hdW3ldID09PSBudWxsKSBtaXNzZXMucHVzaChbeCwgeV0pO1xuICAgIGVsc2Uge1xuICAgICAgaGl0cy5wdXNoKFt4LCB5XSk7XG4gICAgICBib2FyZFt4XVt5XS5oaXQoKTtcbiAgICAgIGJvYXJkW3hdW3ldLmdldFNoaXAoKS5oaXRDb29yLnB1c2goW3gsIHldKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgaXNBbGxTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhhbGxTaGlwcyk7XG4gICAgbGV0IHN0YXR1cyA9IHRydWU7XG5cbiAgICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBpZiAoIXNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgcmV0dXJuIChzdGF0dXMgPSBmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY3JlYXRlQm9hcmQsXG4gICAgcGxhY2VTaGlwLFxuICAgIGdldEJvYXJkLFxuICAgIGdldFNoaXBzLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgZ2V0TWlzc2VzLFxuICAgIGdldEhpdHMsXG4gICAgaXNBbGxTdW5rLFxuICAgIHBvcHVsYXRlQmQsXG4gIH07XG59O1xuXG5leHBvcnQgeyBHYW1lYm9hcmQgfTtcbiIsImltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5jb25zdCBQbGF5ZXIgPSAobnVtYmVyKSA9PiB7XG4gIGxldCB3aW4gPSBmYWxzZTtcbiAgbGV0IGJvYXJkID0gR2FtZWJvYXJkKCk7XG4gIGxldCBpc0NvbXAgPSBmYWxzZTtcblxuICByZXR1cm4ge1xuICAgIG51bWJlcixcbiAgICB3aW4sXG4gICAgYm9hcmQsXG4gICAgaXNDb21wLFxuICB9O1xufTtcblxuZXhwb3J0IHsgUGxheWVyIH07XG4iLCJjb25zdCBmaWxsU3FyID0gKHBsYXllciwgc3FyLCB0YWcsIHgsIHkpID0+IHtcbiAgY29uc3QgbWlzc2VzID0gcGxheWVyLmJvYXJkLmdldE1pc3NlcygpO1xuXG4gIGlmIChzcXIgPT09IG51bGwpIHtcbiAgICBpZiAoXG4gICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHllbGxvdztcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGJsdWU7XCIpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChcbiAgICBzcXIuZ2V0U2hpcCgpLmhpdENvb3IuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICB9KVxuICApIHtcbiAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICB9XG59O1xuXG5jb25zdCByZW5kZXJTaGlwID0gKHBsYXllcikgPT4ge1xuICBsZXQgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3Qgc2hpcHNPYmogPSBwbGF5ZXIuYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHNMaXN0ID0gT2JqZWN0LmtleXMoc2hpcHNPYmopO1xuXG4gIHNoaXBzTGlzdC5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29tcCA9IHNoaXBzT2JqW3NoaXBdLmdldFNoaXAoKS5jb21wO1xuXG4gICAgaWYgKGNvbXAubGVuZ3RoICE9PSAwKSB7XG4gICAgICBjb25zdCB4Q29vciA9IGNvbXBbMF1bMF07XG4gICAgICBjb25zdCB5Q29vciA9IGNvbXBbMF1bMV07XG4gICAgICBwbGF5ZXIuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcHNPYmpbc2hpcF0pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGJvYXJkO1xufTtcblxuY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIHBsYXllci5ib2FyZC5jcmVhdGVCb2FyZCgpO1xuXG4gIHJlbmRlclNoaXAocGxheWVyKTtcblxuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBwbGF5ZXJOdW0gPSBwbGF5ZXIubnVtYmVyO1xuICBsZXQgY3VycmVudEJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJvYXJkJHtwbGF5ZXJOdW19YCk7XG5cbiAgd2hpbGUgKGN1cnJlbnRCb2FyZC5sYXN0RWxlbWVudENoaWxkKVxuICAgIGN1cnJlbnRCb2FyZC5yZW1vdmVDaGlsZChjdXJyZW50Qm9hcmQubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm9hcmQubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwbGF5ZXJOdW19LXNxdWFyZWApO1xuXG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS14XCIsIGAke2l9YCk7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGF0YS15XCIsIGAke2p9YCk7XG5cbiAgICAgIGZpbGxTcXIocGxheWVyLCBib2FyZFtpXVtqXSwgc3F1YXJlLCBpLCBqKTtcblxuICAgICAgY3VycmVudEJvYXJkLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRCb2FyZDtcbn07XG5cbmNvbnN0IGdyYWJQbGF5ZXJTaGlwcyA9IChwT25lLCBwVHdvKSA9PiB7XG4gIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKTtcbiAgY29uc3QgaWQgPSBmb3JtLmdldEF0dHJpYnV0ZShcImlkXCIpO1xuICBsZXQgc2hpcHNPYmo7XG4gIGlkID09PSBcInBsYXllck9uZS1mb3JtXCJcbiAgICA/IChzaGlwc09iaiA9IHBPbmUuYm9hcmQuZ2V0U2hpcHMoKSlcbiAgICA6IHBUd28uYm9hcmQuZ2V0U2hpcHMoKTtcbiAgY29uc3Qgc2hpcHMgPSBPYmplY3Qua2V5cyhzaGlwc09iaik7XG4gIGNvbnN0IHNlbGVjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNzaGlwc2ApO1xuXG4gIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgIG9wdGlvbi50ZXh0Q29udGVudCA9IHNoaXA7XG4gICAgc2VsZWN0aW9uLmFwcGVuZENoaWxkKG9wdGlvbik7XG4gIH0pO1xuXG4gIHJldHVybiBzZWxlY3Rpb247XG59O1xuXG5jb25zdCBpbml0UGxhY2VTaGlwID0gKHBPbmUsIHBUd28pID0+IHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYWNlU2hpcEJ0bmApO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImZvcm1cIik7XG4gICAgbGV0IGlkID0gZm9ybS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcblxuICAgIGNvbnN0IHhDb29yID0gcGFyc2VJbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3ktY29vcmApLnZhbHVlKTtcbiAgICBjb25zdCB5Q29vciA9IHBhcnNlSW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCN4LWNvb3JgKS52YWx1ZSk7XG4gICAgY29uc3Qgc2hpcE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjc2hpcHNgKS52YWx1ZTtcblxuICAgIGNvbnN0IG9yaWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNvcmllbnRhdGlvbmApLnZhbHVlO1xuXG4gICAgbGV0IHNoaXA7XG4gICAgaWQgPT09IFwicGxheWVyT25lLWZvcm1cIlxuICAgICAgPyAoc2hpcCA9IHBPbmUuYm9hcmQuZ2V0U2hpcHMoKVtzaGlwTmFtZV0pXG4gICAgICA6IChzaGlwID0gcFR3by5ib2FyZC5nZXRTaGlwcygpW3NoaXBOYW1lXSk7XG5cbiAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IG9yaWVudDtcblxuICAgIGlmIChOdW1iZXIuaXNOYU4oeENvb3IpIHx8IE51bWJlci5pc05hTih5Q29vcikpIHJldHVybjtcbiAgICBlbHNlIHtcbiAgICAgIGlmIChpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiKSB7XG4gICAgICAgIHBPbmUuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcCk7XG4gICAgICAgIHJlbmRlckJvYXJkKHBPbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcFR3by5ib2FyZC5wbGFjZVNoaXAoeENvb3IsIHlDb29yLCBzaGlwKTtcbiAgICAgICAgcmVuZGVyQm9hcmQocFR3byk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGluaXRGaW5TZXR1cCA9IChwT25lLCBwVHdvKSA9PiB7XG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2ZpbkJ0bmApO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZm9ybWApO1xuXG4gIGxldCBpc0FsbFBsYWNlZCA9IGZhbHNlO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBsZXQgc2hpcHNPYmo7XG4gICAgY29uc3QgbW9kZSA9IG1haW4uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIik7XG4gICAgbGV0IGlkID0gZm9ybS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcblxuICAgIGlkID09PSBcInBsYXllck9uZS1mb3JtXCJcbiAgICAgID8gKHNoaXBzT2JqID0gcE9uZS5ib2FyZC5nZXRTaGlwcygpKVxuICAgICAgOiAoc2hpcHNPYmogPSBwVHdvLmJvYXJkLmdldFNoaXBzKCkpO1xuXG4gICAgY29uc3Qgc2hpcHMgPSBPYmplY3QudmFsdWVzKHNoaXBzT2JqKTtcblxuICAgIHNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIGNvbnN0IGNvbXAgPSBzaGlwLmdldFNoaXAoKS5jb21wO1xuICAgICAgaWYgKGNvbXAubGVuZ3RoID09PSAwKSByZXR1cm4gKGlzQWxsUGxhY2VkID0gZmFsc2UpO1xuICAgICAgZWxzZSByZXR1cm4gKGlzQWxsUGxhY2VkID0gdHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpZiAoaXNBbGxQbGFjZWQpIHtcbiAgICAgIGlmIChpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiKSB7XG4gICAgICAgIGZvcm0uc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJwbGF5ZXJUd28tZm9ybVwiKTtcbiAgICAgICAgaGlkZUJvYXJkKHBPbmUpO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kZSA9PT0gXCJwdmNcIiB8fCBpZCA9PT0gXCJwbGF5ZXJUd28tZm9ybVwiKSB7XG4gICAgICAgIGZvcm0uc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBub25lO1wiKTtcbiAgICAgICAgaGlkZUJvYXJkKHBUd28pO1xuICAgICAgICBjb25zdCBkaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpYWxvZ1wiKTtcbiAgICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhbGVydChcIlBsZWFzZSBwbGFjZSBhbGwgdGhlIHNoaXBzIGZpcnN0XCIpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBoaWRlQm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIGxldCBzcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLiR7cGxheWVyLm51bWJlcn0tc3F1YXJlYCk7XG5cbiAgc3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogZ3JheTtcIik7XG4gIH0pO1xufTtcblxuY29uc3QgaW5pdHBsYXlCdG4gPSAoUE9uZSwgUFR3bykgPT4ge1xuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG4gIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlhbG9nXCIpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxheVwiKTtcblxuICBwbGF5QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBsZXQgcGxheWVyID0gcGxheVdpbmRvdy5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuXG4gICAgaWYgKHBsYXllciA9PT0gXCJwbGF5ZXItVHdvXCIpIHtcbiAgICAgIHJlbmRlckJvYXJkKFBPbmUpO1xuICAgICAgcmVuZGVyUGxheUJkKFBUd28pO1xuICAgICAgcGxheVdpbmRvdy5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGBwbGF5ZXItJHtQT25lLm51bWJlcn1gKTtcbiAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICB9IGVsc2UgaWYgKHBsYXllciA9PT0gXCJwbGF5ZXItT25lXCIpIHtcbiAgICAgIGNvbnN0IG1vZGUgPSBtYWluLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpO1xuICAgICAgcGxheVdpbmRvdy5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGBwbGF5ZXItJHtQVHdvLm51bWJlcn1gKTtcbiAgICAgIGlmIChtb2RlID09PSBcInB2Y1wiKSB7XG4gICAgICAgIGF1dG9BdGsoUE9uZSwgUFR3byk7XG4gICAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlbmRlckJvYXJkKFBUd28pO1xuICAgICAgICByZW5kZXJQbGF5QmQoUE9uZSk7XG4gICAgICAgIHJldHVybiBkaWFsb2cuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcblxuY29uc3QgcmVuZGVyUGxheUJkID0gKHBsYXllcikgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZC5nZXRCb2FyZCgpO1xuICBjb25zdCBtaXNzZXMgPSBwbGF5ZXIuYm9hcmQuZ2V0TWlzc2VzKCk7XG4gIGNvbnN0IGN1cnJCb2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNib2FyZCR7cGxheWVyLm51bWJlcn1gKTtcblxuICB3aGlsZSAoY3VyckJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpXG4gICAgY3VyckJvYXJkLnJlbW92ZUNoaWxkKGN1cnJCb2FyZC5sYXN0RWxlbWVudENoaWxkKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBib2FyZC5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgaXRlbSA9IGJvYXJkW2ldW2pdO1xuXG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoYCR7cGxheWVyLm51bWJlcn0tc3F1YXJlYCk7XG5cbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIiwgYCR7aX1gKTtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIiwgYCR7an1gKTtcblxuICAgICAgaW5pdFNxckJ0bihwbGF5ZXIsIHNxdWFyZSk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbSAhPT0gbnVsbCAmJlxuICAgICAgICBpdGVtLmdldFNoaXAoKS5oaXRDb3VudCA+IDAgJiZcbiAgICAgICAgaXRlbS5nZXRTaGlwKCkuaGl0Q29vci5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IGkgJiYgaXRlbVsxXSA9PT0gajtcbiAgICAgICAgfSlcbiAgICAgICkge1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0gaSAmJiBpdGVtWzFdID09PSBqO1xuICAgICAgICB9KVxuICAgICAgKSB7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiKTtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgfVxuXG4gICAgICBjdXJyQm9hcmQuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGluaXRTcXJCdG4gPSAocGxheWVyLCBzcXVhcmUpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBwbGF5ZXIuYm9hcmQ7XG4gIGNvbnN0IGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlhbG9nXCIpO1xuICBjb25zdCB4ID0gcGFyc2VJbnQoc3F1YXJlLmdldEF0dHJpYnV0ZShcImRhdGEteFwiKSk7XG4gIGNvbnN0IHkgPSBwYXJzZUludChzcXVhcmUuZ2V0QXR0cmlidXRlKFwiZGF0YS15XCIpKTtcbiAgY29uc3Qgd2lubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJcIik7XG4gIGNvbnN0IGVuZE1zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZW5kLWdhbWVcIik7XG5cbiAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgaWYgKGJvYXJkTGlzdFt4XVt5XSA9PT0gbnVsbCkge1xuICAgICAgaGlkZUJvYXJkKHBsYXllcik7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XCIpO1xuICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjtcIik7XG5cbiAgICAgIGlmIChwbGF5ZXIuYm9hcmQuaXNBbGxTdW5rKCkpIHtcbiAgICAgICAgZW5kTXNnLnNob3dNb2RhbCgpO1xuICAgICAgICBpZiAocGxheWVyLm51bWJlciA9PT0gXCJPbmVcIikge1xuICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IGBDb25ncmF0dWxhdGlvbnMgUGxheWVyIFR3byFgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IGBDb25ncmF0dWxhdGlvbnMgUGxheWVyIE9uZSFgO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGNvbXBNb2RlID0gKHBsYXllcikgPT4ge1xuICBwbGF5ZXIuYm9hcmQucG9wdWxhdGVCZCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXIpO1xuICBoaWRlQm9hcmQocGxheWVyKTtcbn07XG5cbmNvbnN0IGF1dG9BdGsgPSAocGxheU9uZSwgcGxheVR3bykgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXlPbmUuYm9hcmQ7XG4gIGNvbnN0IGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IG1pc3NlcyA9IGJvYXJkLmdldE1pc3NlcygpO1xuICBjb25zdCBoaXRzID0gYm9hcmQuZ2V0SGl0cygpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gIGxldCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICBsZXQgY29udCA9IHRydWU7XG5cbiAgd2hpbGUgKGNvbnQgPT09IHRydWUpIHtcbiAgICBpZiAoXG4gICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSkgfHxcbiAgICAgIGhpdHMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0geCAmJiBpdGVtWzFdID09PSB5O1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcblxuICAgIGlmIChib2FyZExpc3RbeF1beV0gPT09IG51bGwpIHtcbiAgICAgIHBsYXlXaW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBgcGxheWVyLSR7cGxheU9uZS5udW1iZXJ9YCk7XG4gICAgICByZW5kZXJCb2FyZChwbGF5T25lKTtcbiAgICAgIHJlbmRlclBsYXlCZChwbGF5VHdvKTtcbiAgICAgIGNvbnQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQge1xuICByZW5kZXJCb2FyZCxcbiAgZ3JhYlBsYXllclNoaXBzLFxuICBpbml0UGxhY2VTaGlwLFxuICBpbml0RmluU2V0dXAsXG4gIGluaXRwbGF5QnRuLFxuICBjb21wTW9kZSxcbn07XG4iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCB7XG4gIHJlbmRlckJvYXJkLFxuICBncmFiUGxheWVyU2hpcHMsXG4gIGluaXRQbGFjZVNoaXAsXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxufSBmcm9tIFwiLi9ET01cIjtcblxuY29uc3QgZ2FtZU1vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWVfbW9kZVwiKTtcbmNvbnN0IHB2cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHZwXCIpO1xuY29uc3QgcHZjQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwdmNcIik7XG5jb25zdCBwbGF5ZXJPbmUgPSBQbGF5ZXIoXCJPbmVcIik7XG5jb25zdCBwbGF5ZXJUd28gPSBQbGF5ZXIoXCJUd29cIik7XG5cbnB2cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJPbmUpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJUd28pO1xuXG4gIGdyYWJQbGF5ZXJTaGlwcyhwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgaW5pdFBsYWNlU2hpcChwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgaW5pdEZpblNldHVwKHBsYXllck9uZSwgcGxheWVyVHdvKTtcblxuICBpbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgcmV0dXJuIGdhbWVNb2RlLmNsb3NlKCk7XG59KTtcblxucHZjQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuXG4gIHJlbmRlckJvYXJkKHBsYXllck9uZSk7XG4gIHJlbmRlckJvYXJkKHBsYXllclR3byk7XG4gIGdyYWJQbGF5ZXJTaGlwcyhwbGF5ZXJPbmUsIHBsYXllclR3byk7XG4gIGluaXRQbGFjZVNoaXAocGxheWVyT25lLCBwbGF5ZXJUd28pO1xuICBpbml0RmluU2V0dXAocGxheWVyT25lLCBwbGF5ZXJUd28pO1xuICBpbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbiAgY29tcE1vZGUocGxheWVyVHdvKTtcblxuICBtYWluLmNsYXNzTGlzdC5hZGQoXCJwdmNcIik7XG5cbiAgcmV0dXJuIGdhbWVNb2RlLmNsb3NlKCk7XG59KTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubG9hZFwiLCBnYW1lTW9kZS5zaG93TW9kYWwoKSk7XG4iXSwibmFtZXMiOlsiU2hpcCIsIm4iLCJzaGlwT2JqIiwiZ2V0U2hpcCIsImhpdCIsImhpdENvdW50IiwibGVuZ3RoIiwic3VuayIsImlzU3VuayIsIkdhbWVib2FyZCIsImJvYXJkIiwibWlzc2VzIiwiaGl0cyIsImFsbFNoaXBzIiwibF9zaGlwIiwibV9zaGlwX0kiLCJtX3NoaXBfSUkiLCJzX3NoaXBfSSIsInNfc2hpcF9JSSIsInNfc2hpcF9JSUkiLCJ4c19zaGlwX0kiLCJ4c19zaGlwX0lJIiwieHNfc2hpcF9JSUkiLCJ4c19zaGlwX0lWIiwiaXNGaXQiLCJhcnIiLCJzdGF0dXMiLCJmb3JFYWNoIiwiaXRlbSIsIngiLCJ5IiwiY3JlYXRlQ29tcCIsInNoaXAiLCJ0ZW1wIiwiYSIsImIiLCJvcmllbnRhdGlvbiIsInB1c2giLCJwbGFjZVNoaXAiLCJhbGVydCIsImNvbXAiLCJjcmVhdGVCb2FyZCIsImkiLCJqIiwiZ2V0Qm9hcmQiLCJnZXRTaGlwcyIsInJlY2VpdmVBdHRhY2siLCJoaXRDb29yIiwiZ2V0TWlzc2VzIiwiZ2V0SGl0cyIsImlzQWxsU3VuayIsInNoaXBzIiwiT2JqZWN0IiwidmFsdWVzIiwicG9wdWxhdGVCZCIsImtleXMiLCJkaXJlY3Rpb25zIiwia2V5IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwieiIsImZpdCIsIlBsYXllciIsIm51bWJlciIsIndpbiIsImlzQ29tcCIsImZpbGxTcXIiLCJwbGF5ZXIiLCJzcXIiLCJ0YWciLCJmaW5kIiwic2V0QXR0cmlidXRlIiwicmVuZGVyQm9hcmQiLCJzaGlwc09iaiIsInhDb29yIiwieUNvb3IiLCJyZW5kZXJTaGlwIiwicGxheWVyTnVtIiwiY3VycmVudEJvYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImxhc3RFbGVtZW50Q2hpbGQiLCJyZW1vdmVDaGlsZCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsImdyYWJQbGF5ZXJTaGlwcyIsInBPbmUiLCJwVHdvIiwicXVlcnlTZWxlY3RvciIsImdldEF0dHJpYnV0ZSIsInNlbGVjdGlvbiIsIm9wdGlvbiIsInRleHRDb250ZW50IiwiaW5pdFBsYWNlU2hpcCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJpZCIsInBhcnNlSW50IiwidmFsdWUiLCJzaGlwTmFtZSIsIm9yaWVudCIsIk51bWJlciIsImlzTmFOIiwiaW5pdEZpblNldHVwIiwibWFpbiIsImJ1dHRvbiIsImZvcm0iLCJpc0FsbFBsYWNlZCIsIm1vZGUiLCJoaWRlQm9hcmQiLCJzaG93TW9kYWwiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5pdHBsYXlCdG4iLCJQT25lIiwiUFR3byIsImRpYWxvZyIsInBsYXlXaW5kb3ciLCJyZW5kZXJQbGF5QmQiLCJjbG9zZSIsImF1dG9BdGsiLCJjdXJyQm9hcmQiLCJpbml0U3FyQnRuIiwiYm9hcmRMaXN0Iiwid2lubmVyIiwiZW5kTXNnIiwicGxheU9uZSIsInBsYXlUd28iLCJjb250IiwiZ2FtZU1vZGUiLCJwdnBCdG4iLCJwdmNCdG4iLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iXSwic291cmNlUm9vdCI6IiJ9