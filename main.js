(()=>{"use strict";const e=e=>{let t={};return t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],{getShip:()=>t,hit:()=>{t.hitCount+=1,t.hitCount===t.length&&(t.sunk=!0)},isSunk:()=>!0===t.sunk,resetShip:()=>(t.length=e,t.hitCount=0,t.sunk=!1,t.orientation="horizontal",t.comp=[],t.hitCoor=[],t)}},t=()=>{let t=[],r=[],o=[],n={battleship:e(4),cruiser_I:e(3),cruiser_II:e(3),destroyer_I:e(2),destroyer_II:e(2),destroyer_III:e(2),submarine_I:e(1),submarine_II:e(1),submarine_III:e(1),submarine_IV:e(1)};const a=e=>{let r=!0;return e.forEach((e=>{if(e[0]>9||e[1]>9||(o=e[0],n=e[1],null!==t[o][n]))return r=!1;var o,n})),r},l=(e,t,r)=>{const o=r.getShip().length;let n=[],a=e,l=t;if("horizontal"===r.getShip().orientation)for(;l!==t+o;)n.push([e,l]),l+=1;else for(;a!==e+o;)n.push([a,t]),a+=1;return n},u=(e,r,o)=>{let n=[],u=!0;return r+length-1>9||e>9||e+length-1>9||r>9?alert("Ship is out of bound"):(n=l(e,r,o),u=a(n),!1===u?(u=!0,n=[],alert("square is already occupied")):(o.getShip().comp=n,o.getShip().comp.forEach((e=>{t[e[0]][e[1]]=o})),t))};return{createBoard:()=>{for(let e=0;e<10;e++){t[e]=[];for(let r=0;r<10;r++)t[e][r]=null}return t},placeShip:u,getBoard:()=>t,getShips:()=>n,receiveAttack:(e,n)=>(null===t[e][n]?r.push([e,n]):(o.push([e,n]),t[e][n].hit(),t[e][n].getShip().hitCoor.push([e,n])),t),getMisses:()=>r,getHits:()=>o,isAllSunk:()=>{const e=Object.values(n);let t=!0;return e.forEach((e=>{if(!e.isSunk())return t=!1})),t},populateBd:()=>{const e=Object.keys(n),r=["horizontal","vertical"];return e.forEach((e=>{const t=n[e],o=t.getShip().length;let i=Math.floor(10*Math.random()),c=Math.floor(10*Math.random()),d=Math.floor(2*Math.random());t.getShip().orientation=r[d];let s=l(i,c,t),h=a(s);for(;c+o-1>9||i+o-1>9||!1===h;)i=Math.floor(10*Math.random()),c=Math.floor(10*Math.random()),d=Math.floor(2*Math.random()),t.getShip().orientation=r[d],s=l(i,c,t),h=a(s);u(i,c,t)})),t},resetBoard:()=>{const e=Object.keys(n);t=[],r=[],o=[],e.forEach((e=>{n[e].resetShip()}))}}},r=e=>({number:e,win:!1,board:t(),isComp:!1}),o=(e,t,r,o,n)=>{const a=e.board.getMisses();null===t?a.find((e=>e[0]===o&&e[1]===n))?r.setAttribute("style","background-color: yellow;"):r.setAttribute("style","background-color: blue;"):t.getShip().hitCoor.find((e=>e[0]===o&&e[1]===n))&&r.setAttribute("style","background-color: red;")},n=e=>{e.board.createBoard(),(e=>{e.board.getBoard();const t=e.board.getShips();Object.keys(t).forEach((r=>{const o=t[r].getShip().comp;if(0!==o.length){const n=o[0][0],a=o[0][1];e.board.placeShip(n,a,t[r])}}))})(e);const t=e.board.getBoard(),r=e.number;let n=document.getElementById(`board${r}`);for(;n.lastElementChild;)n.removeChild(n.lastElementChild);for(let a=0;a<t.length;a++)for(let l=0;l<t.length;l++){const u=document.createElement("div");u.classList.add(`${r}-square`),u.setAttribute("data-x",`${a}`),u.setAttribute("data-y",`${l}`),o(e,t[a][l],u,a,l),n.appendChild(u)}return n},a=e=>{document.querySelectorAll(`.${e.number}-square`).forEach((e=>{e.setAttribute("disabled",""),e.setAttribute("style","background-color: gray;")}))},l=e=>{const t=e.board.getBoard(),r=e.board.getMisses(),o=document.querySelector(`#board${e.number}`);for(;o.lastElementChild;)o.removeChild(o.lastElementChild);for(let n=0;n<t.length;n++)for(let a=0;a<t.length;a++){const l=t[n][a],i=document.createElement("button");i.classList.add(`${e.number}-square`),i.setAttribute("data-x",`${n}`),i.setAttribute("data-y",`${a}`),u(e,i),null!==l&&l.getShip().hitCount>0&&l.getShip().hitCoor.find((e=>e[0]===n&&e[1]===a))&&(i.setAttribute("style","background-color: red;"),i.setAttribute("disabled","")),r.find((e=>e[0]===n&&e[1]===a))&&(i.setAttribute("style","background-color: green;"),i.setAttribute("disabled","")),o.appendChild(i)}},u=(e,t)=>{const r=e.board,o=r.getBoard(),n=document.querySelector(".dialog"),l=parseInt(t.getAttribute("data-x")),u=parseInt(t.getAttribute("data-y")),i=document.querySelector(".winner"),c=document.querySelector(".end-game"),d=document.querySelector("#play-window"),s=document.querySelector(".player-name"),h=document.querySelector("main");t.addEventListener("click",(m=>{m.preventDefault();const p=d.getAttribute("data-id"),b=h.getAttribute("class");r.receiveAttack(l,u),null===o[l][u]?(a(e),t.setAttribute("style","background-color: yellow;"),s.textContent="pvc"===b?"Computer`s turn!":"player-One"===p?"Player Two`s turn!":"Player One`s turn!",n.showModal()):(t.setAttribute("style","background-color: red;"),e.board.isAllSunk()&&(t.setAttribute("style","background-color: red;"),c.showModal(),"One"===e.number?i.textContent="Congratulations Player Two!":i.textContent="Congratulations Player One!"))}))},i=document.querySelector(".game_mode"),c=document.querySelector("#pvp"),d=document.querySelector("#pvc"),s=document.querySelectorAll(".restart"),h=document.querySelector(".end-game"),m=document.querySelector("form");let p=r("One"),b=r("Two");var y,g;y=p,g=b,document.querySelector("#placeShipBtn").addEventListener("click",(e=>{e.preventDefault();let t=document.querySelector("form").getAttribute("id");const r=parseInt(document.querySelector("#y-coor").value),o=parseInt(document.querySelector("#x-coor").value),a=document.querySelector("#ships").value,l=document.querySelector("#orientation").value;let u;u="playerOne-form"===t?y.board.getShips()[a]:g.board.getShips()[a],u.getShip().orientation=l,Number.isNaN(r)||Number.isNaN(o)||("playerOne-form"===t?(y.board.placeShip(r,o,u),n(y)):(g.board.placeShip(r,o,u),n(g)))})),((e,t)=>{const r=document.querySelector("main"),o=document.querySelector("#finBtn"),n=document.querySelector("form"),l=document.querySelector(".player-name");let u=!1;o.addEventListener("click",(o=>{let i;o.preventDefault();const c=r.getAttribute("class");let d=n.getAttribute("id");if(i="playerOne-form"===d?e.board.getShips():t.board.getShips(),Object.values(i).forEach((e=>{const t=e.getShip().comp;return u=0!==t.length})),u){if("playerOne-form"===d&&(n.setAttribute("id","playerTwo-form"),a(e)),"pvc"===c||"playerTwo-form"===d){n.setAttribute("style","display: none;"),a(t);const e=document.querySelector(".dialog");l.textContent="Player One`s turn!",e.showModal()}}else alert("Please place all the ships first")}))})(p,b),((e,t)=>{const r=document.querySelector("main"),o=document.querySelector(".dialog"),a=document.querySelector("#play-window");document.querySelector("#play").addEventListener("click",(u=>{u.preventDefault();let i=a.getAttribute("data-id");if("player-Two"===i)return n(e),l(t),a.setAttribute("data-id",`player-${e.number}`),o.close();if("player-One"===i){const u=r.getAttribute("class");return a.setAttribute("data-id",`player-${t.number}`),"pvc"===u?(((e,t)=>{const r=e.board,o=r.getBoard(),a=r.getMisses(),u=r.getHits(),i=document.querySelector("#play-window"),c=document.querySelector(".winner"),d=document.querySelector(".end-game");let s=Math.floor(10*Math.random()),h=Math.floor(10*Math.random()),m=!0;for(;!0===m;)a.find((e=>e[0]===s&&e[1]===h))||u.find((e=>e[0]===s&&e[1]===h))?(s=Math.floor(10*Math.random()),h=Math.floor(10*Math.random())):(r.receiveAttack(s,h),null===o[s][h]?(i.setAttribute("data-id",`player-${e.number}`),n(e),l(t),m=!1):e.board.isAllSunk()?(m=!1,d.showModal(),c.textContent="Computer won!"):(s=Math.floor(10*Math.random()),h=Math.floor(10*Math.random())))})(e,t),o.close()):(n(t),l(e),o.close())}}))})(p,b),c.addEventListener("click",(e=>(e.preventDefault(),n(p),n(b),i.close()))),d.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main");var r;return n(p),n(b),(r=b).board.populateBd(),n(r),a(r),t.classList.add("pvc"),i.close()})),s.forEach((e=>e.addEventListener("click",(e=>{e.preventDefault();const t=document.querySelector("main"),r=document.querySelector("#play-window");h.close(),m.setAttribute("id","playerOne-form"),m.removeAttribute("style"),t.classList.remove("pvc"),r.setAttribute("data-id","player-Two"),p.board.resetBoard(),b.board.resetBoard(),i.showModal()})))),document.addEventListener("onload",i.showModal())})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eEI5QixTQUFTd0IsaUJBQWlCLFNBQVVPLEVBQVNELFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly90ZW1wbGF0ZS8uL3NyYy9wbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vdGVtcGxhdGUvLi9zcmMvRE9NLmpzIiwid2VicGFjazovL3RlbXBsYXRlLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSAobikgPT4ge1xuICBsZXQgc2hpcE9iaiA9IHt9O1xuXG4gIHNoaXBPYmpbXCJsZW5ndGhcIl0gPSBuO1xuICBzaGlwT2JqW1wiaGl0Q291bnRcIl0gPSAwO1xuICBzaGlwT2JqW1wic3Vua1wiXSA9IGZhbHNlO1xuICBzaGlwT2JqW1wib3JpZW50YXRpb25cIl0gPSBcImhvcml6b250YWxcIjtcbiAgc2hpcE9ialtcImNvbXBcIl0gPSBbXTtcbiAgc2hpcE9ialtcImhpdENvb3JcIl0gPSBbXTtcblxuICBjb25zdCBnZXRTaGlwID0gKCkgPT4gc2hpcE9iajtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgc2hpcE9iai5oaXRDb3VudCArPSAxO1xuICAgIGlmIChzaGlwT2JqLmhpdENvdW50ID09PSBzaGlwT2JqLmxlbmd0aCkgc2hpcE9iai5zdW5rID0gdHJ1ZTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNoaXBPYmouc3VuayA9PT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTtcbiAgfTtcblxuICBjb25zdCByZXNldFNoaXAgPSAoKSA9PiB7XG4gICAgc2hpcE9iai5sZW5ndGggPSBuO1xuICAgIHNoaXBPYmouaGl0Q291bnQgPSAwO1xuICAgIHNoaXBPYmouc3VuayA9IGZhbHNlO1xuICAgIHNoaXBPYmoub3JpZW50YXRpb24gPSBcImhvcml6b250YWxcIjtcbiAgICBzaGlwT2JqLmNvbXAgPSBbXTtcbiAgICBzaGlwT2JqLmhpdENvb3IgPSBbXTtcblxuICAgIHJldHVybiBzaGlwT2JqO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0U2hpcCxcbiAgICBoaXQsXG4gICAgaXNTdW5rLFxuICAgIHJlc2V0U2hpcCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFNoaXAgfTtcbiIsImltcG9ydCB7IFNoaXAgfSBmcm9tIFwiLi9zaGlwXCI7XG5cbmNvbnN0IEdhbWVib2FyZCA9ICgpID0+IHtcbiAgbGV0IGJvYXJkID0gW107XG4gIGxldCBtaXNzZXMgPSBbXTtcbiAgbGV0IGhpdHMgPSBbXTtcblxuICBsZXQgYWxsU2hpcHMgPSB7XG4gICAgYmF0dGxlc2hpcDogU2hpcCg0KSxcbiAgICBjcnVpc2VyX0k6IFNoaXAoMyksXG4gICAgY3J1aXNlcl9JSTogU2hpcCgzKSxcbiAgICBkZXN0cm95ZXJfSTogU2hpcCgyKSxcbiAgICBkZXN0cm95ZXJfSUk6IFNoaXAoMiksXG4gICAgZGVzdHJveWVyX0lJSTogU2hpcCgyKSxcbiAgICBzdWJtYXJpbmVfSTogU2hpcCgxKSxcbiAgICBzdWJtYXJpbmVfSUk6IFNoaXAoMSksXG4gICAgc3VibWFyaW5lX0lJSTogU2hpcCgxKSxcbiAgICBzdWJtYXJpbmVfSVY6IFNoaXAoMSksXG4gIH07XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiBib2FyZDtcbiAgY29uc3QgZ2V0TWlzc2VzID0gKCkgPT4gbWlzc2VzO1xuICBjb25zdCBnZXRTaGlwcyA9ICgpID0+IGFsbFNoaXBzO1xuICBjb25zdCBnZXRIaXRzID0gKCkgPT4gaGl0cztcblxuICBjb25zdCBjcmVhdGVCb2FyZCA9ICgpID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGJvYXJkW2ldID0gW107XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgYm9hcmRbaV1bal0gPSBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBib2FyZDtcbiAgfTtcblxuICBjb25zdCBpc0VtcHR5ID0gKHgsIHkpID0+IHtcbiAgICByZXR1cm4gYm9hcmRbeF1beV0gPT09IG51bGwgPyB0cnVlIDogZmFsc2U7XG4gIH07XG5cbiAgY29uc3QgaXNGaXQgPSAoYXJyKSA9PiB7XG4gICAgbGV0IHN0YXR1cyA9IHRydWU7XG5cbiAgICBhcnIuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgaWYgKGl0ZW1bMF0gPiA5IHx8IGl0ZW1bMV0gPiA5IHx8ICFpc0VtcHR5KGl0ZW1bMF0sIGl0ZW1bMV0pKVxuICAgICAgICByZXR1cm4gKHN0YXR1cyA9IGZhbHNlKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdGF0dXM7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlQ29tcCA9ICh4LCB5LCBzaGlwKSA9PiB7XG4gICAgY29uc3QgbGVuZ3RoID0gc2hpcC5nZXRTaGlwKCkubGVuZ3RoO1xuICAgIGNvbnN0IG9yaWVudGF0aW9uID0gc2hpcC5nZXRTaGlwKCkub3JpZW50YXRpb247XG4gICAgbGV0IHRlbXAgPSBbXTtcbiAgICBsZXQgYSA9IHg7XG4gICAgbGV0IGIgPSB5O1xuXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSBcImhvcml6b250YWxcIikge1xuICAgICAgd2hpbGUgKGIgIT09IHkgKyBsZW5ndGgpIHtcbiAgICAgICAgdGVtcC5wdXNoKFt4LCBiXSk7XG4gICAgICAgIGIgKz0gMTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgd2hpbGUgKGEgIT09IHggKyBsZW5ndGgpIHtcbiAgICAgICAgdGVtcC5wdXNoKFthLCB5XSk7XG4gICAgICAgIGEgKz0gMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGVtcDtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoeCwgeSwgc2hpcCkgPT4ge1xuICAgIGxldCB0ZW1wID0gW107XG4gICAgbGV0IHN0YXR1cyA9IHRydWU7XG5cbiAgICBpZiAoeSArIGxlbmd0aCAtIDEgPiA5IHx8IHggPiA5IHx8IHggKyBsZW5ndGggLSAxID4gOSB8fCB5ID4gOSkge1xuICAgICAgcmV0dXJuIGFsZXJ0KFwiU2hpcCBpcyBvdXQgb2YgYm91bmRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRlbXAgPSBjcmVhdGVDb21wKHgsIHksIHNoaXApO1xuICAgICAgc3RhdHVzID0gaXNGaXQodGVtcCk7XG4gICAgfVxuXG4gICAgaWYgKHN0YXR1cyA9PT0gZmFsc2UpIHtcbiAgICAgIHN0YXR1cyA9IHRydWU7XG4gICAgICB0ZW1wID0gW107XG4gICAgICByZXR1cm4gYWxlcnQoXCJzcXVhcmUgaXMgYWxyZWFkeSBvY2N1cGllZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hpcC5nZXRTaGlwKCkuY29tcCA9IHRlbXA7XG5cbiAgICAgIHNoaXAuZ2V0U2hpcCgpLmNvbXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBib2FyZFtpdGVtWzBdXVtpdGVtWzFdXSA9IHNoaXA7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcG9wdWxhdGVCZCA9ICgpID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYWxsU2hpcHMpO1xuICAgIGNvbnN0IGRpcmVjdGlvbnMgPSBbXCJob3Jpem9udGFsXCIsIFwidmVydGljYWxcIl07XG5cbiAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgY29uc3Qgc2hpcCA9IGFsbFNoaXBzW2tleV07XG4gICAgICBjb25zdCBsZW5ndGggPSBzaGlwLmdldFNoaXAoKS5sZW5ndGg7XG5cbiAgICAgIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBsZXQgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IGRpcmVjdGlvbnNbel07XG4gICAgICBsZXQgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICBsZXQgZml0ID0gaXNGaXQodGVtcCk7XG5cbiAgICAgIHdoaWxlICh5ICsgbGVuZ3RoIC0gMSA+IDkgfHwgeCArIGxlbmd0aCAtIDEgPiA5IHx8IGZpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuXG4gICAgICAgIHNoaXAuZ2V0U2hpcCgpLm9yaWVudGF0aW9uID0gZGlyZWN0aW9uc1t6XTtcbiAgICAgICAgdGVtcCA9IGNyZWF0ZUNvbXAoeCwgeSwgc2hpcCk7XG4gICAgICAgIGZpdCA9IGlzRml0KHRlbXApO1xuICAgICAgfVxuXG4gICAgICBwbGFjZVNoaXAoeCwgeSwgc2hpcCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9ICh4LCB5KSA9PiB7XG4gICAgaWYgKGJvYXJkW3hdW3ldID09PSBudWxsKSBtaXNzZXMucHVzaChbeCwgeV0pO1xuICAgIGVsc2Uge1xuICAgICAgaGl0cy5wdXNoKFt4LCB5XSk7XG4gICAgICBib2FyZFt4XVt5XS5oaXQoKTtcbiAgICAgIGJvYXJkW3hdW3ldLmdldFNoaXAoKS5oaXRDb29yLnB1c2goW3gsIHldKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG5cbiAgY29uc3QgaXNBbGxTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhhbGxTaGlwcyk7XG4gICAgbGV0IHN0YXR1cyA9IHRydWU7XG5cbiAgICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBpZiAoIXNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgcmV0dXJuIChzdGF0dXMgPSBmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9O1xuXG4gIGNvbnN0IHJlc2V0Qm9hcmQgPSAoKSA9PiB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGFsbFNoaXBzKTtcbiAgICBib2FyZCA9IFtdO1xuICAgIG1pc3NlcyA9IFtdO1xuICAgIGhpdHMgPSBbXTtcblxuICAgIGtleXMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgYWxsU2hpcHNbc2hpcF0ucmVzZXRTaGlwKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVCb2FyZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgZ2V0Qm9hcmQsXG4gICAgZ2V0U2hpcHMsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBnZXRNaXNzZXMsXG4gICAgZ2V0SGl0cyxcbiAgICBpc0FsbFN1bmssXG4gICAgcG9wdWxhdGVCZCxcbiAgICByZXNldEJvYXJkLFxuICB9O1xufTtcblxuZXhwb3J0IHsgR2FtZWJvYXJkIH07XG4iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcblxuY29uc3QgUGxheWVyID0gKG51bWJlcikgPT4ge1xuICBsZXQgd2luID0gZmFsc2U7XG4gIGxldCBib2FyZCA9IEdhbWVib2FyZCgpO1xuICBsZXQgaXNDb21wID0gZmFsc2U7XG5cbiAgcmV0dXJuIHtcbiAgICBudW1iZXIsXG4gICAgd2luLFxuICAgIGJvYXJkLFxuICAgIGlzQ29tcCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFBsYXllciB9O1xuIiwiY29uc3QgZmlsbFNxciA9IChwbGF5ZXIsIHNxciwgdGFnLCB4LCB5KSA9PiB7XG4gIGNvbnN0IG1pc3NlcyA9IHBsYXllci5ib2FyZC5nZXRNaXNzZXMoKTtcblxuICBpZiAoc3FyID09PSBudWxsKSB7XG4gICAgaWYgKFxuICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7XCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YWcuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBibHVlO1wiKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoXG4gICAgc3FyLmdldFNoaXAoKS5oaXRDb29yLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBpdGVtWzBdID09PSB4ICYmIGl0ZW1bMV0gPT09IHk7XG4gICAgfSlcbiAgKSB7XG4gICAgdGFnLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgfVxufTtcblxuY29uc3QgcmVuZGVyU2hpcCA9IChwbGF5ZXIpID0+IHtcbiAgbGV0IGJvYXJkID0gcGxheWVyLmJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IHNoaXBzT2JqID0gcGxheWVyLmJvYXJkLmdldFNoaXBzKCk7XG4gIGNvbnN0IHNoaXBzTGlzdCA9IE9iamVjdC5rZXlzKHNoaXBzT2JqKTtcblxuICBzaGlwc0xpc3QuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgIGNvbnN0IGNvbXAgPSBzaGlwc09ialtzaGlwXS5nZXRTaGlwKCkuY29tcDtcblxuICAgIGlmIChjb21wLmxlbmd0aCAhPT0gMCkge1xuICAgICAgY29uc3QgeENvb3IgPSBjb21wWzBdWzBdO1xuICAgICAgY29uc3QgeUNvb3IgPSBjb21wWzBdWzFdO1xuICAgICAgcGxheWVyLmJvYXJkLnBsYWNlU2hpcCh4Q29vciwgeUNvb3IsIHNoaXBzT2JqW3NoaXBdKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBib2FyZDtcbn07XG5cbmNvbnN0IHJlbmRlckJvYXJkID0gKHBsYXllcikgPT4ge1xuICBwbGF5ZXIuYm9hcmQuY3JlYXRlQm9hcmQoKTtcblxuICByZW5kZXJTaGlwKHBsYXllcik7XG5cbiAgY29uc3QgYm9hcmQgPSBwbGF5ZXIuYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3QgcGxheWVyTnVtID0gcGxheWVyLm51bWJlcjtcbiAgbGV0IGN1cnJlbnRCb2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBib2FyZCR7cGxheWVyTnVtfWApO1xuXG4gIHdoaWxlIChjdXJyZW50Qm9hcmQubGFzdEVsZW1lbnRDaGlsZClcbiAgICBjdXJyZW50Qm9hcmQucmVtb3ZlQ2hpbGQoY3VycmVudEJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJvYXJkLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoYCR7cGxheWVyTnVtfS1zcXVhcmVgKTtcblxuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteFwiLCBgJHtpfWApO1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteVwiLCBgJHtqfWApO1xuXG4gICAgICBmaWxsU3FyKHBsYXllciwgYm9hcmRbaV1bal0sIHNxdWFyZSwgaSwgaik7XG5cbiAgICAgIGN1cnJlbnRCb2FyZC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50Qm9hcmQ7XG59O1xuXG5jb25zdCBpbml0UGxhY2VTaGlwID0gKHBPbmUsIHBUd28pID0+IHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3BsYWNlU2hpcEJ0bmApO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImZvcm1cIik7XG4gICAgbGV0IGlkID0gZm9ybS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcblxuICAgIGNvbnN0IHhDb29yID0gcGFyc2VJbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI3ktY29vcmApLnZhbHVlKTtcbiAgICBjb25zdCB5Q29vciA9IHBhcnNlSW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCN4LWNvb3JgKS52YWx1ZSk7XG4gICAgY29uc3Qgc2hpcE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjc2hpcHNgKS52YWx1ZTtcblxuICAgIGNvbnN0IG9yaWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNvcmllbnRhdGlvbmApLnZhbHVlO1xuXG4gICAgbGV0IHNoaXA7XG4gICAgaWQgPT09IFwicGxheWVyT25lLWZvcm1cIlxuICAgICAgPyAoc2hpcCA9IHBPbmUuYm9hcmQuZ2V0U2hpcHMoKVtzaGlwTmFtZV0pXG4gICAgICA6IChzaGlwID0gcFR3by5ib2FyZC5nZXRTaGlwcygpW3NoaXBOYW1lXSk7XG5cbiAgICBzaGlwLmdldFNoaXAoKS5vcmllbnRhdGlvbiA9IG9yaWVudDtcblxuICAgIGlmIChOdW1iZXIuaXNOYU4oeENvb3IpIHx8IE51bWJlci5pc05hTih5Q29vcikpIHJldHVybjtcbiAgICBlbHNlIHtcbiAgICAgIGlmIChpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiKSB7XG4gICAgICAgIHBPbmUuYm9hcmQucGxhY2VTaGlwKHhDb29yLCB5Q29vciwgc2hpcCk7XG4gICAgICAgIHJlbmRlckJvYXJkKHBPbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcFR3by5ib2FyZC5wbGFjZVNoaXAoeENvb3IsIHlDb29yLCBzaGlwKTtcbiAgICAgICAgcmVuZGVyQm9hcmQocFR3byk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGluaXRGaW5TZXR1cCA9IChwT25lLCBwVHdvKSA9PiB7XG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2ZpbkJ0bmApO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZm9ybWApO1xuICBjb25zdCBwbGF5ZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItbmFtZVwiKTtcblxuICBsZXQgaXNBbGxQbGFjZWQgPSBmYWxzZTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgbGV0IHNoaXBzT2JqO1xuICAgIGNvbnN0IG1vZGUgPSBtYWluLmdldEF0dHJpYnV0ZShcImNsYXNzXCIpO1xuICAgIGxldCBpZCA9IGZvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIik7XG5cbiAgICBpZCA9PT0gXCJwbGF5ZXJPbmUtZm9ybVwiXG4gICAgICA/IChzaGlwc09iaiA9IHBPbmUuYm9hcmQuZ2V0U2hpcHMoKSlcbiAgICAgIDogKHNoaXBzT2JqID0gcFR3by5ib2FyZC5nZXRTaGlwcygpKTtcblxuICAgIGNvbnN0IHNoaXBzID0gT2JqZWN0LnZhbHVlcyhzaGlwc09iaik7XG5cbiAgICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBjb25zdCBjb21wID0gc2hpcC5nZXRTaGlwKCkuY29tcDtcbiAgICAgIGlmIChjb21wLmxlbmd0aCA9PT0gMCkgcmV0dXJuIChpc0FsbFBsYWNlZCA9IGZhbHNlKTtcbiAgICAgIGVsc2UgcmV0dXJuIChpc0FsbFBsYWNlZCA9IHRydWUpO1xuICAgIH0pO1xuXG4gICAgaWYgKGlzQWxsUGxhY2VkKSB7XG4gICAgICBpZiAoaWQgPT09IFwicGxheWVyT25lLWZvcm1cIikge1xuICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShcImlkXCIsIFwicGxheWVyVHdvLWZvcm1cIik7XG4gICAgICAgIGhpZGVCb2FyZChwT25lKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1vZGUgPT09IFwicHZjXCIgfHwgaWQgPT09IFwicGxheWVyVHdvLWZvcm1cIikge1xuICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiZGlzcGxheTogbm9uZTtcIik7XG4gICAgICAgIGhpZGVCb2FyZChwVHdvKTtcbiAgICAgICAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gICAgICAgIHBsYXllck5hbWUudGV4dENvbnRlbnQgPSBcIlBsYXllciBPbmVgcyB0dXJuIVwiO1xuICAgICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGFsZXJ0KFwiUGxlYXNlIHBsYWNlIGFsbCB0aGUgc2hpcHMgZmlyc3RcIik7XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGhpZGVCb2FyZCA9IChwbGF5ZXIpID0+IHtcbiAgbGV0IHNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAuJHtwbGF5ZXIubnVtYmVyfS1zcXVhcmVgKTtcblxuICBzcXVhcmVzLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yOiBncmF5O1wiKTtcbiAgfSk7XG59O1xuXG5jb25zdCBpbml0cGxheUJ0biA9IChQT25lLCBQVHdvKSA9PiB7XG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbiAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gIGNvbnN0IHBsYXlXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYXktd2luZG93XCIpO1xuICBjb25zdCBwbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5XCIpO1xuXG4gIHBsYXlCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCBwbGF5ZXIgPSBwbGF5V2luZG93LmdldEF0dHJpYnV0ZShcImRhdGEtaWRcIik7XG5cbiAgICBpZiAocGxheWVyID09PSBcInBsYXllci1Ud29cIikge1xuICAgICAgcmVuZGVyQm9hcmQoUE9uZSk7XG4gICAgICByZW5kZXJQbGF5QmQoUFR3byk7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke1BPbmUubnVtYmVyfWApO1xuICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgIH0gZWxzZSBpZiAocGxheWVyID09PSBcInBsYXllci1PbmVcIikge1xuICAgICAgY29uc3QgbW9kZSA9IG1haW4uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIik7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke1BUd28ubnVtYmVyfWApO1xuICAgICAgaWYgKG1vZGUgPT09IFwicHZjXCIpIHtcbiAgICAgICAgYXV0b0F0ayhQT25lLCBQVHdvKTtcbiAgICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVuZGVyQm9hcmQoUFR3byk7XG4gICAgICAgIHJlbmRlclBsYXlCZChQT25lKTtcbiAgICAgICAgcmV0dXJuIGRpYWxvZy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCByZW5kZXJQbGF5QmQgPSAocGxheWVyKSA9PiB7XG4gIGNvbnN0IGJvYXJkID0gcGxheWVyLmJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IG1pc3NlcyA9IHBsYXllci5ib2FyZC5nZXRNaXNzZXMoKTtcbiAgY29uc3QgY3VyckJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2JvYXJkJHtwbGF5ZXIubnVtYmVyfWApO1xuXG4gIHdoaWxlIChjdXJyQm9hcmQubGFzdEVsZW1lbnRDaGlsZClcbiAgICBjdXJyQm9hcmQucmVtb3ZlQ2hpbGQoY3VyckJvYXJkLmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJvYXJkLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBpdGVtID0gYm9hcmRbaV1bal07XG5cbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChgJHtwbGF5ZXIubnVtYmVyfS1zcXVhcmVgKTtcblxuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteFwiLCBgJHtpfWApO1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcImRhdGEteVwiLCBgJHtqfWApO1xuXG4gICAgICBpbml0U3FyQnRuKHBsYXllciwgc3F1YXJlKTtcblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtICE9PSBudWxsICYmXG4gICAgICAgIGl0ZW0uZ2V0U2hpcCgpLmhpdENvdW50ID4gMCAmJlxuICAgICAgICBpdGVtLmdldFNoaXAoKS5oaXRDb29yLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgICByZXR1cm4gaXRlbVswXSA9PT0gaSAmJiBpdGVtWzFdID09PSBqO1xuICAgICAgICB9KVxuICAgICAgKSB7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHJlZDtcIik7XG4gICAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBtaXNzZXMuZmluZCgoaXRlbSkgPT4ge1xuICAgICAgICAgIHJldHVybiBpdGVtWzBdID09PSBpICYmIGl0ZW1bMV0gPT09IGo7XG4gICAgICAgIH0pXG4gICAgICApIHtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogZ3JlZW47XCIpO1xuICAgICAgICBzcXVhcmUuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICB9XG5cbiAgICAgIGN1cnJCb2FyZC5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgIH1cbiAgfVxufTtcblxuY29uc3QgaW5pdFNxckJ0biA9IChwbGF5ZXIsIHNxdWFyZSkgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXllci5ib2FyZDtcbiAgY29uc3QgYm9hcmRMaXN0ID0gYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgY29uc3QgZGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaWFsb2dcIik7XG4gIGNvbnN0IHggPSBwYXJzZUludChzcXVhcmUuZ2V0QXR0cmlidXRlKFwiZGF0YS14XCIpKTtcbiAgY29uc3QgeSA9IHBhcnNlSW50KHNxdWFyZS5nZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIikpO1xuICBjb25zdCB3aW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndpbm5lclwiKTtcbiAgY29uc3QgZW5kTXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbmQtZ2FtZVwiKTtcbiAgY29uc3Qgd2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgY29uc3QgcGxheWVyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLW5hbWVcIik7XG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcblxuICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGlkID0gd2luZG93LmdldEF0dHJpYnV0ZShcImRhdGEtaWRcIik7XG4gICAgY29uc3QgbW9kZSA9IG1haW4uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIik7XG5cbiAgICBib2FyZC5yZWNlaXZlQXR0YWNrKHgsIHkpO1xuICAgIGlmIChib2FyZExpc3RbeF1beV0gPT09IG51bGwpIHtcbiAgICAgIGhpZGVCb2FyZChwbGF5ZXIpO1xuICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogeWVsbG93O1wiKTtcblxuICAgICAgaWYgKG1vZGUgPT09IFwicHZjXCIpIHtcbiAgICAgICAgcGxheWVyTmFtZS50ZXh0Q29udGVudCA9IFwiQ29tcHV0ZXJgcyB0dXJuIVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWQgPT09IFwicGxheWVyLU9uZVwiXG4gICAgICAgICAgPyAocGxheWVyTmFtZS50ZXh0Q29udGVudCA9IFwiUGxheWVyIFR3b2BzIHR1cm4hXCIpXG4gICAgICAgICAgOiAocGxheWVyTmFtZS50ZXh0Q29udGVudCA9IFwiUGxheWVyIE9uZWBzIHR1cm4hXCIpO1xuICAgICAgfVxuXG4gICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNxdWFyZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImJhY2tncm91bmQtY29sb3I6IHJlZDtcIik7XG5cbiAgICAgIGlmIChwbGF5ZXIuYm9hcmQuaXNBbGxTdW5rKCkpIHtcbiAgICAgICAgc3F1YXJlLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiYmFja2dyb3VuZC1jb2xvcjogcmVkO1wiKTtcbiAgICAgICAgZW5kTXNnLnNob3dNb2RhbCgpO1xuICAgICAgICBpZiAocGxheWVyLm51bWJlciA9PT0gXCJPbmVcIikge1xuICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IGBDb25ncmF0dWxhdGlvbnMgUGxheWVyIFR3byFgO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdpbm5lci50ZXh0Q29udGVudCA9IGBDb25ncmF0dWxhdGlvbnMgUGxheWVyIE9uZSFgO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbnN0IGNvbXBNb2RlID0gKHBsYXllcikgPT4ge1xuICBwbGF5ZXIuYm9hcmQucG9wdWxhdGVCZCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXIpO1xuICBoaWRlQm9hcmQocGxheWVyKTtcbn07XG5cbmNvbnN0IGF1dG9BdGsgPSAocGxheU9uZSwgcGxheVR3bykgPT4ge1xuICBjb25zdCBib2FyZCA9IHBsYXlPbmUuYm9hcmQ7XG4gIGNvbnN0IGJvYXJkTGlzdCA9IGJvYXJkLmdldEJvYXJkKCk7XG4gIGNvbnN0IG1pc3NlcyA9IGJvYXJkLmdldE1pc3NlcygpO1xuICBjb25zdCBoaXRzID0gYm9hcmQuZ2V0SGl0cygpO1xuICBjb25zdCBwbGF5V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcbiAgY29uc3Qgd2lubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53aW5uZXJcIik7XG4gIGNvbnN0IGVuZE1zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZW5kLWdhbWVcIik7XG4gIGxldCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICBsZXQgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgbGV0IGNvbnQgPSB0cnVlO1xuXG4gIHdoaWxlIChjb250ID09PSB0cnVlKSB7XG4gICAgaWYgKFxuICAgICAgbWlzc2VzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICAgIH0pIHx8XG4gICAgICBoaXRzLmZpbmQoKGl0ZW0pID0+IHtcbiAgICAgICAgcmV0dXJuIGl0ZW1bMF0gPT09IHggJiYgaXRlbVsxXSA9PT0geTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG5cbiAgICBpZiAoYm9hcmRMaXN0W3hdW3ldID09PSBudWxsKSB7XG4gICAgICBwbGF5V2luZG93LnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgYHBsYXllci0ke3BsYXlPbmUubnVtYmVyfWApO1xuICAgICAgcmVuZGVyQm9hcmQocGxheU9uZSk7XG4gICAgICByZW5kZXJQbGF5QmQocGxheVR3byk7XG4gICAgICBjb250ID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwbGF5T25lLmJvYXJkLmlzQWxsU3VuaygpKSB7XG4gICAgICAgIGNvbnQgPSBmYWxzZTtcbiAgICAgICAgZW5kTXNnLnNob3dNb2RhbCgpO1xuICAgICAgICB3aW5uZXIudGV4dENvbnRlbnQgPSBcIkNvbXB1dGVyIHdvbiFcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgeyByZW5kZXJCb2FyZCwgaW5pdFBsYWNlU2hpcCwgaW5pdEZpblNldHVwLCBpbml0cGxheUJ0biwgY29tcE1vZGUgfTtcbiIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL3BsYXllclwiO1xuaW1wb3J0IHtcbiAgcmVuZGVyQm9hcmQsXG4gIGluaXRQbGFjZVNoaXAsXG4gIGluaXRGaW5TZXR1cCxcbiAgaW5pdHBsYXlCdG4sXG4gIGNvbXBNb2RlLFxufSBmcm9tIFwiLi9ET01cIjtcblxuY29uc3QgZ2FtZU1vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWVfbW9kZVwiKTtcbmNvbnN0IHB2cEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHZwXCIpO1xuY29uc3QgcHZjQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwdmNcIik7XG5jb25zdCByZXN0YXJ0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yZXN0YXJ0XCIpO1xuY29uc3QgZW5kTXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbmQtZ2FtZVwiKTtcbmNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKTtcbmxldCBwbGF5ZXJPbmUgPSBQbGF5ZXIoXCJPbmVcIik7XG5sZXQgcGxheWVyVHdvID0gUGxheWVyKFwiVHdvXCIpO1xuXG5pbml0UGxhY2VTaGlwKHBsYXllck9uZSwgcGxheWVyVHdvKTtcbmluaXRGaW5TZXR1cChwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5pbml0cGxheUJ0bihwbGF5ZXJPbmUsIHBsYXllclR3byk7XG5cbnB2cEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJPbmUpO1xuICByZW5kZXJCb2FyZChwbGF5ZXJUd28pO1xuXG4gIHJldHVybiBnYW1lTW9kZS5jbG9zZSgpO1xufSk7XG5cbnB2Y0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG5cbiAgcmVuZGVyQm9hcmQocGxheWVyT25lKTtcbiAgcmVuZGVyQm9hcmQocGxheWVyVHdvKTtcblxuICBjb21wTW9kZShwbGF5ZXJUd28pO1xuXG4gIG1haW4uY2xhc3NMaXN0LmFkZChcInB2Y1wiKTtcblxuICByZXR1cm4gZ2FtZU1vZGUuY2xvc2UoKTtcbn0pO1xuXG5yZXN0YXJ0QnRuLmZvckVhY2goKGJ1dHRvbikgPT5cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG4gICAgY29uc3Qgd2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwbGF5LXdpbmRvd1wiKTtcblxuICAgIGVuZE1zZy5jbG9zZSgpO1xuICAgIGZvcm0uc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJwbGF5ZXJPbmUtZm9ybVwiKTtcbiAgICBmb3JtLnJlbW92ZUF0dHJpYnV0ZShcInN0eWxlXCIpO1xuICAgIG1haW4uY2xhc3NMaXN0LnJlbW92ZShcInB2Y1wiKTtcbiAgICB3aW5kb3cuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCBcInBsYXllci1Ud29cIik7XG5cbiAgICBwbGF5ZXJPbmUuYm9hcmQucmVzZXRCb2FyZCgpO1xuICAgIHBsYXllclR3by5ib2FyZC5yZXNldEJvYXJkKCk7XG4gICAgZ2FtZU1vZGUuc2hvd01vZGFsKCk7XG4gIH0pXG4pO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwib25sb2FkXCIsIGdhbWVNb2RlLnNob3dNb2RhbCgpKTtcbiJdLCJuYW1lcyI6WyJTaGlwIiwibiIsInNoaXBPYmoiLCJnZXRTaGlwIiwiaGl0IiwiaGl0Q291bnQiLCJsZW5ndGgiLCJzdW5rIiwiaXNTdW5rIiwicmVzZXRTaGlwIiwib3JpZW50YXRpb24iLCJjb21wIiwiaGl0Q29vciIsIkdhbWVib2FyZCIsImJvYXJkIiwibWlzc2VzIiwiaGl0cyIsImFsbFNoaXBzIiwiYmF0dGxlc2hpcCIsImNydWlzZXJfSSIsImNydWlzZXJfSUkiLCJkZXN0cm95ZXJfSSIsImRlc3Ryb3llcl9JSSIsImRlc3Ryb3llcl9JSUkiLCJzdWJtYXJpbmVfSSIsInN1Ym1hcmluZV9JSSIsInN1Ym1hcmluZV9JSUkiLCJzdWJtYXJpbmVfSVYiLCJpc0ZpdCIsImFyciIsInN0YXR1cyIsImZvckVhY2giLCJpdGVtIiwieCIsInkiLCJjcmVhdGVDb21wIiwic2hpcCIsInRlbXAiLCJhIiwiYiIsInB1c2giLCJwbGFjZVNoaXAiLCJhbGVydCIsImNyZWF0ZUJvYXJkIiwiaSIsImoiLCJnZXRCb2FyZCIsImdldFNoaXBzIiwicmVjZWl2ZUF0dGFjayIsImdldE1pc3NlcyIsImdldEhpdHMiLCJpc0FsbFN1bmsiLCJzaGlwcyIsIk9iamVjdCIsInZhbHVlcyIsInBvcHVsYXRlQmQiLCJrZXlzIiwiZGlyZWN0aW9ucyIsImtleSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInoiLCJmaXQiLCJyZXNldEJvYXJkIiwiUGxheWVyIiwibnVtYmVyIiwid2luIiwiaXNDb21wIiwiZmlsbFNxciIsInBsYXllciIsInNxciIsInRhZyIsImZpbmQiLCJzZXRBdHRyaWJ1dGUiLCJyZW5kZXJCb2FyZCIsInNoaXBzT2JqIiwieENvb3IiLCJ5Q29vciIsInJlbmRlclNoaXAiLCJwbGF5ZXJOdW0iLCJjdXJyZW50Qm9hcmQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibGFzdEVsZW1lbnRDaGlsZCIsInJlbW92ZUNoaWxkIiwic3F1YXJlIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZENoaWxkIiwiaGlkZUJvYXJkIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbmRlclBsYXlCZCIsImN1cnJCb2FyZCIsInF1ZXJ5U2VsZWN0b3IiLCJpbml0U3FyQnRuIiwiYm9hcmRMaXN0IiwiZGlhbG9nIiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJ3aW5uZXIiLCJlbmRNc2ciLCJ3aW5kb3ciLCJwbGF5ZXJOYW1lIiwibWFpbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJpZCIsIm1vZGUiLCJ0ZXh0Q29udGVudCIsInNob3dNb2RhbCIsImdhbWVNb2RlIiwicHZwQnRuIiwicHZjQnRuIiwicmVzdGFydEJ0biIsInBsYXllck9uZSIsInBsYXllclR3byIsInBPbmUiLCJwVHdvIiwidmFsdWUiLCJzaGlwTmFtZSIsIm9yaWVudCIsIk51bWJlciIsImlzTmFOIiwiYnV0dG9uIiwiZm9ybSIsImlzQWxsUGxhY2VkIiwiaW5pdEZpblNldHVwIiwiUE9uZSIsIlBUd28iLCJwbGF5V2luZG93IiwiY2xvc2UiLCJwbGF5T25lIiwicGxheVR3byIsImNvbnQiLCJhdXRvQXRrIiwiaW5pdHBsYXlCdG4iLCJyZW1vdmVBdHRyaWJ1dGUiLCJyZW1vdmUiXSwic291cmNlUm9vdCI6IiJ9